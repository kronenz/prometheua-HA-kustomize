# 03. ìš´ì˜ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

Prometheus Agent + Thanos Receiver í™˜ê²½ì˜ ì¼ìƒ ìš´ì˜ ì‘ì—…, ëª¨ë‹ˆí„°ë§, ë¬¸ì œ í•´ê²° ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“‚ ë¬¸ì„œ ëª©ë¡

### GitOps-ì›Œí¬í”Œë¡œìš°.md
**ëª©ì **: Git ê¸°ë°˜ ìš´ì˜ í”„ë¡œì„¸ìŠ¤

**ì£¼ìš” ë‚´ìš©**:
- ì„¤ì • ë³€ê²½ í”„ë¡œì„¸ìŠ¤
- PR ë¦¬ë·° ë° ìŠ¹ì¸
- ìë™ Sync vs ìˆ˜ë™ Sync
- ë³€ê²½ ì´ë ¥ ì¶”ì 
- ë¡¤ë°± ì ˆì°¨

**ëŒ€ìƒ ë…ì**: ëª¨ë“  ìš´ì˜ì

---

### Agent-ê´€ë¦¬.md
**ëª©ì **: Prometheus Agent ìš´ì˜

**ì£¼ìš” ë‚´ìš©**:
- Agent ìƒíƒœ ëª¨ë‹ˆí„°ë§
- WAL ê´€ë¦¬
- Remote Write í ëª¨ë‹ˆí„°ë§
- ì¬ì‹œì‘ ë° ë³µêµ¬
- ë¡œê·¸ ë¶„ì„

**ëŒ€ìƒ ë…ì**: SRE, ìš´ì˜ ë‹´ë‹¹ì

---

### Receiver-ê´€ë¦¬.md
**ëª©ì **: Thanos Receiver ìš´ì˜

**ì£¼ìš” ë‚´ìš©**:
- Receiver ìƒíƒœ í™•ì¸
- Hashring ê´€ë¦¬
- Replication ëª¨ë‹ˆí„°ë§
- ìŠ¤ì¼€ì¼ë§
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

**ëŒ€ìƒ ë…ì**: SRE, Thanos ìš´ì˜ì

---

### ë°±ì—…-ë°-ë³µêµ¬.md
**ëª©ì **: ë°ì´í„° ë°±ì—… ë° ì¬í•´ ë³µêµ¬

**ì£¼ìš” ë‚´ìš©**:
- Prometheus TSDB ë°±ì—…
- S3 ìŠ¤ëƒ…ìƒ·
- OpenSearch ë°±ì—…
- ì¬í•´ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤
- RTO/RPO ëª©í‘œ

**ëŒ€ìƒ ë…ì**: SRE, ë°±ì—… ë‹´ë‹¹ì

---

### ìŠ¤ì¼€ì¼ë§.md
**ëª©ì **: ìˆ˜í‰/ìˆ˜ì§ ìŠ¤ì¼€ì¼ë§ ì „ëµ

**ì£¼ìš” ë‚´ìš©**:
- Prometheus Agent ìŠ¤ì¼€ì¼ë§
- Thanos Receiver ìˆ˜í‰ í™•ì¥
- Prometheus HA Replica ì¦ê°€
- ë¦¬ì†ŒìŠ¤ íŠœë‹
- ë¹„ìš© ìµœì í™”

**ëŒ€ìƒ ë…ì**: ì•„í‚¤í…íŠ¸, SRE

---

### ì—…ë°ì´íŠ¸-ë°-íŒ¨ì¹˜.md
**ëª©ì **: ì»´í¬ë„ŒíŠ¸ ì—…ê·¸ë ˆì´ë“œ ë° íŒ¨ì¹˜ ê´€ë¦¬

**ì£¼ìš” ë‚´ìš©**:
- Helm Chart ì—…ê·¸ë ˆì´ë“œ
- Prometheus ë²„ì „ ì—…ë°ì´íŠ¸
- Thanos ë²„ì „ ì—…ë°ì´íŠ¸
- ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
- ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

**ëŒ€ìƒ ë…ì**: DevOps ì—”ì§€ë‹ˆì–´

---

### ì¼ë°˜-íŠ¸ëŸ¬ë¸”ìŠˆíŒ….md
**ëª©ì **: ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

**ì£¼ìš” ë‚´ìš©**:
- Remote Write ì‹¤íŒ¨
- Receiver ì—°ê²° ëŠê¹€
- ë©”íŠ¸ë¦­ ëˆ„ë½
- ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

**ëŒ€ìƒ ë…ì**: ëª¨ë“  ìš´ì˜ì

---

### ë¹ ë¥¸-ì°¸ì¡°.md
**ëª©ì **: ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ ëª¨ìŒ

**ì£¼ìš” ë‚´ìš©**:
- kubectl ëª…ë ¹ì–´
- ArgoCD ëª…ë ¹ì–´
- Prometheus ì¿¼ë¦¬
- Thanos CLI
- ë””ë²„ê¹… ëª…ë ¹ì–´

**ëŒ€ìƒ ë…ì**: ëª¨ë“  ìš´ì˜ì

---

## ğŸ¯ ì¼ìƒ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§¤ì¼
- [ ] ArgoCD Application ìƒíƒœ í™•ì¸
- [ ] Prometheus Agent Remote Write ìƒíƒœ
- [ ] Thanos Receiver ë©”íŠ¸ë¦­ ìˆ˜ì‹  í™•ì¸
- [ ] Grafana ëŒ€ì‹œë³´ë“œ ì •ìƒ ì¡°íšŒ
- [ ] ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

### ë§¤ì£¼
- [ ] S3 ë²„í‚· ì‚¬ìš©ëŸ‰ í™•ì¸
- [ ] Prometheus TSDB ìš©ëŸ‰ í™•ì¸
- [ ] Alertmanager ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ê²€í† 
- [ ] WAL í¬ê¸° ëª¨ë‹ˆí„°ë§
- [ ] ë¡œê·¸ ì¸ë±ìŠ¤ ì •ë¦¬

### ë§¤ì›”
- [ ] Helm Chart ì—…ë°ì´íŠ¸ í™•ì¸
- [ ] ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
- [ ] ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] ë°±ì—… ê²€ì¦

---

## ğŸš¨ ê¸´ê¸‰ ëŒ€ì‘

### 1. Receiver ë‹¤ìš´
```bash
# ìƒíƒœ í™•ì¸
kubectl get pods -n monitoring -l app=thanos-receive

# ë¡œê·¸ í™•ì¸
kubectl logs -n monitoring deployment/thanos-receive --tail=100

# ì¬ì‹œì‘
kubectl rollout restart deployment/thanos-receive -n monitoring
```

### 2. Remote Write ì‹¤íŒ¨
```bash
# Agent ë¡œê·¸ í™•ì¸
kubectl logs -n monitoring prometheus-agent-0 --tail=100

# Receiver endpoint í™•ì¸
kubectl get svc -n monitoring thanos-receive

# ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸
kubectl exec -it prometheus-agent-0 -n monitoring -- \
  curl -v http://thanos-receive.monitoring:19291/-/ready
```

### 3. ë©”íŠ¸ë¦­ ëˆ„ë½
```bash
# Thanos Queryì—ì„œ í™•ì¸
curl "http://thanos-query.k8s-cluster-01.miribit.lab/api/v1/query?query=up"

# Receiver Stats í™•ì¸
curl "http://thanos-receive.monitoring:19291/api/v1/status/tsdb"
```

---

## ğŸ“Š ì£¼ìš” ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

### Grafana ëŒ€ì‹œë³´ë“œ
- **Thanos Receive Overview**: Receiver ìƒíƒœ ë° ë©”íŠ¸ë¦­
- **Prometheus Agent**: Agentë³„ Remote Write ìƒíƒœ
- **Multi-Cluster Summary**: ì „ì²´ í´ëŸ¬ìŠ¤í„° ìš”ì•½

### Prometheus Queries
```promql
# Remote Write ì„±ê³µë¥ 
rate(prometheus_remote_storage_succeeded_samples_total[5m])

# Remote Write ì‹¤íŒ¨
rate(prometheus_remote_storage_failed_samples_total[5m])

# Receiver ìˆ˜ì‹  ë©”íŠ¸ë¦­
rate(thanos_receive_replication_requests_total[5m])
```

---

## ğŸ”— ê´€ë ¨ ì„¹ì…˜

- **ì•„í‚¤í…ì²˜** â†’ [01-ì•„í‚¤í…ì²˜](../01-ì•„í‚¤í…ì²˜/)
- **ë°°í¬** â†’ [02-Kustomize-Helm-GitOps-ë°°í¬](../02-Kustomize-Helm-GitOps-ë°°í¬/)
- **ëª¨ë‹ˆí„°ë§** â†’ [04-ëª¨ë‹ˆí„°ë§-ê°€ì´ë“œ](../04-ëª¨ë‹ˆí„°ë§-ê°€ì´ë“œ/)

---

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-20

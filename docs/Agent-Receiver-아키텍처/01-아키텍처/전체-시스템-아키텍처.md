# ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ“‹ ê°œìš”

Prometheus Agent + Thanos Receiver íŒ¨í„´ì„ ì‚¬ìš©í•œ 4ê°œ í´ëŸ¬ìŠ¤í„° ë©€í‹°í´ëŸ¬ìŠ¤í„° ê´€ì°°ì„± í”Œë«í¼ì˜ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì»¨í…ìŠ¤íŠ¸ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph Users["ğŸ‘¥ ì‚¬ìš©ì"]
        OPS[SRE/DevOps<br/>ì‹œìŠ¤í…œ ìš´ì˜ì]
        DEV[Developer<br/>ê°œë°œì]
    end

    subgraph Platform["ğŸ¢ Observability Platform (Multi-Cluster)"]
        CENTRAL["ğŸ¯ Central Cluster<br/>Cluster-01 (192.168.101.194)<br/>í†µí•© ëª¨ë‹ˆí„°ë§ ë° ì €ì¥"]

        subgraph EdgeClusters["ì—£ì§€ í´ëŸ¬ìŠ¤í„°"]
            EDGE02["ğŸ“¦ Edge Multi-Tenant<br/>Cluster-02 (196)<br/>ë©€í‹°í…Œë„ŒíŠ¸ ì—£ì§€"]
            EDGE03["ğŸ“¦ Edge Cluster ë‚˜<br/>Cluster-03 (197)<br/>ë‹¨ì¼ í…Œë„ŒíŠ¸"]
            EDGE04["ğŸ“¦ Edge Cluster ë‹¤<br/>Cluster-04 (198)<br/>ë‹¨ì¼ í…Œë„ŒíŠ¸"]
        end
    end

    subgraph External["ğŸŒ ì™¸ë¶€ ì‹œìŠ¤í…œ"]
        S3["ğŸ’¾ MinIO S3<br/>ì¥ê¸° ë©”íŠ¸ë¦­ ì €ì¥ì†Œ<br/>180ì¼ retention"]
        GIT["ğŸ“š Git Repository<br/>GitOps ì„¤ì •<br/>GitHub"]
    end

    OPS -->|ëŒ€ì‹œë³´ë“œ ì¡°íšŒ<br/>ì•Œë¦¼ í™•ì¸<br/>HTTPS| CENTRAL
    DEV -->|ë©”íŠ¸ë¦­ ì¿¼ë¦¬<br/>ë¡œê·¸ ê²€ìƒ‰<br/>HTTPS| CENTRAL

    EDGE02 -.->|Remote Write<br/>HTTPS:9291| CENTRAL
    EDGE03 -.->|Remote Write<br/>HTTPS:9291| CENTRAL
    EDGE04 -.->|Remote Write<br/>HTTPS:9291| CENTRAL

    CENTRAL <-->|ë©”íŠ¸ë¦­ ì—…ë¡œë“œ/ì¡°íšŒ<br/>S3 API| S3
    CENTRAL -->|ì„¤ì • ë™ê¸°í™”<br/>Git Pull| GIT

    style CENTRAL fill:#4fc3f7,stroke:#0288d1,stroke-width:3px
    style EDGE02 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style EDGE03 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style EDGE04 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style S3 fill:#ff9800,stroke:#e65100,stroke-width:2px
    style GIT fill:#9e9e9e,stroke:#424242,stroke-width:2px
```

---

## ğŸ—ï¸ Central Cluster ìƒì„¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph EdgeClusters["ğŸ“¡ Edge Clusters"]
        AGENT02[Prometheus Agent<br/>Cluster-02<br/>Multi-Tenant]
        AGENT03[Prometheus Agent<br/>Cluster-03]
        AGENT04[Prometheus Agent<br/>Cluster-04]
    end

    subgraph CentralCluster["ğŸ¯ Central Cluster (192.168.101.194)"]
        subgraph IngressLayer["Ingress Layer"]
            CILIUM[Cilium LB<br/>L2 LoadBalancer<br/>VIP: 192.168.101.210]
            NGINX[Nginx Ingress<br/>HTTP/HTTPS Router]
        end

        subgraph MetricsPipeline["ğŸ“Š Metrics Pipeline"]
            RECEIVER[("Thanos Receiver<br/>StatefulSet x3<br/>RF=3")]
            QUERY["Thanos Query<br/>Deployment x2<br/>PromQL Engine"]
            STORE[("Thanos Store<br/>StatefulSet x2<br/>S3 Gateway")]
            COMPACTOR["Thanos Compactor<br/>Downsampling<br/>7dâ†’30dâ†’180d"]
            RULER["Thanos Ruler<br/>Recording Rules<br/>Alerting"]
        end

        subgraph Visualization["ğŸ“ˆ Visualization"]
            GRAFANA["Grafana<br/>Deployment<br/>Port: 3000"]
            ALERTMGR["Alertmanager<br/>StatefulSet x3<br/>Slack/Email"]
        end

        subgraph LoggingStack["ğŸ“ Logging Stack"]
            OPENSEARCH[("OpenSearch<br/>StatefulSet x3<br/>90ì¼ retention")]
            OSD["OpenSearch<br/>Dashboards<br/>Port: 5601"]
            FLUENTBIT["Fluent-Bit<br/>DaemonSet<br/>Log Collector"]
        end

        subgraph GitOps["ğŸ”„ GitOps"]
            ARGOCD["ArgoCD<br/>StatefulSet<br/>CD Pipeline"]
        end
    end

    subgraph ExternalSystems["ğŸŒ External Systems"]
        S3[("MinIO S3<br/>Object Storage<br/>Metrics + Logs")]
        GIT["Git Repository<br/>GitHub<br/>Config Store"]
    end

    USER[ğŸ‘¤ User]

    %% User flow
    USER -->|HTTPS| CILIUM
    CILIUM --> NGINX
    NGINX -->|Dashboard| GRAFANA
    NGINX -->|Logs UI| OSD

    %% Remote Write flow
    AGENT02 -.->|Remote Write<br/>HTTPS:9291| NGINX
    AGENT03 -.->|Remote Write<br/>HTTPS:9291| NGINX
    AGENT04 -.->|Remote Write<br/>HTTPS:9291| NGINX
    NGINX -->|Forward| RECEIVER

    %% Metrics storage flow
    RECEIVER -->|Upload 2h Blocks<br/>S3 API| S3
    COMPACTOR -->|Downsampling<br/>S3 API| S3

    %% Query flow
    QUERY -->|Recent Data<br/>gRPC:10901| RECEIVER
    QUERY -->|Historical Data<br/>gRPC:10901| STORE
    STORE <-->|Read Blocks<br/>S3 API| S3
    GRAFANA -->|PromQL<br/>HTTP:9090| QUERY
    RULER -->|Eval Rules<br/>HTTP:9090| QUERY
    RULER -->|Send Alerts<br/>HTTP:9093| ALERTMGR

    %% Logging flow
    FLUENTBIT -->|Ship Logs<br/>HTTP:9200| OPENSEARCH
    OPENSEARCH -->|S3 Snapshot| S3
    GRAFANA -->|Logs Query<br/>HTTP:9200| OPENSEARCH

    %% GitOps flow
    ARGOCD -->|Git Sync<br/>HTTPS| GIT

    style RECEIVER fill:#4fc3f7,stroke:#0288d1,stroke-width:3px
    style QUERY fill:#4fc3f7,stroke:#0288d1,stroke-width:2px
    style STORE fill:#4fc3f7,stroke:#0288d1,stroke-width:2px
    style GRAFANA fill:#66bb6a,stroke:#388e3c,stroke-width:2px
    style OPENSEARCH fill:#ffa726,stroke:#e65100,stroke-width:2px
    style S3 fill:#ff7043,stroke:#d84315,stroke-width:3px
```

---

## ğŸ—ï¸ Thanos Receiver ê³ ê°€ìš©ì„± êµ¬ì¡°

```mermaid
graph LR
    subgraph EdgeAgents["ğŸ“¡ Prometheus Agents"]
        AGENTS[Cluster-02/03/04<br/>Remote Write]
    end

    subgraph Services["ğŸ”Œ Kubernetes Services"]
        LB_SVC[receiver-lb Service<br/>ClusterIP<br/>Port: 19291]
        GRPC_SVC[receiver-grpc Service<br/>Headless<br/>Port: 10901]
    end

    subgraph ReceiverStatefulSet["ğŸ”„ Thanos Receiver StatefulSet (RF=3)"]
        subgraph Pod0["Pod: Receiver-0"]
            RECV0[Receiver Process<br/>Hashring Member]
            TSDB0[("TSDB-0<br/>PVC: 30Gi<br/>2h Blocks + WAL")]
        end

        subgraph Pod1["Pod: Receiver-1"]
            RECV1[Receiver Process<br/>Hashring Member]
            TSDB1[("TSDB-1<br/>PVC: 30Gi<br/>2h Blocks + WAL")]
        end

        subgraph Pod2["Pod: Receiver-2"]
            RECV2[Receiver Process<br/>Hashring Member]
            TSDB2[("TSDB-2<br/>PVC: 30Gi<br/>2h Blocks + WAL")]
        end

        CONFIG["ğŸ“‹ Hashring Config<br/>ConfigMap<br/>Tenant Routing<br/>Consistent Hash"]
    end

    subgraph Storage["ğŸ’¾ Storage"]
        S3[("MinIO S3<br/>thanos-cluster-01<br/>Long-term Storage")]
    end

    QUERY["ğŸ” Thanos Query<br/>PromQL Engine"]

    %% Remote Write flow
    AGENTS -.->|Remote Write<br/>HTTP POST| LB_SVC
    LB_SVC -->|Route by Hash| RECV0
    LB_SVC -->|Route by Hash| RECV1
    LB_SVC -->|Route by Hash| RECV2

    %% Hashring config
    RECV0 -.->|Watch| CONFIG
    RECV1 -.->|Watch| CONFIG
    RECV2 -.->|Watch| CONFIG

    %% Replication (RF=3)
    RECV0 <-.->|gRPC<br/>Replicate| RECV1
    RECV0 <-.->|gRPC<br/>Replicate| RECV2
    RECV1 <-.->|gRPC<br/>Replicate| RECV2

    %% Local TSDB write
    RECV0 -->|Write Samples| TSDB0
    RECV1 -->|Write Samples| TSDB1
    RECV2 -->|Write Samples| TSDB2

    %% S3 upload
    TSDB0 -->|Upload 2h Block<br/>S3 API| S3
    TSDB1 -->|Upload 2h Block<br/>S3 API| S3
    TSDB2 -->|Upload 2h Block<br/>S3 API| S3

    %% Query flow
    QUERY -->|gRPC StoreAPI<br/>Recent Metrics| GRPC_SVC
    GRPC_SVC -->|Query| RECV0
    GRPC_SVC -->|Query| RECV1
    GRPC_SVC -->|Query| RECV2

    style RECV0 fill:#4fc3f7,stroke:#0288d1,stroke-width:2px
    style RECV1 fill:#4fc3f7,stroke:#0288d1,stroke-width:2px
    style RECV2 fill:#4fc3f7,stroke:#0288d1,stroke-width:2px
    style TSDB0 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style TSDB1 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style TSDB2 fill:#81c784,stroke:#388e3c,stroke-width:2px
    style S3 fill:#ff7043,stroke:#d84315,stroke-width:3px
    style CONFIG fill:#ffd54f,stroke:#f57f17,stroke-width:2px
```

---

## ğŸ—ï¸ ê¸°ì¡´ ìƒì„¸ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "Edge Cluster - ê°€ (cluster-02, 196)"
        subgraph "Tenant A"
            PA1[Prometheus Agent A] --> NE1[Node Exporter]
            PA1 --> KSM1[Kube-State-Metrics]
        end
        subgraph "Tenant B"
            PA2[Prometheus Agent B] --> NE2[Node Exporter]
            PA2 --> KSM2[Kube-State-Metrics]
        end
    end

    subgraph "Edge Cluster - ë‚˜ (cluster-03, 197)"
        PA3[Prometheus Agent] --> NE3[Node Exporter]
        PA3 --> KSM3[Kube-State-Metrics]
    end

    subgraph "Edge Cluster - ë‹¤ (cluster-04, 198)"
        PA4[Prometheus Agent] --> NE4[Node Exporter]
        PA4 --> KSM4[Kube-State-Metrics]
    end

    subgraph "Central Cluster (cluster-01, 194)"
        subgraph "Ingress Layer"
            LB[Cilium LB<br/>192.168.101.194] --> INGRESS[Nginx Ingress]
        end

        subgraph "Metrics Collection"
            INGRESS --> RECEIVER[Thanos Receiver<br/>StatefulSet x3]
            RECEIVER --> PROM_HA[Prometheus HA<br/>Replica x2]
        end

        subgraph "Thanos Components"
            QUERY[Thanos Query] --> PROM_HA
            QUERY --> STORE[Thanos Store]
            COMPACTOR[Thanos Compactor] --> S3
            RULER[Thanos Ruler] --> QUERY
            STORE --> S3[(MinIO S3)]
        end

        subgraph "Visualization & Logging"
            GRAFANA[Grafana] --> QUERY
            GRAFANA --> OPENSEARCH[OpenSearch Cluster]
            FLUENTBIT[Fluent-Bit<br/>DaemonSet] --> OPENSEARCH
        end

        subgraph "GitOps"
            ARGOCD[ArgoCD] --> GIT[Git Repository]
        end
    end

    PA1 -->|Remote Write<br/>HTTPS| INGRESS
    PA2 -->|Remote Write<br/>HTTPS| INGRESS
    PA3 -->|Remote Write<br/>HTTPS| INGRESS
    PA4 -->|Remote Write<br/>HTTPS| INGRESS

    RECEIVER --> S3
    PROM_HA --> S3

    style RECEIVER fill:#4fc3f7
    style QUERY fill:#4fc3f7
    style GRAFANA fill:#ff9800
    style PA1 fill:#e1f5fe
    style PA2 fill:#fff3e0
```

---

## ğŸ¯ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì›ì¹™

### 1. ì¤‘ì•™ì§‘ì¤‘ì‹ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Edge**: Prometheus Agentê°€ ë¡œì»¬ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í›„ Remote Write
- **Central**: Thanos Receiverê°€ ëª¨ë“  í´ëŸ¬ìŠ¤í„° ë©”íŠ¸ë¦­ ìˆ˜ì‹  ë° ì €ì¥
- **ì´ì **: ì—£ì§€ í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ìµœì†Œí™” (~80% ê°ì†Œ)

### 2. ê³ ê°€ìš©ì„± (HA)
- **Thanos Receiver**: StatefulSet 3 replicas (Hashring)
- **Prometheus HA**: 2 replicas (ì¤‘ë³µ ìˆ˜ì§‘ ë°©ì§€)
- **OpenSearch**: 3 nodes cluster
- **MinIO**: ë¶„ì‚° ëª¨ë“œ (4 nodes, erasure coding)

### 3. í™•ì¥ì„±
- **ìˆ˜í‰ í™•ì¥**: Thanos Receiver Hashringìœ¼ë¡œ ì—£ì§€ í´ëŸ¬ìŠ¤í„° ë¬´ì œí•œ í™•ì¥
- **ìˆ˜ì§ í™•ì¥**: Prometheus HA ìŠ¤í† ë¦¬ì§€ ì¦ì„¤
- **ë‹¤ìš´ìƒ˜í”Œë§**: ì¥ê¸° ë©”íŠ¸ë¦­ ì••ì¶• (raw â†’ 5m â†’ 1h)

### 4. ê²©ë¦¬ ë° ë³´ì•ˆ
- **ë©€í‹°í…Œë„Œì‹œ**: ê°€ í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ë°˜ë°˜ ë¶„í•  (Tenant A/B)
- **ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬**: NetworkPolicyë¡œ í…Œë„ŒíŠ¸ ê°„ íŠ¸ë˜í”½ ì°¨ë‹¨
- **TLS ì•”í˜¸í™”**: Remote Write, Ingress ëª¨ë‘ HTTPS

---

## ğŸ“Š í´ëŸ¬ìŠ¤í„° êµ¬ì„±

| í´ëŸ¬ìŠ¤í„° | IP | ì—­í•  | CPU | Memory | Storage | ì£¼ìš” ì»´í¬ë„ŒíŠ¸ |
|---------|-----|------|-----|--------|---------|-------------|
| **cluster-01<br/>(ì¤‘ì•™)** | 192.168.101.194 | ëª¨ë‹ˆí„°ë§ í—ˆë¸Œ | 16 cores | 32Gi | 500Gi | Thanos Receiver/Query/Store/Compactor/Ruler<br/>Prometheus HA, Grafana, OpenSearch, ArgoCD |
| **cluster-02<br/>(ê°€)** | 192.168.101.196 | ì—£ì§€ + ë©€í‹°í…Œë„Œì‹œ | 8 cores | 16Gi | 100Gi | Prometheus Agent x2 (Tenant A/B)<br/>Node Exporter, Kube-State-Metrics |
| **cluster-03<br/>(ë‚˜)** | 192.168.101.197 | ì—£ì§€ | 4 cores | 8Gi | 50Gi | Prometheus Agent<br/>Node Exporter, Kube-State-Metrics |
| **cluster-04<br/>(ë‹¤)** | 192.168.101.198 | ì—£ì§€ | 4 cores | 8Gi | 50Gi | Prometheus Agent<br/>Node Exporter, Kube-State-Metrics |

---

## ğŸ”„ ë°ì´í„° íë¦„

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant Agent as Prometheus Agent<br/>(Edge)
    participant Ingress as Nginx Ingress<br/>(Central)
    participant Receiver as Thanos Receiver<br/>(Central)
    participant TSDB as Local TSDB<br/>(Receiver)
    participant S3 as MinIO S3
    participant Query as Thanos Query

    Agent->>Agent: Scrape metrics (15s)
    Agent->>Agent: Store in WAL
    Agent->>Ingress: Remote Write (30s batch)
    Ingress->>Receiver: Forward to Receiver
    Receiver->>TSDB: Write to TSDB
    Receiver->>S3: Upload 2h blocks
    Query->>TSDB: Query recent data (<2h)
    Query->>S3: Query historical data (>2h)
```

### ë¡œê·¸ ìˆ˜ì§‘ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant Pod as Application Pod
    participant FB as Fluent-Bit<br/>(DaemonSet)
    participant OS as OpenSearch
    participant Grafana as Grafana

    Pod->>Pod: Write logs to stdout
    FB->>Pod: Tail container logs
    FB->>FB: Parse & Filter
    FB->>OS: Forward logs (HTTP)
    OS->>OS: Index & Store
    Grafana->>OS: Query logs
```

---

## ğŸ§© ì»´í¬ë„ŒíŠ¸ ì—­í• 

### Central Cluster (cluster-01)

#### Thanos Receiver
- **ì—­í• **: Remote Write ì—”ë“œí¬ì¸íŠ¸, ë©”íŠ¸ë¦­ ìˆ˜ì‹  ë° TSDB ì €ì¥
- **Replicas**: 3 (StatefulSet)
- **Replication Factor**: 3 (ê³ ê°€ìš©ì„±)
- **í¬íŠ¸**:
  - 19291 (Remote Write)
  - 10901 (gRPC - Query ì—°ë™)
  - 10902 (HTTP - ìƒíƒœ í™•ì¸)

#### Thanos Query
- **ì—­í• **: í†µí•© ì¿¼ë¦¬ ì¸í„°í˜ì´ìŠ¤ (Prometheus HA + Store í†µí•©)
- **Replicas**: 2
- **í¬íŠ¸**: 9090 (HTTP - Grafana ì—°ë™)
- **ê¸°ëŠ¥**: PromQL ì¿¼ë¦¬, Deduplication

#### Thanos Store
- **ì—­í• **: S3ì—ì„œ íˆìŠ¤í† ë¦¬ì»¬ ë©”íŠ¸ë¦­ ì¡°íšŒ
- **Replicas**: 2
- **Cache**: Index Cache (Memcached)

#### Thanos Compactor
- **ì—­í• **: S3 ë¸”ë¡ ì••ì¶• ë° ë‹¤ìš´ìƒ˜í”Œë§
- **Replicas**: 1 (StatefulSet)
- **ê¸°ëŠ¥**:
  - 2h ë¸”ë¡ â†’ 1d ë¸”ë¡ ì••ì¶•
  - Downsampling (5m, 1h resolution)

#### Thanos Ruler
- **ì—­í• **: Recording Rules ë° Alert Rules í‰ê°€
- **Replicas**: 2
- **Query Backend**: Thanos Query

#### Prometheus HA
- **ì—­í• **: ì¤‘ì•™ í´ëŸ¬ìŠ¤í„° ìì²´ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Replicas**: 2
- **Storage**: 100Gi (per replica)
- **Sidecar**: Thanos Sidecar (S3 ì—…ë¡œë“œ)

#### Grafana
- **ì—­í• **: ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ
- **Datasource**:
  - Prometheus (Thanos Query)
  - OpenSearch (ë¡œê·¸)
- **ì¸ì¦**: Admin / OAuth (Optional)

#### OpenSearch
- **ì—­í• **: ë¡œê·¸ ì €ì¥ ë° ê²€ìƒ‰
- **Nodes**: 3 (cluster)
- **Storage**: 200Gi (per node)
- **Retention**: 30d

#### ArgoCD
- **ì—­í• **: GitOps ë°°í¬ ìë™í™”
- **Applications**: 4ê°œ í´ëŸ¬ìŠ¤í„° ê°ê° ê´€ë¦¬
- **Sync Policy**: Auto (Optional)

### Edge Clusters (cluster-02, 03, 04)

#### Prometheus Agent
- **ì—­í• **: ê²½ëŸ‰ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° Remote Write
- **ë©”ëª¨ë¦¬**: ~200MB (vs Full Prometheus ~2GB)
- **ê¸°ëŠ¥**:
  - Scrape targets
  - Remote Write to Central
  - WAL ê´€ë¦¬ (ì¬ì „ì†¡)
- **ë¹„í™œì„±í™”**:
  - Local Query API
  - Alert Rules
  - Recording Rules

#### Node Exporter
- **ì—­í• **: ë…¸ë“œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (CPU, Memory, Disk, Network)
- **DaemonSet**: ëª¨ë“  ë…¸ë“œì— ë°°í¬

#### Kube-State-Metrics
- **ì—­í• **: Kubernetes ë¦¬ì†ŒìŠ¤ ë©”íŠ¸ë¦­ (Pods, Deployments, Services ë“±)
- **Replicas**: 1

---

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì²˜

### TLS/ì•”í˜¸í™”
```mermaid
graph LR
    A[Prometheus Agent] -->|HTTPS<br/>TLS 1.3| B[Nginx Ingress]
    B -->|HTTP<br/>(ë‚´ë¶€)| C[Thanos Receiver]
    C -->|HTTPS<br/>TLS| D[MinIO S3]
    E[User] -->|HTTPS<br/>TLS| B
    B -->|HTTP<br/>(ë‚´ë¶€)| F[Grafana]
```

### ì ‘ê·¼ ì œì–´
- **RBAC**: Kubernetes ë„¤ì´í‹°ë¸Œ ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´
- **NetworkPolicy**: Pod ê°„ íŠ¸ë˜í”½ ì œì–´
- **Grafana Auth**: Admin ê³„ì • + LDAP/OAuth
- **ArgoCD RBAC**: Application ë³„ ê¶Œí•œ ë¶„ë¦¬

---

## ğŸ“ˆ ë©”íŠ¸ë¦­ ë³´ì¡´ ì •ì±…

| Resolution | ì €ì¥ ìœ„ì¹˜ | ë³´ì¡´ ê¸°ê°„ | ì˜ˆìƒ í¬ê¸° (4 clusters) |
|-----------|----------|----------|---------------------|
| **Raw (15s)** | Receiver TSDB + S3 | 7ì¼ | ~350GB |
| **5m** | S3 (Downsampled) | 30ì¼ | ~75GB |
| **1h** | S3 (Downsampled) | 180ì¼ | ~36GB |
| **ì´ê³„** | - | - | **~461GB** |

---

## ğŸš€ ìŠ¤ì¼€ì¼ë§ ì „ëµ

### ì—£ì§€ í´ëŸ¬ìŠ¤í„° ì¶”ê°€ (4 â†’ 10ê°œ)
1. ArgoCD Application ìƒì„±
2. Git ì €ì¥ì†Œì— overlay ì¶”ê°€
3. Remote Write URL ì„¤ì • â†’ Thanos Receiver
4. ìë™ Sync

### Thanos Receiver í™•ì¥ (3 â†’ 5 replicas)
```bash
kubectl scale statefulset thanos-receive -n monitoring --replicas=5
```
- Hashring ìë™ ì¬ë¶„ë°°
- ê¸°ì¡´ ë°ì´í„° ìœ ì§€

### Prometheus HA Storage í™•ì¥
```bash
kubectl edit pvc prometheus-kube-prometheus-stack-prometheus-db-prometheus-kube-prometheus-stack-prometheus-0 -n monitoring
# spec.resources.requests.storage: 100Gi â†’ 200Gi
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **ë°ì´í„° íë¦„ ìƒì„¸** â†’ [ë°ì´í„°-íë¦„.md](./ë°ì´í„°-íë¦„.md)
- **ê³ ê°€ìš©ì„± ì„¤ê³„** â†’ [ê³ ê°€ìš©ì„±-ì„¤ê³„.md](./ê³ ê°€ìš©ì„±-ì„¤ê³„.md)
- **Agent vs Full Prometheus** â†’ [Agent-vs-Full-Prometheus.md](./Agent-vs-Full-Prometheus.md)

---

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-20

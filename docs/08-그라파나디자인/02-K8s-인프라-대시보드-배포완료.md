# λ² μ–΄λ©”νƒ Kubernetes μΈν”„λΌ λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ λ°°ν¬ μ™„λ£

**ν”„λ΅μ νΈλ…**: Bare-Metal K8s Infrastructure Observability
**λ°°ν¬ μΌμ‹**: 2025-11-08 04:30 (UTC)
**λ²„μ „**: v1.0

---

## β… λ°°ν¬ μ™„λ£ μ”μ•½

λ² μ–΄λ©”νƒ Kubernetes ν™κ²½μ μΈν”„λΌ λ¨λ‹ν„°λ§μ„ μ„ν• **6κ° λ€μ‹λ³΄λ“**λ¥Ό μ„±κ³µμ μΌλ΅ μƒμ„±ν•κ³  λ°°ν¬ μ™„λ£ν•μ€μµλ‹λ‹¤.

---

## π“ λ°°ν¬λ λ€μ‹λ³΄λ“ λ©λ΅

### 1. μΏ λ²„λ„¤ν‹°μ¤-01-μΈν”„λΌ-ν΄λ¬μ¤ν„° κ°μ”
- **UID**: `k8s-cluster-overview-v1`
- **μ©λ„**: λ©€ν‹° ν΄λ¬μ¤ν„° μ „μ²΄ μƒνƒ ν•λμ— νμ•…
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - μ΄ ν΄λ¬μ¤ν„° μ (4κ°)
  - μ •μƒ λ…Έλ“ λΉ„μ¨
  - μ΄ Pod μ λ° Running Pod λΉ„μ¨
  - ν΄λ¬μ¤ν„°λ³„ CPU/λ©”λ¨λ¦¬ μ‚¬μ©λ¥ 
  - Pod μƒνƒλ³„ λ¶„ν¬ (Pie Chart)
  - ν΄λ¬μ¤ν„° κ²½κ³  μ΄λ²¤νΈ

### 2. μΏ λ²„λ„¤ν‹°μ¤-02-μΈν”„λΌ-λ…Έλ“ λ¦¬μ†μ¤
- **UID**: `k8s-node-resources-v1`
- **μ©λ„**: κ° λ…Έλ“μ CPU, λ©”λ¨λ¦¬, λ””μ¤ν¬ μƒμ„Έ λ¨λ‹ν„°λ§
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - λ…Έλ“λ³„ CPU μ‚¬μ©λ¥ 
  - λ…Έλ“λ³„ λ©”λ¨λ¦¬ μ‚¬μ©λ¥ 
  - λ…Έλ“λ³„ λ””μ¤ν¬ μ‚¬μ©λ¥ 
  - Load Average (1m, 5m, 15m)
  - λ””μ¤ν¬ I/O μ‚¬μ©λ¥ 
  - λ…Έλ“ Uptime

### 3. μΏ λ²„λ„¤ν‹°μ¤-03-μΈν”„λΌ-λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§
- **UID**: `k8s-network-monitoring-v1`
- **μ©λ„**: Cilium CNI, Pod λ„¤νΈμ›ν¬, Ingress νΈλν”½ λ¨λ‹ν„°λ§
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - λ„¤νΈμ›ν¬ μμ‹ /μ „μ†΅ μ†λ„
  - Ingress μ”μ²­ μ
  - Ingress μ‘λ‹µ μ‹κ°„ (P50/P95/P99)
  - Podλ³„ λ„¤νΈμ›ν¬ νΈλν”½ (Top 10)
  - λ„¤νΈμ›ν¬ μ—λ¬

### 4. μΏ λ²„λ„¤ν‹°μ¤-04-μΈν”„λΌ-μ¤ν† λ¦¬μ§€ μ©λ‰
- **UID**: `k8s-storage-capacity-v1`
- **μ©λ„**: Longhorn λ³Όλ¥¨, PVC μ©λ‰ κ΄€λ¦¬
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - Longhorn λ³Όλ¥¨ μ
  - Longhorn μ©λ‰ μ‚¬μ©λ¥ 
  - PVC μ΄ μ©λ‰ λ° μ‚¬μ© μ¤‘ μ©λ‰
  - λ³Όλ¥¨λ³„ μ‚¬μ©λ‰ ν…μ΄λΈ”
  - PVC μ©λ‰ μ‚¬μ©λ¥  (Top 10)
  - μ¤ν† λ¦¬μ§€ IOPS

### 5. μΏ λ²„λ„¤ν‹°μ¤-05-μΈν”„λΌ-μ›ν¬λ΅λ“ ν„ν™©
- **UID**: `k8s-workload-status-v1`
- **μ©λ„**: Pod, Deployment, StatefulSet μƒνƒ μ¶”μ 
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - Running/Pending/Failed Pod μ
  - Container μ¬μ‹μ‘ λΉλ„
  - CrashLoopBackOff, ImagePullBackOff κ°μ§€
  - Deployment/StatefulSet μƒνƒ ν…μ΄λΈ”
  - Pod Phase μ¶”μ΄
  - λ¬Έμ  μλ” Pods λ©λ΅

### 6. μΏ λ²„λ„¤ν‹°μ¤-06-μΈν”„λΌ-μ„±λ¥ λ¶„μ„
- **UID**: `k8s-performance-analysis-v1`
- **μ©λ„**: λ³‘λ© μ§€μ  μ‹λ³„, μµμ ν™” κ¶μ¥μ‚¬ν•­ μ κ³µ
- **ν•µμ‹¬ λ©”νΈλ¦­**:
  - CPU Throttled Containers
  - OOMKilled Containers
  - λ…Έλ“ μ••λ°• μƒνƒ (MemoryPressure/DiskPressure)
  - λ””μ¤ν¬ I/O λ€κΈ°
  - CPU/λ©”λ¨λ¦¬ κ³Όλ‹¤ ν• λ‹Ή Container μ‹λ³„
  - **μƒμ„Έν• μµμ ν™” κ°€μ΄λ“ ν¬ν•¨**

---

## π¨ λ””μμΈ νΉμ§•

### ν†µμΌλ λ…λ… κ·μΉ™
```
μΏ λ²„λ„¤ν‹°μ¤-[λ²νΈ]-[μΉ΄ν…κ³ λ¦¬]-[μ λ©]

μμ‹:
- μΏ λ²„λ„¤ν‹°μ¤-01-μΈν”„λΌ-ν΄λ¬μ¤ν„° κ°μ”
- μΏ λ²„λ„¤ν‹°μ¤-02-μΈν”„λΌ-λ…Έλ“ λ¦¬μ†μ¤
- μΏ λ²„λ„¤ν‹°μ¤-03-μΈν”„λΌ-λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§
```

### νμ¤ν…” μƒ‰μƒ μ‹μ¤ν…
DataOps ν”„λ΅μ νΈ μ¤ν™(00-ν”„λ΅μ νΈ-μ¤ν™.md)μ νμ¤ν…”ν†¤ ν”λ νΈ μ μ©:

```css
/* Kubernetes μΈν”„λΌ μ „μ© μƒ‰μƒ */
--k8s-cluster: #B8D8F0;      /* ν΄λ¬μ¤ν„° κ°μ” - μ—°ν• νλ€μƒ‰ */
--k8s-node: #B8E5C5;         /* λ…Έλ“ λ¦¬μ†μ¤ - μ—°ν• λ…Ήμƒ‰ */
--k8s-network: #A8D8D8;      /* λ„¤νΈμ›ν¬ - μ—°ν• μ²­λ΅μƒ‰ */
--k8s-storage: #D5C9E8;      /* μ¤ν† λ¦¬μ§€ - μ—°ν• λ³΄λΌμƒ‰ */
--k8s-workload: #FFD8A8;     /* μ›ν¬λ΅λ“ - μ—°ν• μ£Όν™©μƒ‰ */
--k8s-performance: #F9D0DF;  /* μ„±λ¥ - μ—°ν• λ¶„ν™μƒ‰ */

/* μƒνƒ μƒ‰μƒ */
--status-healthy: #D5F4E6;   /* μ •μƒ - μ—°ν• λ…Ήμƒ‰ */
--status-warning: #FCF3CF;   /* κ²½κ³  - μ—°ν• λ…Έλ€μƒ‰ */
--status-critical: #FADBD8;  /* μ„ν— - μ—°ν• λΉ¨κ°„μƒ‰ */
```

### λΉ λ¥Έ λ„¤λΉ„κ²μ΄μ…
λ¨λ“  λ€μ‹λ³΄λ“μ— λΉ λ¥Έ μ΄λ™ λ§ν¬ μ κ³µ:
```
π  κ°μ” | π–¥οΈ λ…Έλ“ | π λ„¤νΈμ›ν¬ | π’Ύ μ¤ν† λ¦¬μ§€ | π“¦ μ›ν¬λ΅λ“ | β΅ μ„±λ¥
```

---

## π€ λ°°ν¬ μƒνƒ

### ConfigMap μƒμ„± ν™•μΈ
```bash
kubectl --context cluster-01 get configmap -n monitoring | grep "grafana-dashboard-k8s"
```

**κ²°κ³Ό**:
```
grafana-dashboard-k8s-cluster-overview-v1        1      μ™„λ£
grafana-dashboard-k8s-network-monitoring-v1      1      μ™„λ£
grafana-dashboard-k8s-node-resources-v1          1      μ™„λ£
grafana-dashboard-k8s-performance-analysis-v1    1      μ™„λ£
grafana-dashboard-k8s-storage-capacity-v1        1      μ™„λ£
grafana-dashboard-k8s-workload-status-v1         1      μ™„λ£
```

**μ΄ 6κ° λ€μ‹λ³΄λ“ λ¨λ‘ μ •μƒ λ°°ν¬λ¨** β…

### νμΌ μ„μΉ
```
/root/develop/thanos/deploy-new/overlays/cluster-01-central/kube-prometheus-stack/dashboards/kubernetes-infra-v1/
β”β”€β”€ 01-ν΄λ¬μ¤ν„°-κ°μ”.yaml
β”β”€β”€ 02-λ…Έλ“-λ¦¬μ†μ¤.yaml
β”β”€β”€ 03-λ„¤νΈμ›ν¬-λ¨λ‹ν„°λ§.yaml
β”β”€β”€ 04-μ¤ν† λ¦¬μ§€-μ©λ‰.yaml
β”β”€β”€ 05-μ›ν¬λ΅λ“-ν„ν™©.yaml
β””β”€β”€ 06-μ„±λ¥-λ¶„μ„.yaml
```

---

## π“ λ©”νΈλ¦­ λ°μ΄ν„° μ†μ¤

### Prometheus Exporters

| Exporter | λ©”νΈλ¦­ | μ©λ„ |
|----------|--------|------|
| **node-exporter** | node_cpu, node_memory, node_disk, node_network | λ…Έλ“ λ¦¬μ†μ¤ λ©”νΈλ¦­ |
| **kube-state-metrics** | kube_pod, kube_node, kube_deployment, kube_statefulset | Kubernetes λ¦¬μ†μ¤ μƒνƒ |
| **cadvisor** | container_cpu, container_memory, container_network | Container λ¦¬μ†μ¤ μ‚¬μ©λ‰ |
| **Longhorn** | longhorn_volume, longhorn_node_storage | μ¤ν† λ¦¬μ§€ λ³Όλ¥¨ λ©”νΈλ¦­ |
| **Ingress Nginx** | nginx_ingress_controller_requests, nginx_ingress_controller_request_duration_seconds | HTTP νΈλν”½ λ©”νΈλ¦­ |

### Thanos ν†µν•©
- β… λ©€ν‹° ν΄λ¬μ¤ν„° λ©”νΈλ¦­ μ§‘κ³„ (cluster-01/02/03/04)
- β… μ¥κΈ° λ©”νΈλ¦­ λ³΄κ΄€ (S3 μ¤ν† λ¦¬μ§€)
- β… κΈ€λ΅λ² μΏΌλ¦¬ μΈν„°νμ΄μ¤

---

## π Grafana μ ‘μ† μ •λ³΄

**URL**: http://grafana.k8s-cluster-01.miribit.lab
**Username**: admin
**Password**: admin123

### λ€μ‹λ³΄λ“ μ°ΎκΈ°
1. Grafana μ ‘μ†
2. μ™Όμ½ λ©”λ‰΄ β†’ **Dashboards** ν΄λ¦­
3. κ²€μƒ‰μ°½μ— **"μΏ λ²„λ„¤ν‹°μ¤"** λλ” **"kubernetes"** λλ” **"infra"** μ…λ ¥
4. 6κ° λ€μ‹λ³΄λ“κ°€ ν‘μ‹λ¨:
   - μΏ λ²„λ„¤ν‹°μ¤-01-μΈν”„λΌ-ν΄λ¬μ¤ν„° κ°μ”
   - μΏ λ²„λ„¤ν‹°μ¤-02-μΈν”„λΌ-λ…Έλ“ λ¦¬μ†μ¤
   - μΏ λ²„λ„¤ν‹°μ¤-03-μΈν”„λΌ-λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§
   - μΏ λ²„λ„¤ν‹°μ¤-04-μΈν”„λΌ-μ¤ν† λ¦¬μ§€ μ©λ‰
   - μΏ λ²„λ„¤ν‹°μ¤-05-μΈν”„λΌ-μ›ν¬λ΅λ“ ν„ν™©
   - μΏ λ²„λ„¤ν‹°μ¤-06-μΈν”„λΌ-μ„±λ¥ λ¶„μ„

---

## π“ μ£Όμ” ν™μ© μ‹λ‚λ¦¬μ¤

### 1. ν΄λ¬μ¤ν„° μ „μ²΄ μƒνƒ ν™•μΈ
β†’ **01-ν΄λ¬μ¤ν„° κ°μ”** λ€μ‹λ³΄λ“ μ‚¬μ©
- 4κ° ν΄λ¬μ¤ν„°μ μ „μ²΄ μƒνƒ ν•λμ— νμ•…
- ν΄λ¬μ¤ν„°λ³„ CPU/λ©”λ¨λ¦¬ μ‚¬μ©λ¥  λΉ„κµ
- κ²½κ³  μ΄λ²¤νΈ μ¦‰μ‹ ν™•μΈ

### 2. λ…Έλ“ λ¦¬μ†μ¤ λ¶€μ΅± κ°μ§€
β†’ **02-λ…Έλ“ λ¦¬μ†μ¤** λ€μ‹λ³΄λ“ μ‚¬μ©
- λ…Έλ“λ³„ CPU/λ©”λ¨λ¦¬ μ‚¬μ©λ¥  μ¶”μ 
- Load Average λ¨λ‹ν„°λ§
- λ””μ¤ν¬ κ³µκ°„ λ¶€μ΅± μμΈ΅

### 3. λ„¤νΈμ›ν¬ νΈλν”½ λ¶„μ„
β†’ **03-λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§** λ€μ‹λ³΄λ“ μ‚¬μ©
- Podλ³„ λ„¤νΈμ›ν¬ νΈλν”½ Top 10 ν™•μΈ
- Ingress μ‘λ‹µ μ‹κ°„ λ¨λ‹ν„°λ§
- λ„¤νΈμ›ν¬ μ—λ¬ κ°μ§€

### 4. μ¤ν† λ¦¬μ§€ μ©λ‰ κ³„ν
β†’ **04-μ¤ν† λ¦¬μ§€ μ©λ‰** λ€μ‹λ³΄λ“ μ‚¬μ©
- Longhorn λ³Όλ¥¨ μ‚¬μ©λ¥  μ¶”μ 
- PVC μ©λ‰ μ¦μ„¤ μ‹μ  μμΈ΅
- μ¤ν† λ¦¬μ§€ IOPS λ³‘λ© ν™•μΈ

### 5. Pod μ¥μ•  λ€μ‘
β†’ **05-μ›ν¬λ΅λ“ ν„ν™©** λ€μ‹λ³΄λ“ μ‚¬μ©
- CrashLoopBackOff, ImagePullBackOff μ¦‰μ‹ κ°μ§€
- Deployment/StatefulSet μƒνƒ ν™•μΈ
- Container μ¬μ‹μ‘ ν¨ν„΄ λ¶„μ„

### 6. μ„±λ¥ μµμ ν™”
β†’ **06-μ„±λ¥ λ¶„μ„** λ€μ‹λ³΄λ“ μ‚¬μ©
- CPU Throttling λ°μƒ Container μ‹λ³„
- OOMKilled Container λ©”λ¨λ¦¬ μ¦μ„¤
- κ³Όλ‹¤ ν• λ‹Ήλ λ¦¬μ†μ¤ μµμ ν™”
- **μƒμ„Έν• μµμ ν™” κ°€μ΄λ“ μ°Έκ³ **

---

## π― μ•λ¦Ό μ„¤μ • κ¶μ¥μ‚¬ν•­

### Critical (μ¦‰μ‹ μ•λ¦Ό)
```promql
# λ…Έλ“ Down
count(kube_node_status_condition{condition="Ready",status="true"}) < 3

# Pod μ¥μ• 
count(kube_pod_status_phase{phase="Failed"}) > 5

# OOMKilled
count(kube_pod_container_status_terminated_reason{reason="OOMKilled"}) > 0

# λ””μ¤ν¬ μ‚¬μ©λ¥  95% μ΄μƒ
(node_filesystem_size_bytes{mountpoint="/"} - node_filesystem_free_bytes{mountpoint="/"}) / node_filesystem_size_bytes{mountpoint="/"} > 0.95
```

### Warning (μ£Όμ μ•λ¦Ό)
```promql
# CPU μ‚¬μ©λ¥  85% μ΄μƒ
(1 - avg(rate(node_cpu_seconds_total{mode="idle"}[5m]))) * 100 > 85

# λ©”λ¨λ¦¬ μ‚¬μ©λ¥  90% μ΄μƒ
(1 - avg(node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 90

# Pending Pods
count(kube_pod_status_phase{phase="Pending"}) > 5

# Longhorn μ©λ‰ 80% μ΄μƒ
sum(longhorn_volume_actual_size_bytes) / sum(longhorn_node_storage_capacity_bytes) * 100 > 80
```

---

## π”§ μ μ§€λ³΄μ κ°€μ΄λ“

### λ€μ‹λ³΄λ“ μ—…λ°μ΄νΈ
```bash
# 1. YAML νμΌ μμ •
vi /root/develop/thanos/deploy-new/overlays/cluster-01-central/kube-prometheus-stack/dashboards/kubernetes-infra-v1/01-ν΄λ¬μ¤ν„°-κ°μ”.yaml

# 2. ConfigMap μ¬μ μ©
kubectl --context cluster-01 apply -f /root/develop/thanos/deploy-new/overlays/cluster-01-central/kube-prometheus-stack/dashboards/kubernetes-infra-v1/

# 3. Grafana μ¬μ‹μ‘
kubectl --context cluster-01 rollout restart deployment -n monitoring kube-prometheus-stack-grafana

# 4. Git μ»¤λ°‹
git add .
git commit -m "fix: λ€μ‹λ³΄λ“ μμ •"
git push origin main
```

### μƒ λ©”νΈλ¦­ μ¶”κ°€
1. Exporter λ°°ν¬ ν™•μΈ
2. ServiceMonitor μƒμ„±
3. PromQL μΏΌλ¦¬ μ‘μ„± λ° ν…μ¤νΈ
4. λ€μ‹λ³΄λ“ ν¨λ„ μ¶”κ°€
5. Git μ»¤λ°‹/ν‘Έμ‹

---

## π“ μ°Έκ³  λ¬Έμ„

- [λ² μ–΄λ©”νƒ K8s μΈν”„λΌ μ¤ν™](./01-λ² μ–΄λ©”νƒ-K8s-μΈν”„λΌ-μ¤ν™.md) - μƒμ„Έ μ„¤κ³„μ„
- [DataOps ν”„λ΅μ νΈ μ¤ν™](./00-ν”„λ΅μ νΈ-μ¤ν™.md) - μƒ‰μƒ μ‹μ¤ν… λ° μ „μ²΄ μ•„ν‚¤ν…μ²
- [Prometheus PromQL κ°€μ΄λ“](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [Grafana Dashboard κ°€μ΄λ“](https://grafana.com/docs/grafana/latest/dashboards/)

---

## β… κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ

- [x] 6κ° λ€μ‹λ³΄λ“ λ¨λ‘ μƒμ„± μ™„λ£
- [x] ConfigMap λ°°ν¬ μ™„λ£
- [x] Grafana μ¬μ‹μ‘ μ™„λ£
- [x] λ…λ… κ·μΉ™ μ¤€μ (μΏ λ²„λ„¤ν‹°μ¤-[λ²νΈ]-[μΉ΄ν…κ³ λ¦¬]-[μ λ©])
- [x] νμ¤ν…” μƒ‰μƒ μ‹μ¤ν… μ μ©
- [x] λΉ λ¥Έ λ„¤λΉ„κ²μ΄μ… λ§ν¬ μ¶”κ°€
- [x] ν•κΈ€ μ„¤λ… λ° κ°€μ΄λ“ μ‘μ„±
- [x] Git μ»¤λ°‹ λ° ν‘Έμ‹ μ™„λ£
- [x] λ¬Έμ„ν™” μ™„λ£

---

## π‰ κ²°λ΅ 

β… **λ² μ–΄λ©”νƒ Kubernetes μΈν”„λΌ λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ 6κ°λ¥Ό μ„±κ³µμ μΌλ΅ μƒμ„± λ° λ°°ν¬ μ™„λ£**

- λ©€ν‹° ν΄λ¬μ¤ν„° μ „μ²΄ μƒνƒλ¥Ό ν•λμ— νμ•… κ°€λ¥
- λ…Έλ“, λ„¤νΈμ›ν¬, μ¤ν† λ¦¬μ§€, μ›ν¬λ΅λ“, μ„±λ¥ μμ—­λ³„ μƒμ„Έ λ¨λ‹ν„°λ§
- νμ¤ν…” μƒ‰μƒ μ‹μ¤ν…μΌλ΅ λμ ν”Όλ΅λ„ μµμ†ν™”
- ν†µμΌλ λ…λ… κ·μΉ™μΌλ΅ λ€μ‹λ³΄λ“ κ΄€λ¦¬ μ©μ΄
- μƒμ„Έν• μµμ ν™” κ°€μ΄λ“λ΅ μ„±λ¥ κ°μ„  μ§€μ›

**μ ‘μ†**: http://grafana.k8s-cluster-01.miribit.lab (admin / admin123)

---

**μ‘μ„±μ**: Platform Engineering Team
**μµμΆ… μμ •**: 2025-11-08
**λ²„μ „**: 1.0

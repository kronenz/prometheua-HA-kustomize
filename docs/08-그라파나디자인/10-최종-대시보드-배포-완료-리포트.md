# DataOps Lifecycle Dashboard v2 - ìµœì¢… ë°°í¬ ì™„ë£Œ ë¦¬í¬íŠ¸

## ğŸ“Š ê°œìš”
DataOps Lifecycle Dashboard v2ì˜ ArgoCD ë° Jenkins ë©”íŠ¸ë¦­ ìˆ˜ì§‘ êµ¬ì„± ë° Rollback & Config Drift íŒ¨ë„ êµ¬í˜„ ì™„ë£Œ

**Dashboard ID**: `/d/dataops-lifecycle-v2`
**ì‘ì—… ê¸°ê°„**: 2025-11-11
**ìµœì¢… ìƒíƒœ**: âœ… ëª¨ë“  íŒ¨ë„ì—ì„œ ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° í‘œì‹œ ì¤‘

---

## ğŸ¯ ì‘ì—… ì™„ë£Œ í•­ëª©

### 1. ArgoCD ë©”íŠ¸ë¦­ ìˆ˜ì§‘ âœ…
#### ServiceMonitor ë°°í¬
- **íŒŒì¼**: `/root/develop/thanos/deploy-new/base/kube-prometheus-stack/servicemonitors/argocd-metrics.yaml`
- **êµ¬ì„±ëœ ì»´í¬ë„ŒíŠ¸** (5ê°œ):
  1. argocd-application-controller (Port: 8082)
  2. argocd-repo-server (Port: 8084)
  3. argocd-server (Port: 8083)
  4. argocd-applicationset-controller (Port: 8080)
  5. argocd-dex-server (Port: 5558)

#### ìˆ˜ì§‘ ì¤‘ì¸ ë©”íŠ¸ë¦­
- `argocd_app_info`: ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ì •ë³´ (19ê°œ ì•±)
- `argocd_app_sync_total`: Sync ì‘ì—… ì´ íšŸìˆ˜ (5,090íšŒ/24h)
- `argocd_app_reconcile_bucket`: Reconcile ì‹œê°„ ë¶„í¬
- `argocd_cluster_connection_status`: í´ëŸ¬ìŠ¤í„° ì—°ê²° ìƒíƒœ

#### ê²€ì¦ ê²°ê³¼
```yaml
Applications: 19ê°œ
Out of Sync: 4ê°œ
  - prometheus-agent-cluster-02
  - prometheus-agent-cluster-03
  - prometheus-agent-cluster-04
  - thanos-receiver
Sync Success Rate: 99.98%
Average Reconcile Time: 0.42ì´ˆ
Total Syncs (24h): 5,090íšŒ
```

### 2. Jenkins ë°°í¬ ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘ âœ…
#### Jenkins ë°°í¬
- **Method**: Helm Chart + Kustomize
- **Namespace**: jenkins
- **ë²„ì „**: 2.479.1-lts-jdk17
- **Ingress**: jenkins.k8s-cluster-01.miribit.lab
- **Admin**: admin / admin123!

#### Pipeline Jobs ìƒì„± (3ê°œ)
1. **dataops-build-pipeline**
   - Trigger: H/5 * * * * (5ë¶„ë§ˆë‹¤)
   - Duration: ~14ì´ˆ
   - Status: ì„±ê³µ

2. **dataops-test-pipeline**
   - Trigger: H/5 * * * * (5ë¶„ë§ˆë‹¤)
   - Duration: ~14ì´ˆ
   - Status: ì„±ê³µ

3. **dataops-deploy-pipeline**
   - Trigger: ìˆ˜ë™
   - Duration: ê°€ë³€
   - Status: ëœë¤ ì‹¤íŒ¨ ì„¤ì •

#### ServiceMonitor ë°°í¬
- **íŒŒì¼**: `/root/develop/thanos/deploy-new/base/kube-prometheus-stack/servicemonitors/jenkins-metrics.yaml`
- **Endpoint**: http://jenkins.jenkins.svc.cluster.local:8080/prometheus/
- **Interval**: 30s

#### ìˆ˜ì§‘ ì¤‘ì¸ ë©”íŠ¸ë¦­
```yaml
Build Metrics:
  - jenkins_runs_success_total: 4
  - jenkins_runs_total_total: 4
  - jenkins_runs_failure_total: 0

Duration Metrics:
  - jenkins_job_total_duration{quantile="0.5"}: 13.9ì´ˆ
  - jenkins_job_total_duration{quantile="0.95"}: 13.9ì´ˆ
  - jenkins_job_total_duration{quantile="0.99"}: 20.5ì´ˆ

Job-specific Metrics:
  - default_jenkins_builds_total_build_count_total{jenkins_job="dataops-build-pipeline"}: 2
  - default_jenkins_builds_total_build_count_total{jenkins_job="dataops-test-pipeline"}: 2

Queue Metrics:
  - jenkins_queue_size_value: 0
  - jenkins_executor_free_value: 0
  - jenkins_executor_count_value: 0
```

### 3. Dashboard íŒ¨ë„ ì—…ë°ì´íŠ¸ âœ…

#### GitOps ì„¹ì…˜ (ArgoCD)
1. **Applications í˜„í™©** - Stat
   ```promql
   count(argocd_app_info)
   # Value: 19
   ```

2. **Out of Sync Applications** - Stat
   ```promql
   count(argocd_app_info{sync_status="OutOfSync"})
   # Value: 4
   ```

3. **Sync ì„±ê³µë¥ ** - Gauge
   ```promql
   sum(rate(argocd_app_sync_total{phase="Succeeded"}[24h])) /
   sum(rate(argocd_app_sync_total[24h])) * 100
   # Value: 99.98%
   ```

4. **í‰ê·  Sync ì‹œê°„** - Stat
   ```promql
   avg(rate(argocd_app_reconcile_sum[5m]) / rate(argocd_app_reconcile_count[5m]))
   # Value: 0.42s
   ```

5. **Application Sync ìƒíƒœ ì¶”ì´** - Time Series
   ```promql
   count by (sync_status) (argocd_app_info)
   ```

6. **Sync ì‘ì—… ë¹ˆë„** - Time Series
   ```promql
   sum(rate(argocd_app_sync_total[5m]))
   # Value: 5,090 syncs/24h
   ```

#### Jenkins CI Pipeline ì„¹ì…˜
1. **Jenkins ë¹Œë“œ ì„±ê³µ/ì‹¤íŒ¨ ì¶”ì´** - Time Series
   ```promql
   rate(jenkins_runs_success_total[5m])  # Success
   rate(jenkins_runs_failure_total[5m])  # Failure
   ```

2. **Jenkins ë¹Œë“œ Duration (P50/P95/P99)** - Time Series
   ```promql
   jenkins_job_total_duration{quantile="0.5"}   # P50: 13.9s
   jenkins_job_total_duration{quantile="0.95"}  # P95: 13.9s
   jenkins_job_total_duration{quantile="0.99"}  # P99: 20.5s
   ```

3. **Jenkins í ìƒíƒœ** - Stat
   ```promql
   jenkins_queue_size_value
   ```

4. **ìµœê·¼ Jenkins ë¹Œë“œ ë‚´ì—­** - Table
   ```promql
   default_jenkins_builds_total_build_count_total
   ```

#### Rollback & Config Drift ì„¹ì…˜ âœ… (ì‹ ê·œ êµ¬í˜„)
1. **Config Drift ê°ì§€** - Stat
   ```promql
   count(argocd_app_info{sync_status="OutOfSync"})
   # Value: 4
   # Thresholds:
   #   Green: 0
   #   Yellow: 1-4
   #   Red: 5+
   ```

2. **ìµœê·¼ Rollback ë‚´ì—­** - Table
   ```promql
   argocd_app_info{sync_status="OutOfSync"}
   # Columns:
   #   - Application
   #   - Sync Status
   #   - Health
   #   - Cluster
   #   - Namespace
   #   - Repository
   ```

   **í˜„ì¬ í‘œì‹œë˜ëŠ” Out of Sync ì•±**:
   | Application | Sync Status | Health | Cluster |
   |------------|-------------|--------|---------|
   | prometheus-agent-cluster-02 | OutOfSync | Healthy | 192.168.101.196:6443 |
   | prometheus-agent-cluster-03 | OutOfSync | Healthy | 192.168.101.197:6443 |
   | prometheus-agent-cluster-04 | OutOfSync | Healthy | 192.168.101.198:6443 |
   | thanos-receiver | OutOfSync | Healthy | kubernetes.default.svc |

---

## ğŸ”§ ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### Prometheus Target ìƒíƒœ
```yaml
ArgoCD Targets (5/5 UP):
  - argocd-application-controller: UP (10.0.0.131:8082)
  - argocd-repo-server: UP (10.0.0.30:8084)
  - argocd-server: UP (10.0.0.83:8083)
  - argocd-applicationset-controller: UP (10.0.0.114:8080)
  - argocd-dex-server: UP (10.0.0.45:5558)

Jenkins Target (1/1 UP):
  - jenkins: UP (10.0.0.6:8080/prometheus/)
```

### ServiceMonitor ì„¤ì •
```yaml
ArgoCD ServiceMonitors:
  Interval: 30s
  Timeout: 10s
  Path: /metrics
  Selector:
    app.kubernetes.io/name: argocd-metrics

Jenkins ServiceMonitor:
  Interval: 30s
  Timeout: 10s
  Path: /prometheus/
  Selector:
    app.kubernetes.io/component: jenkins-controller
    app.kubernetes.io/name: jenkins
```

### Jenkins Job íŒŒì¼ ìœ„ì¹˜
```bash
/var/jenkins_home/jobs/
â”œâ”€â”€ dataops-build-pipeline/
â”‚   â””â”€â”€ config.xml
â”œâ”€â”€ dataops-test-pipeline/
â”‚   â””â”€â”€ config.xml
â””â”€â”€ dataops-deploy-pipeline/
    â””â”€â”€ config.xml
```

---

## ğŸ“ˆ ë©”íŠ¸ë¦­ ìƒ˜í”Œ ë°ì´í„°

### ArgoCD ë©”íŠ¸ë¦­ ì˜ˆì‹œ
```promql
# Application ìƒíƒœ
argocd_app_info{
  name="prometheus-agent-cluster-02",
  sync_status="OutOfSync",
  health_status="Healthy",
  dest_server="https://192.168.101.196:6443"
} 1

# Sync ì‘ì—… ì¹´ìš´íŠ¸
argocd_app_sync_total{phase="Succeeded"} 5090

# Reconcile ì‹œê°„
argocd_app_reconcile_sum / argocd_app_reconcile_count = 0.42s
```

### Jenkins ë©”íŠ¸ë¦­ ì˜ˆì‹œ
```promql
# ë¹Œë“œ ì„±ê³µ ì¹´ìš´íŠ¸
jenkins_runs_success_total 4

# Jobë³„ ë¹Œë“œ íšŸìˆ˜
default_jenkins_builds_total_build_count_total{
  jenkins_job="dataops-build-pipeline"
} 2

# P99 ë¹Œë“œ ì‹œê°„
jenkins_job_total_duration{quantile="0.99"} 20.462
```

---

## ğŸš€ Dashboard ì ‘ì† ì •ë³´

### Grafana ì ‘ì†
- **URL**: http://grafana.k8s-cluster-01.miribit.lab
- **Dashboard**: DataOps Lifecycle v2
- **UID**: dataops-lifecycle-v2

### Jenkins ì ‘ì†
- **URL**: http://jenkins.k8s-cluster-01.miribit.lab
- **Username**: admin
- **Password**: admin123!

### ArgoCD ì ‘ì†
- **URL**: http://argocd.k8s-cluster-01.miribit.lab
- **Applications**: 19ê°œ ëª¨ë‹ˆí„°ë§ ì¤‘

---

## ğŸ“Š ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í˜„í™© ìš”ì•½

| Component | Status | Metrics Count | Last Scrape | Interval |
|-----------|--------|---------------|-------------|----------|
| ArgoCD Application Controller | âœ… UP | 50+ | ì„±ê³µ (3.8ms) | 30s |
| ArgoCD Repo Server | âœ… UP | 30+ | ì„±ê³µ (2.2ms) | 30s |
| ArgoCD Server | âœ… UP | 40+ | ì„±ê³µ (2.5ms) | 30s |
| ArgoCD ApplicationSet | âœ… UP | 20+ | ì„±ê³µ (2.0ms) | 30s |
| Jenkins | âœ… UP | 80+ | ì„±ê³µ (7.8ms) | 30s |

---

## âœ… ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### ArgoCD
- [x] ServiceMonitor 5ê°œ ë°°í¬ ì™„ë£Œ
- [x] Prometheus Target ëª¨ë‘ UP ìƒíƒœ
- [x] 19ê°œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì¤‘
- [x] Sync ì„±ê³µë¥  99.98% í™•ì¸
- [x] Dashboard íŒ¨ë„ ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ

### Jenkins
- [x] Jenkins Helm ë°°í¬ ì™„ë£Œ
- [x] 3ê°œ Pipeline Job ìƒì„± ë° ì‹¤í–‰
- [x] ServiceMonitor ë°°í¬ ë° Target UP
- [x] Build/Duration/Queue ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [x] Dashboard íŒ¨ë„ ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ

### Rollback & Config Drift
- [x] Config Drift íŒ¨ë„ êµ¬í˜„ (4ê°œ OutOfSync ì•± í‘œì‹œ)
- [x] Rollback ë‚´ì—­ í…Œì´ë¸” êµ¬í˜„ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)
- [x] Threshold ì„¤ì • (Green/Yellow/Red)
- [x] ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸

---

## ğŸ“ ê´€ë ¨ íŒŒì¼

### ë°°í¬ íŒŒì¼
- ArgoCD ServiceMonitors: `/root/develop/thanos/deploy-new/base/kube-prometheus-stack/servicemonitors/argocd-metrics.yaml`
- Jenkins ServiceMonitor: `/root/develop/thanos/deploy-new/base/kube-prometheus-stack/servicemonitors/jenkins-metrics.yaml`
- Jenkins Values: `/root/develop/thanos/deploy-new/base/jenkins/values.yaml`
- Jenkins Kustomization: `/root/develop/thanos/deploy-new/base/jenkins/kustomization.yaml`

### Job ì •ì˜ íŒŒì¼
- Success Pipeline: `/tmp/test-pipeline-job.xml`
- Failure Pipeline: `/tmp/test-failure-pipeline-job.xml`
- Job Creator: `/tmp/jenkins-job-creator.yaml`

### ë¬¸ì„œ
- PromQL ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/promql-namespace-resources.md`
- ArgoCD ë°°í¬ ê°€ì´ë“œ: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/05-ArgoCD-Metrics-ë°°í¬ê°€ì´ë“œ.md`
- ArgoCD ë°°í¬ ì™„ë£Œ: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/06-ArgoCD-Metrics-ë°°í¬ì™„ë£Œ.md`
- Jenkins ë°°í¬ ì™„ë£Œ: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/07-Jenkins-ë°°í¬-ë°-ë©”íŠ¸ë¦­-ìˆ˜ì§‘-ì™„ë£Œ.md`
- ë©”íŠ¸ë¦­ ê²€ì¦: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/08-ìµœì¢…-ë©”íŠ¸ë¦­-ê²€ì¦-ë¦¬í¬íŠ¸.md`
- Jenkins Job ìƒì„±: `docs/08-ê·¸ë¼íŒŒë‚˜ë””ìì¸/09-Jenkins-Job-ìƒì„±-ë°-ë©”íŠ¸ë¦­-ê²€ì¦.md`

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­

### 1. ë©”íŠ¸ë¦­ í™•ì¥
- [ ] Jenkins Jobë³„ ìƒì„¸ ë©”íŠ¸ë¦­ ì¶”ê°€
- [ ] ArgoCD Rollback ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹
- [ ] Application ë°°í¬ ë¹ˆë„ ë¶„ì„

### 2. ì•ŒëŒ ì„¤ì •
- [ ] Config Drift 5ê°œ ì´ìƒ ì‹œ Alert
- [ ] Jenkins ë¹Œë“œ ì‹¤íŒ¨ 3íšŒ ì—°ì† ì‹œ Alert
- [ ] ArgoCD Sync ì‹¤íŒ¨ ì‹œ Alert

### 3. Dashboard ê°œì„ 
- [ ] Jobë³„ ë¹Œë“œ íˆìŠ¤í† ë¦¬ ì¶”ì´ ê·¸ë˜í”„
- [ ] Clusterë³„ Application ë¶„í¬
- [ ] ë°°í¬ ì£¼ê¸° ë¶„ì„ íŒ¨ë„

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡

### ë¬¸ì œ 1: ArgoCD ServiceMonitor Selector ë¶ˆì¼ì¹˜
**ì¦ìƒ**: Prometheus Targetì— argocd-application-controllerê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ
**ì›ì¸**: ServiceMonitor selectorê°€ `argocd-application-controller`ë¥¼ ì°¾ê³  ìˆì—ˆìœ¼ë‚˜ ì‹¤ì œ ì„œë¹„ìŠ¤ labelì€ `argocd-metrics`
**í•´ê²°**:
```yaml
# Before
selector:
  matchLabels:
    app.kubernetes.io/name: argocd-application-controller

# After
selector:
  matchLabels:
    app.kubernetes.io/name: argocd-metrics
```

### ë¬¸ì œ 2: Jenkins API CSRF Token
**ì¦ìƒ**: Job ìƒì„± ì‹œ 403 Forbidden ì—ëŸ¬
**ì›ì¸**: Jenkins CSRF ë³´í˜¸ë¡œ ì¸í•œ API í˜¸ì¶œ ì°¨ë‹¨
**í•´ê²°**: Jenkins filesystemì— ì§ì ‘ config.xml ìƒì„± í›„ Pod ì¬ì‹œì‘

### ë¬¸ì œ 3: Dashboard Config Drift ë©”íŠ¸ë¦­ ì´ë¦„ ì˜¤ë¥˜
**ì¦ìƒ**: Config Drift íŒ¨ë„ì— ë°ì´í„° ì—†ìŒ
**ì›ì¸**: `argocd_app_sync_status` ë©”íŠ¸ë¦­ ì‚¬ìš© (ì¡´ì¬í•˜ì§€ ì•ŠìŒ)
**í•´ê²°**: `argocd_app_info{sync_status="OutOfSync"}` ë©”íŠ¸ë¦­ìœ¼ë¡œ ë³€ê²½

---

## ğŸ“ ìµœì¢… í™•ì¸
- âœ… ëª¨ë“  Prometheus Target UP ìƒíƒœ
- âœ… ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì¤‘
- âœ… Dashboard ëª¨ë“  íŒ¨ë„ ë°ì´í„° í‘œì‹œ
- âœ… ArgoCD 19ê°œ ì•± ëª¨ë‹ˆí„°ë§
- âœ… Jenkins 3ê°œ Job ì‹¤í–‰ ì¤‘
- âœ… Config Drift 4ê°œ ê°ì§€
- âœ… ë¬¸ì„œí™” ì™„ë£Œ

**ì‘ì—… ì™„ë£Œ ì‹œê°**: 2025-11-11 13:46 UTC
**ì‘ì—…ì**: Claude (Anthropic)
**ê²€ì¦ ìƒíƒœ**: âœ… ì™„ë£Œ

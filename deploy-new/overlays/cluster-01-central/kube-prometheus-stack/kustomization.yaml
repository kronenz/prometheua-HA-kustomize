# ============================================================================
# Cluster-01 Central Kustomization
# ============================================================================
# 중앙 클러스터 배포 구성:
# - Prometheus Full Mode + Remote Write
# - Grafana, Alertmanager
# - Thanos 컴포넌트는 별도 디렉토리에서 Bitnami Helm chart로 배포
# ============================================================================

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: monitoring

# ============================================================================
# 추가 리소스
# ============================================================================
resources:
  # S3 TLS 인증서 Secret
  # Prometheus Thanos Sidecar 사용 시 S3 HTTPS 연결을 위한 CA 인증서
  # 현재는 Remote Write 패턴이지만 향후 Sidecar 전환 대비
  - s3-tls-secret.yaml

  # Grafana 대시보드 ConfigMaps
  # Grafana Sidecar가 자동으로 검색하여 로드
  # label: grafana_dashboard: '1' 필수
  - dashboards/grafana-dashboard-multi-cluster-overview.yaml
  - dashboards/grafana-dashboard-ops-main-navigation.yaml
  - dashboards/grafana-dashboard-ops-nav-dataplatform.yaml
  - dashboards/grafana-dashboard-ops-nav-infrastructure.yaml
  - dashboards/grafana-dashboard-ops-nav-kubernetes.yaml
  - dashboards/grafana-dashboard-ops-nav-monitoring.yaml
  - dashboards/grafana-dashboard-stable-nav.yaml
  - dashboards/grafana-dashboard-k8s-resources-cluster-patch.yaml

# ============================================================================
# Helm Chart 배포 (Base values + Central override)
# ============================================================================
helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    version: "78.5.0"
    releaseName: kube-prometheus-stack
    namespace: monitoring
    valuesInline:
      # Base values에서 가져온 공통 설정
      prometheusOperator:
        enabled: true
      prometheus:
        enabled: true
        prometheusSpec:
          serviceMonitorSelectorNilUsesHelmValues: false
          podMonitorSelectorNilUsesHelmValues: false
      alertmanager:
        enabled: true
      grafana:
        enabled: true
      kube-state-metrics:
        enabled: true
      prometheus-node-exporter:
        enabled: true
    valuesFile: values-central.yaml
    includeCRDs: false

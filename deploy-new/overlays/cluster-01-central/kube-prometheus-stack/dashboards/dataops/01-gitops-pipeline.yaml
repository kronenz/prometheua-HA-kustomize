apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-dataops-gitops-pipeline
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  dataops-gitops-pipeline.json: |
    {
      "uid": "dataops-gitops-pipeline",
      "title": "ğŸ”„ DataOps - GitOps ë°°í¬ íŒŒì´í”„ë¼ì¸",
      "tags": ["dataops", "gitops", "jenkins", "argocd"],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 1,
      "refresh": "30s",
      "editable": true,
      "panels": [
        {
          "type": "text",
          "title": "ğŸ“Š GitOps ë°°í¬ íŒŒì´í”„ë¼ì¸ ê°œìš”",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "options": {
            "mode": "html",
            "content": "<div style='padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;'><h2 style='margin:0'>ğŸ”„ GitOps ë°°í¬ íŒŒì´í”„ë¼ì¸ ëª¨ë‹ˆí„°ë§</h2><p style='margin-top:10px; font-size:16px'>Portal â†’ Bitbucket â†’ Jenkins â†’ ArgoCD â†’ Kubernetes ì „ì²´ ë°°í¬ íë¦„ ëª¨ë‹ˆí„°ë§</p><div style='margin-top:15px; display:flex; justify-content:space-around;'><div><strong>í˜„ì¬ ë¹Œë“œ</strong><br/><span style='font-size:24px'>{{jenkins_running_builds}}</span></div><div><strong>ë°°í¬ ì¤‘</strong><br/><span style='font-size:24px'>{{argocd_syncing}}</span></div><div><strong>ì„±ê³µë¥  (24h)</strong><br/><span style='font-size:24px'>{{pipeline_success_rate}}%</span></div><div><strong>í‰ê·  ë°°í¬ ì‹œê°„</strong><br/><span style='font-size:24px'>{{avg_deploy_time}}m</span></div></div></div>"
          }
        },
        {
          "type": "stat",
          "title": "Jenkins ë¹Œë“œ ì„±ê³µë¥  (24h)",
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 4},
          "targets": [{
            "expr": "sum(rate(jenkins_builds_success_total[24h])) / sum(rate(jenkins_builds_total[24h])) * 100",
            "refId": "A"
          }],
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"]},
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "value",
            "graphMode": "area"
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "red"},
                  {"value": 90, "color": "yellow"},
                  {"value": 95, "color": "green"}
                ]
              }
            }
          }
        },
        {
          "type": "stat",
          "title": "ArgoCD Sync ì„±ê³µë¥  (24h)",
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 4},
          "targets": [{
            "expr": "sum(rate(argocd_app_sync_status{status=\"Succeeded\"}[24h])) / sum(rate(argocd_app_sync_status[24h])) * 100",
            "refId": "A"
          }],
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"]},
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "value",
            "graphMode": "area"
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "red"},
                  {"value": 95, "color": "yellow"},
                  {"value": 99, "color": "green"}
                ]
              }
            }
          }
        },
        {
          "type": "stat",
          "title": "Pod Readiness ì‹œê°„ (P95)",
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 4},
          "targets": [{
            "expr": "histogram_quantile(0.95, sum(rate(kube_pod_start_time_seconds_bucket[1h])) by (le))",
            "refId": "A"
          }],
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"]},
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "value",
            "graphMode": "area"
          },
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "green"},
                  {"value": 60, "color": "yellow"},
                  {"value": 120, "color": "red"}
                ]
              }
            }
          }
        },
        {
          "type": "stat",
          "title": "ì „ì²´ íŒŒì´í”„ë¼ì¸ í‰ê·  ì‹œê°„",
          "gridPos": {"h": 6, "w": 6, "x": 18, "y": 4},
          "targets": [{
            "expr": "avg(jenkins_build_duration_seconds) + avg(argocd_sync_duration_seconds) + avg(kube_pod_start_time_seconds)",
            "refId": "A"
          }],
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"]},
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "value",
            "graphMode": "area"
          },
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "green"},
                  {"value": 300, "color": "yellow"},
                  {"value": 600, "color": "red"}
                ]
              }
            }
          }
        },
        {
          "type": "timeseries",
          "title": "Jenkins ë¹Œë“œ ì„±ê³µ/ì‹¤íŒ¨ ì¶”ì´",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
          "targets": [
            {
              "expr": "sum(rate(jenkins_builds_success_total[5m]))",
              "legendFormat": "ì„±ê³µ",
              "refId": "A"
            },
            {
              "expr": "sum(rate(jenkins_builds_failed_total[5m]))",
              "legendFormat": "ì‹¤íŒ¨",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "fillOpacity": 10
              },
              "color": {"mode": "palette-classic"}
            },
            "overrides": [
              {"matcher": {"id": "byName", "options": "ì„±ê³µ"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
              {"matcher": {"id": "byName", "options": "ì‹¤íŒ¨"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}
            ]
          }
        },
        {
          "type": "timeseries",
          "title": "ArgoCD Sync ìƒíƒœ ì¶”ì´",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
          "targets": [
            {
              "expr": "sum(rate(argocd_app_sync_status{status=\"Succeeded\"}[5m]))",
              "legendFormat": "ì„±ê³µ",
              "refId": "A"
            },
            {
              "expr": "sum(rate(argocd_app_sync_status{status=\"Failed\"}[5m]))",
              "legendFormat": "ì‹¤íŒ¨",
              "refId": "B"
            },
            {
              "expr": "sum(argocd_app_sync_status{status=\"Syncing\"})",
              "legendFormat": "ì§„í–‰ì¤‘",
              "refId": "C"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "fillOpacity": 10
              },
              "color": {"mode": "palette-classic"}
            },
            "overrides": [
              {"matcher": {"id": "byName", "options": "ì„±ê³µ"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
              {"matcher": {"id": "byName", "options": "ì‹¤íŒ¨"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
              {"matcher": {"id": "byName", "options": "ì§„í–‰ì¤‘"}, "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]}
            ]
          }
        },
        {
          "type": "table",
          "title": "ìµœê·¼ Jenkins ë¹Œë“œ ëª©ë¡",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18},
          "targets": [{
            "expr": "jenkins_build_info",
            "format": "table",
            "instant": true,
            "refId": "A"
          }],
          "transformations": [
            {"id": "organize", "options": {"excludeByName": {"Time": true, "__name__": true, "instance": true, "job": true}, "indexByName": {}, "renameByName": {"build_number": "ë¹Œë“œ ë²ˆí˜¸", "project": "í”„ë¡œì íŠ¸", "status": "ìƒíƒœ", "duration": "ì†Œìš” ì‹œê°„"}}}
          ],
          "options": {
            "showHeader": true,
            "sortBy": [{"displayName": "ë¹Œë“œ ë²ˆí˜¸", "desc": true}]
          }
        },
        {
          "type": "table",
          "title": "ArgoCD ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18},
          "targets": [{
            "expr": "argocd_app_info",
            "format": "table",
            "instant": true,
            "refId": "A"
          }],
          "transformations": [
            {"id": "organize", "options": {"excludeByName": {"Time": true, "__name__": true, "instance": true, "job": true}, "indexByName": {}, "renameByName": {"name": "ì• í”Œë¦¬ì¼€ì´ì…˜", "namespace": "ë„¤ì„ìŠ¤í˜ì´ìŠ¤", "sync_status": "Sync ìƒíƒœ", "health_status": "Health ìƒíƒœ"}}}
          ],
          "options": {
            "showHeader": true,
            "sortBy": [{"displayName": "ì• í”Œë¦¬ì¼€ì´ì…˜", "desc": false}]
          }
        },
        {
          "type": "timeseries",
          "title": "Jenkins ë¹Œë“œ Duration (P50/P95/P99)",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26},
          "targets": [
            {
              "expr": "histogram_quantile(0.50, sum(rate(jenkins_build_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P50",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(jenkins_build_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P95",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.99, sum(rate(jenkins_build_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P99",
              "refId": "C"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "fillOpacity": 0
              },
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "type": "timeseries",
          "title": "Pod Readiness ì‹œê°„ ì¶”ì´",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26},
          "targets": [{
            "expr": "avg(kube_pod_start_time_seconds) by (namespace)",
            "legendFormat": "{{namespace}}",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "custom": {
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "fillOpacity": 10
              },
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "type": "bargauge",
          "title": "í”„ë¡œì íŠ¸ë³„ Jenkins ë¹Œë“œ ë¹ˆë„ (24h)",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 34},
          "targets": [{
            "expr": "sum(increase(jenkins_builds_total[24h])) by (project)",
            "refId": "A"
          }],
          "options": {
            "orientation": "horizontal",
            "displayMode": "gradient",
            "showUnfilled": true
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "continuous-GrYlRd"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "green"},
                  {"value": 50, "color": "yellow"},
                  {"value": 100, "color": "red"}
                ]
              }
            }
          }
        },
        {
          "type": "piechart",
          "title": "ArgoCD Sync ìƒíƒœ ë¶„í¬",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 34},
          "targets": [{
            "expr": "count(argocd_app_sync_status) by (status)",
            "refId": "A"
          }],
          "options": {
            "legend": {"displayMode": "list", "placement": "right"},
            "pieType": "donut",
            "displayLabels": ["percent"]
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"}
            },
            "overrides": [
              {"matcher": {"id": "byName", "options": "Succeeded"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
              {"matcher": {"id": "byName", "options": "Failed"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
              {"matcher": {"id": "byName", "options": "Syncing"}, "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]}
            ]
          }
        },
        {
          "type": "text",
          "title": "ğŸ”— ê´€ë ¨ ë§í¬",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 42},
          "options": {
            "mode": "html",
            "content": "<div style='padding: 15px; background: #f5f5f5; border-radius: 8px;'><div style='display: flex; justify-content: space-around; align-items: center;'><a href='/d/dataops-main-nav/dataops-platform-main-navigation' style='padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;'>â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a><a href='http://jenkins.example.com' target='_blank' style='padding: 10px 20px; background: #D24939; color: white; text-decoration: none; border-radius: 5px;'>Jenkins ì½˜ì†”</a><a href='http://argocd.example.com' target='_blank' style='padding: 10px 20px; background: #EF7B4D; color: white; text-decoration: none; border-radius: 5px;'>ArgoCD UI</a><a href='/d/dataops-resource-capacity/dataops-resource-capacity' style='padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;'>ë¦¬ì†ŒìŠ¤ ê°€ìš©ëŸ‰ â†’</a></div></div>"
          }
        }
      ]
    }

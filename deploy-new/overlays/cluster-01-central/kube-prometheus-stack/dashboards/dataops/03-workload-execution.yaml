apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-dataops-workload-execution
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  dataops-workload-execution.json: |
    {
      "uid": "dataops-workload-execution",
      "title": "âš™ï¸ DataOps - ì›Œí¬ë¡œë“œ ì‹¤í–‰",
      "tags": ["dataops", "workload", "spark", "airflow", "trino"],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 1,
      "refresh": "30s",
      "editable": true,
      "panels": [
        {
          "type": "text",
          "title": "ğŸ“Š ì›Œí¬ë¡œë“œ ì‹¤í–‰ ê°œìš”",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "options": {
            "mode": "html",
            "content": "<div style='padding: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 8px;'><h2 style='margin:0'>âš™ï¸ ì›Œí¬ë¡œë“œ ì‹¤í–‰ ëª¨ë‹ˆí„°ë§</h2><p style='margin-top:10px; font-size:16px'>Spark, Airflow, Trino ì›Œí¬ë¡œë“œ ì„±ëŠ¥ ë° ì‹¤í–‰ ìƒíƒœ ëª¨ë‹ˆí„°ë§</p></div>"
          }
        },
        {
          "type": "stat",
          "title": "Spark Job ì„±ê³µë¥  (24h)",
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 4},
          "targets": [{
            "expr": "sum(rate(spark_job_status{status=\"SUCCEEDED\"}[24h])) / sum(rate(spark_job_status[24h])) * 100",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "red"},
                  {"value": 90, "color": "yellow"},
                  {"value": 95, "color": "green"}
                ]
              }
            }
          }
        },
        {
          "type": "stat",
          "title": "Airflow DAG ì„±ê³µë¥  (24h)",
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 4},
          "targets": [{
            "expr": "sum(rate(airflow_dag_run_status{status=\"success\"}[24h])) / sum(rate(airflow_dag_run_status[24h])) * 100",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "red"},
                  {"value": 95, "color": "yellow"},
                  {"value": 99, "color": "green"}
                ]
              }
            }
          }
        },
        {
          "type": "stat",
          "title": "Trino Query ì„±ê³µë¥  (24h)",
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 4},
          "targets": [{
            "expr": "sum(rate(trino_query_completed{state=\"FINISHED\"}[24h])) / sum(rate(trino_query_completed[24h])) * 100",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "red"},
                  {"value": 95, "color": "yellow"},
                  {"value": 98, "color": "green"}
                ]
              }
            }
          }
        },
        {
          "type": "timeseries",
          "title": "Spark Job Duration (P50/P95/P99)",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
          "targets": [
            {
              "expr": "histogram_quantile(0.50, sum(rate(spark_job_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P50",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(spark_job_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P95",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.99, sum(rate(spark_job_duration_seconds_bucket[5m])) by (le))",
              "legendFormat": "P99",
              "refId": "C"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"drawStyle": "line", "lineInterpolation": "smooth"},
              "unit": "s"
            }
          }
        },
        {
          "type": "timeseries",
          "title": "Airflow Task Duration",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
          "targets": [{
            "expr": "histogram_quantile(0.95, sum(rate(airflow_task_duration_seconds_bucket[5m])) by (le, dag_id))",
            "legendFormat": "{{dag_id}}",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "custom": {"drawStyle": "line", "lineInterpolation": "smooth"},
              "unit": "s"
            }
          }
        },
        {
          "type": "table",
          "title": "Spark Job ì‹¤í–‰ ë‚´ì—­",
          "gridPos": {"h": 10, "w": 24, "x": 0, "y": 18},
          "targets": [{
            "expr": "spark_job_info",
            "format": "table",
            "instant": true,
            "refId": "A"
          }],
          "transformations": [
            {"id": "organize", "options": {"renameByName": {"job_id": "Job ID", "status": "ìƒíƒœ", "duration": "ì†Œìš”ì‹œê°„", "executor_count": "Executor ìˆ˜"}}}
          ]
        },
        {
          "type": "timeseries",
          "title": "Trino Query ì‹¤í–‰ ì¶”ì´",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
          "targets": [
            {
              "expr": "sum(rate(trino_query_completed{state=\"FINISHED\"}[5m]))",
              "legendFormat": "ì™„ë£Œ",
              "refId": "A"
            },
            {
              "expr": "sum(rate(trino_query_completed{state=\"FAILED\"}[5m]))",
              "legendFormat": "ì‹¤íŒ¨",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"drawStyle": "line", "lineInterpolation": "smooth"}
            }
          }
        },
        {
          "type": "bargauge",
          "title": "Spark GC Time Ratio",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
          "targets": [{
            "expr": "sum(rate(jvm_gc_collection_seconds_sum{job=\"spark\"}[5m])) / sum(rate(jvm_gc_collection_seconds_count{job=\"spark\"}[5m])) * 100",
            "refId": "A"
          }],
          "options": {
            "orientation": "horizontal",
            "displayMode": "gradient"
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "green"},
                  {"value": 5, "color": "yellow"},
                  {"value": 10, "color": "red"}
                ]
              }
            }
          }
        },
        {
          "type": "text",
          "title": "ğŸ”— ê´€ë ¨ ë§í¬",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 36},
          "options": {
            "mode": "html",
            "content": "<div style='padding: 15px; background: #f5f5f5; border-radius: 8px;'><div style='display: flex; justify-content: space-around;'><a href='/d/dataops-resource-capacity/dataops-resource-capacity' style='padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;'>â† ë¦¬ì†ŒìŠ¤ ê°€ìš©ëŸ‰</a><a href='/d/dataops-main-nav/dataops-platform-main-navigation' style='padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;'>ë©”ì¸ìœ¼ë¡œ</a><a href='/d/dataops-data-pipeline/dataops-data-pipeline' style='padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;'>ë°ì´í„° íŒŒì´í”„ë¼ì¸ â†’</a></div></div>"
          }
        }
      ]
    }

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-dataops-optimization-v4
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  dataops-optimization-v4.json: |
    {
      "uid": "dataops-optimization-v4",
      "title": "DataOps - 6. Optimization & Troubleshooting",
      "tags": ["dataops", "optimization", "troubleshooting", "performance"],
      "timezone": "Asia/Seoul",
      "schemaVersion": 39,
      "version": 6,
      "refresh": "30s",
      "graphTooltip": 1,
      "editable": true,
      "style": "dark",
      "panels": [
        {
          "type": "text",
          "id": 1,
          "title": "",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "options": {
            "mode": "markdown",
            "content": "# ğŸ”§ Optimization & Troubleshooting Dashboard\n\n**ëª©ì **: ì„±ëŠ¥ ë³‘ëª© ì§€ì  ì‹ë³„, ë¦¬ì†ŒìŠ¤ ìµœì í™”, ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì¢…í•© ë¶„ì„\n\n**ë¶„ì„ ì˜ì—­**: í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ | ì›Œí¬ë¡œë“œ ì„±ëŠ¥ | ë°ì´í„° íŒŒì´í”„ë¼ì¸ | ë¹„ìš© ìµœì í™”\n\n[â—€ í¬í„¸ë¡œ ëŒì•„ê°€ê¸°](/d/dataops-portal-e2e-v4)"
          },
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# ğŸ”§ Optimization & Troubleshooting Dashboard\n\n**ëª©ì **: ì„±ëŠ¥ ë³‘ëª© ì§€ì  ì‹ë³„, ë¦¬ì†ŒìŠ¤ ìµœì í™”, ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì¢…í•© ë¶„ì„\n\n**ë¶„ì„ ì˜ì—­**: í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ | ì›Œí¬ë¡œë“œ ì„±ëŠ¥ | ë°ì´í„° íŒŒì´í”„ë¼ì¸ | ë¹„ìš© ìµœì í™”\n\n[â—€ í¬í„¸ë¡œ ëŒì•„ê°€ê¸°](/d/dataops-portal-e2e-v4)",
            "mode": "markdown"
          }
        },
        {
          "type": "stat",
          "id": 10,
          "title": "Resource Efficiency Score",
          "description": "**ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± ì ìˆ˜ (0-100ì )**\n\n**ê³„ì‚°ì‹**:\n(\n  (sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) / sum(kube_pod_container_resource_requests{resource=\"cpu\"})) * 50 +\n  (sum(container_memory_working_set_bytes{container!=\"\"}) / sum(kube_pod_container_resource_requests{resource=\"memory\"})) * 50\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- CPU ì‚¬ìš©ë¥ ê³¼ Memory ì‚¬ìš©ë¥ ì„ ê°ê° 50ì  ë§Œì ìœ¼ë¡œ í™˜ì‚°\n- ì‹¤ì œ ì‚¬ìš©ëŸ‰ ëŒ€ë¹„ ìš”ì²­ëŸ‰(Request)ì˜ ë¹„ìœ¨\n- ë¦¬ì†ŒìŠ¤ í• ë‹¹ íš¨ìœ¨ì„± ì¢…í•© ì§€í‘œ\n\n**ì ìˆ˜ í•´ì„**:\n- ğŸŸ¢ 70-85ì : ì´ìƒì  (ì¶©ë¶„í•œ ì—¬ìœ  + ë‚­ë¹„ ìµœì†Œ)\n- ğŸŸ¡ 50-70ì  ë˜ëŠ” 85-95ì : ì¡°ì • í•„ìš”\n  - 50-70: ê³¼ë‹¤ í• ë‹¹ (ë¦¬ì†ŒìŠ¤ ë‚­ë¹„)\n  - 85-95: ê³¼ì†Œ í• ë‹¹ (OOM/Throttling ìœ„í—˜)\n- ğŸ”´ <50ì  ë˜ëŠ” >95ì : ìœ„í—˜\n  - <50: ì‹¬ê°í•œ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„\n  - >95: ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ì„ë°•\n\n**ìµœì í™” ë°©í–¥**:\n- **ì ìˆ˜ ë‚®ìŒ (ê³¼ë‹¤ í• ë‹¹)**: Request ê°’ ê°ì†Œ\n- **ì ìˆ˜ ë†’ìŒ (ê³¼ì†Œ í• ë‹¹)**: Request/Limit ê°’ ì¦ê°€ ë˜ëŠ” HPA í™œì„±í™”\n\n**VPA (Vertical Pod Autoscaler) í™œìš©**:\n- VPAê°€ ìë™ìœ¼ë¡œ ì ì • Request ê°’ ì¶”ì²œ\n- íˆìŠ¤í† ë¦¬ ê¸°ë°˜ í•™ìŠµìœ¼ë¡œ ìµœì í™”\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- 50ì  ë¯¸ë§Œ: ê³¼ë‹¤ í• ë‹¹ëœ Namespace ì‹ë³„ í›„ Request ì¡°ì •\n- 95ì  ì´ìƒ: CPU Throttling, OOM Kill ë¡œê·¸ í™•ì¸\n- ì •ê¸°ì ìœ¼ë¡œ (ì£¼ê°„) ë¦¬ì†ŒìŠ¤ í• ë‹¹ ê²€í† \n\n**SLO**: ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± 75-80ì  ìœ ì§€\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: CPU/Memory Request vs Usage",
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 4},
          "targets": [
            {
              "expr": "(\n  (sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) / sum(kube_pod_container_resource_requests{resource=\"cpu\"})) * 50 +\n  (sum(container_memory_working_set_bytes{container!=\"\"}) / sum(kube_pod_container_resource_requests{resource=\"memory\"})) * 50\n)",
              "refId": "A",
              "legendFormat": "Efficiency Score"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 139, 139, 0.3)"},
                  {"value": 50, "color": "rgba(255, 217, 125, 0.3)"},
                  {"value": 70, "color": "rgba(244, 164, 196, 0.4)"},
                  {"value": 85, "color": "rgba(255, 217, 125, 0.3)"},
                  {"value": 95, "color": "rgba(244, 139, 139, 0.3)"}
                ]
              },
              "color": {"mode": "thresholds"},
              "min": 0,
              "max": 100
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "stat",
          "id": 11,
          "title": "Cost Optimization Potential",
          "description": "**ë¹„ìš© ì ˆê° ê°€ëŠ¥ ê¸ˆì•¡ (ì›”ê°„ ì¶”ì •, USD)**\n\n**ê³„ì‚°ì‹**:\n(\n  sum(kube_pod_container_resource_requests{resource=\"cpu\"}) - \n  sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]))\n) * 730 * 0.04 + \n(\n  sum(kube_pod_container_resource_requests{resource=\"memory\"}) - \n  sum(container_memory_working_set_bytes{container!=\"\"})\n) / 1024 / 1024 / 1024 * 730 * 0.005\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- ê³¼ë‹¤ í• ë‹¹ëœ CPU/Memoryì˜ ë¹„ìš© í™˜ì‚°\n- CPU: 1 core/hour = $0.04 (í‰ê·  í´ë¼ìš°ë“œ ë¹„ìš©)\n- Memory: 1 GB/hour = $0.005\n- 730 = ì›”ê°„ ì‹œê°„ ìˆ˜ (24h * 30.4ì¼)\n\n**ë¹„ìš© êµ¬ì¡°**:\n- **í´ë¼ìš°ë“œ**: ì‹¤ì œ ì‚¬ìš©ëŸ‰ì´ ì•„ë‹Œ Request ê¸°ì¤€ ê³¼ê¸ˆ\n- **ì˜¨í”„ë ˆë¯¸ìŠ¤**: ê³¼ë‹¤ í• ë‹¹ìœ¼ë¡œ ì¸í•œ ì‹ ê·œ ì„œë²„ íˆ¬ì ì§€ì—°\n- **ê¸°íšŒ ë¹„ìš©**: ë‚­ë¹„ëœ ë¦¬ì†ŒìŠ¤ë¡œ ì¶”ê°€ ì›Œí¬ë¡œë“œ ì‹¤í–‰ ê°€ëŠ¥\n\n**ì ˆê° ê°€ëŠ¥ ë²”ìœ„**:\n- ğŸŸ¢ < $500/ì›”: ì–‘í˜¸ (ìµœì í™” ì˜ ë¨)\n- ğŸŸ¡ $500-$2,000/ì›”: ê°œì„  ê°€ëŠ¥\n- ğŸ”´ > $2,000/ì›”: ì¦‰ì‹œ ìµœì í™” í•„ìš”\n\n**ì ˆê° ë°©ë²•**:\n1. **Request ìš°ì„  ì¡°ì •**: ì‹¤ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ì¬ì„¤ì •\n2. **Limit ì œê±° ê³ ë ¤**: CPU LimitëŠ” Throttling ìœ ë°œ\n3. **QoS Class ê²€í† **: Burstable vs Guaranteed\n4. **Spot Instance**: ë°°ì¹˜ ì›Œí¬ë¡œë“œì— ì ìš©\n\n**ì‹¤ì œ ì ˆê° ì‚¬ë¡€**:\n- Aì‚¬: Request 20% ê°ì†Œ â†’ ì›” $5,000 ì ˆê°\n- Bì‚¬: VPA ë„ì… â†’ ìë™ ìµœì í™”ë¡œ ì›” $3,000 ì ˆê°\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- $2,000 ì´ìƒ: ìƒìœ„ 10ê°œ Namespaceì˜ ë¦¬ì†ŒìŠ¤ ì¬ê²€í† \n- FinOps ê´€ì ì˜ ì •ê¸° ë¦¬ë·° (ì›”ê°„)\n- Rightsizing í”„ë¡œì íŠ¸ ì§„í–‰\n\n**ì°¸ê³ **: ì´ ê¸ˆì•¡ì€ ì¶”ì •ì¹˜ì´ë©°, ì‹¤ì œ í´ë¼ìš°ë“œ ë¹„ìš©ì€ ì§€ì—­/í”„ë¡œë°”ì´ë”ì— ë”°ë¼ ë‹¤ë¦„",
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 4},
          "targets": [
            {
              "expr": "(\n  sum(kube_pod_container_resource_requests{resource=\"cpu\"}) - \n  sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]))\n) * 730 * 0.04 + \n(\n  sum(kube_pod_container_resource_requests{resource=\"memory\"}) - \n  sum(container_memory_working_set_bytes{container!=\"\"})\n) / 1024 / 1024 / 1024 * 730 * 0.005",
              "refId": "A",
              "legendFormat": "Saving Potential"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "currencyUSD",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 164, 196, 0.3)"},
                  {"value": 500, "color": "rgba(255, 217, 125, 0.3)"},
                  {"value": 2000, "color": "rgba(244, 139, 139, 0.3)"}
                ]
              },
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "stat",
          "id": 12,
          "title": "Performance Bottleneck Count",
          "description": "**í˜„ì¬ ê°ì§€ëœ ì„±ëŠ¥ ë³‘ëª© ì§€ì  ê°œìˆ˜**\n\n**ê³„ì‚°ì‹**:\ncount(\n  (rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]) / \n   on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"cpu\"}) > 0.9\n) +\ncount(\n  (container_memory_working_set_bytes{container!=\"\"} / \n   on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"memory\"}) > 0.9\n) +\ncount(rate(container_cpu_cfs_throttled_seconds_total[5m]) > 0.1) +\ncount(kube_pod_container_status_restarts_total > 3)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- CPU Limit 90% ì´ìƒ ì‚¬ìš© ì¤‘ì¸ ì»¨í…Œì´ë„ˆ\n- Memory Limit 90% ì´ìƒ ì‚¬ìš© ì¤‘ì¸ ì»¨í…Œì´ë„ˆ\n- CPU Throttling ë°œìƒ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ (10% ì´ìƒ)\n- ìµœê·¼ ì¬ì‹œì‘ 3íšŒ ì´ìƒì¸ ì»¨í…Œì´ë„ˆ (OOM Kill í¬í•¨)\n\n**ë³‘ëª© ìœ í˜•**:\n1. **CPU Bottleneck**: Limit ì´ˆê³¼ë¡œ Throttling\n2. **Memory Bottleneck**: OOM Kill ìœ„í—˜\n3. **Network Bottleneck**: Bandwidth í¬í™”\n4. **Storage Bottleneck**: I/O Wait ë†’ìŒ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-5ê°œ: ìš°ìˆ˜ (ì¼ë¶€ ìˆœê°„ì  ë³‘ëª©)\n- ğŸŸ¡ 5-20ê°œ: ì£¼ì˜ (ë¦¬ì†ŒìŠ¤ ì¡°ì • ê²€í† )\n- ğŸ”´ > 20ê°œ: ìœ„í—˜ (ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”)\n\n**ìš°ì„ ìˆœìœ„ íŒë‹¨**:\n- **Critical**: Production ì›Œí¬ë¡œë“œì˜ ë³‘ëª©\n- **High**: ì‚¬ìš©ì ëŒ€ë©´ ì„œë¹„ìŠ¤ì˜ ë³‘ëª©\n- **Medium**: ë°°ì¹˜ Jobì˜ ì„±ëŠ¥ ì €í•˜\n- **Low**: Dev/Test í™˜ê²½\n\n**ìë™ í•´ê²° ë°©ë²•**:\n- **HPA (Horizontal Pod Autoscaler)**: Pod ê°œìˆ˜ ìë™ ì¦ê°€\n- **VPA (Vertical Pod Autoscaler)**: Request/Limit ìë™ ì¡°ì •\n- **Cluster Autoscaler**: Node ìë™ ì¶”ê°€\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- ë³‘ëª© ì»¨í…Œì´ë„ˆ ëª©ë¡ í™•ì¸ (í•˜ë‹¨ í…Œì´ë¸” ì°¸ì¡°)\n- CPU Throttling: CPU Limit ì¦ê°€ ë˜ëŠ” ì œê±°\n- Memory ì••ë°•: Memory Limit ì¦ê°€\n- ì¬ì‹œì‘ ë¹ˆë²ˆ: ë¡œê·¸ì—ì„œ OOM Kill í™•ì¸\n\n**SLO**: ë³‘ëª© ì§€ì  < 10ê°œ\n**Alert**: ë³‘ëª© ì§€ì  > 20ê°œê°€ 10ë¶„ ì´ìƒ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: CPU Throttling, OOM Kill Count",
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 4},
          "targets": [
            {
              "expr": "count(\n  (rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]) / \n   on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"cpu\"}) > 0.9\n) +\ncount(\n  (container_memory_working_set_bytes{container!=\"\"} / \n   on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"memory\"}) > 0.9\n) +\ncount(rate(container_cpu_cfs_throttled_seconds_total[5m]) > 0.1) +\ncount(kube_pod_container_status_restarts_total > 3)",
              "refId": "A",
              "legendFormat": "Bottleneck Count"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 164, 196, 0.3)"},
                  {"value": 5, "color": "rgba(255, 217, 125, 0.3)"},
                  {"value": 20, "color": "rgba(244, 139, 139, 0.3)"}
                ]
              },
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "gauge",
          "id": 13,
          "title": "Overall System Health",
          "description": "**ì „ì²´ ì‹œìŠ¤í…œ ê±´ê°•ë„ ì ìˆ˜ (0-100ì )**\n\n**ê³„ì‚°ì‹**:\n(\n  (1 - (count(up{job=~\".*\"} == 0) / count(up{job=~\".*\"}))) * 30 +\n  (1 - (count(ALERTS{alertstate=\"firing\",severity=\"critical\"}) / 10)) * 25 +\n  (sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) / sum(machine_cpu_cores) < 0.85) * 25 +\n  (sum(container_memory_working_set_bytes{container!=\"\"}) / sum(machine_memory_bytes) < 0.85) * 20\n) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n4ê°€ì§€ í•µì‹¬ ê±´ê°• ì§€í‘œì˜ ê°€ì¤‘ í‰ê· \n1. **ì„œë¹„ìŠ¤ ê°€ìš©ì„± (30ì )**: UP ìƒíƒœ ì„œë¹„ìŠ¤ ë¹„ìœ¨\n2. **Alert ë¶€ì¬ (25ì )**: Critical Alert ì—†ìŒ\n3. **CPU ì—¬ìœ  (25ì )**: í´ëŸ¬ìŠ¤í„° CPU < 85%\n4. **Memory ì—¬ìœ  (20ì )**: í´ëŸ¬ìŠ¤í„° Memory < 85%\n\n**ì ìˆ˜ í•´ì„**:\n- ğŸŸ¢ 90-100ì : ë§¤ìš° ê±´ê°• (ëª¨ë“  ì‹œìŠ¤í…œ ì •ìƒ)\n- ğŸŸ¡ 70-90ì : ì–‘í˜¸ (ì¼ë¶€ ê²½ë¯¸í•œ ë¬¸ì œ)\n- ğŸŸ  50-70ì : ì£¼ì˜ (ì—¬ëŸ¬ ë¬¸ì œ ë°œìƒ)\n- ğŸ”´ < 50ì : ìœ„í—˜ (ì‹¬ê°í•œ ì¥ì• )\n\n**ê±´ê°•ë„ ì €í•˜ ì›ì¸**:\n- **ì„œë¹„ìŠ¤ Down**: ë°°í¬ ì‹¤íŒ¨, ì„¤ì • ì˜¤ë¥˜\n- **Critical Alert**: ë¦¬ì†ŒìŠ¤ ë¶€ì¡±, ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜\n- **ë¦¬ì†ŒìŠ¤ ê³ ê°ˆ**: í´ëŸ¬ìŠ¤í„° ìš©ëŸ‰ í•œê³„\n\n**ê°œì„  ì¡°ì¹˜**:\n- 70ì  ì´í•˜: ì¦‰ì‹œ ìƒí™© íŒŒì•… ë° ëŒ€ì‘\n- Down ì„œë¹„ìŠ¤: kubectl describeë¡œ ì›ì¸ ë¶„ì„\n- Alert í™•ì¸: Alertmanagerì—ì„œ ìƒì„¸ ë‚´ì—­ ì¡°íšŒ\n- ë¦¬ì†ŒìŠ¤ ë¶€ì¡±: ìŠ¤ì¼€ì¼ ì•„ì›ƒ ë˜ëŠ” ì›Œí¬ë¡œë“œ ì¡°ì •\n\n**ì •ê¸° ì ê²€**:\n- ì¼ì¼: 90ì  ì´ìƒ ìœ ì§€ í™•ì¸\n- ì£¼ê°„: ì¶”ì„¸ ë¶„ì„ (ì ìˆ˜ í•˜ë½ íŒ¨í„´)\n- ì›”ê°„: ê°œì„  í™œë™ í‰ê°€\n\n**SLO**: í‰ê·  ê±´ê°•ë„ > 85ì \n**Alert**: ê±´ê°•ë„ < 70ì ì´ 10ë¶„ ì´ìƒ\n**ê´€ë ¨ ëŒ€ì‹œë³´ë“œ**: ëª¨ë“  ëŒ€ì‹œë³´ë“œ ì¢…í•©",
          "gridPos": {"h": 6, "w": 6, "x": 18, "y": 4},
          "targets": [
            {
              "expr": "(\n  (1 - (count(up{job=~\".*\"} == 0) / count(up{job=~\".*\"}))) * 30 +\n  (1 - (count(ALERTS{alertstate=\"firing\",severity=\"critical\"}) / 10)) * 25 +\n  (sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) / sum(machine_cpu_cores) < 0.85) * 25 +\n  (sum(container_memory_working_set_bytes{container!=\"\"}) / sum(machine_memory_bytes) < 0.85) * 20\n) * 100",
              "refId": "A",
              "legendFormat": "Health Score"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 139, 139, 0.8)"},
                  {"value": 50, "color": "rgba(255, 180, 71, 0.8)"},
                  {"value": 70, "color": "rgba(255, 217, 125, 0.8)"},
                  {"value": 90, "color": "rgba(129, 201, 149, 0.8)"}
                ]
              },
              "min": 0,
              "max": 100
            }
          },
          "options": {
            "showThresholdLabels": true,
            "showThresholdMarkers": true
          }
        },
        {
          "type": "timeseries",
          "id": 20,
          "title": "CPU Throttling Rate by Namespace",
          "description": "**Namespaceë³„ CPU Throttling ë°œìƒë¥ **\n\n**ê³„ì‚°ì‹**:\nsum(rate(container_cpu_cfs_throttled_seconds_total[5m])) by (namespace) / \nsum(rate(container_cpu_cfs_periods_total[5m])) by (namespace) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- CFS (Completely Fair Scheduler)ì—ì„œ CPU Limitë¡œ ì¸í•´ ì œí•œëœ ì‹œê°„ ë¹„ìœ¨\n- CPU Limit ì„¤ì • ì‹œ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ì €í•˜ ì¸¡ì •\n- 100% = í•­ìƒ Throttling (ì‹¬ê°í•œ ì„±ëŠ¥ ë¬¸ì œ)\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-5%: ìš°ìˆ˜ (ê°„í—ì  Throttling, ë¬´ì‹œ ê°€ëŠ¥)\n- ğŸŸ¡ 5-15%: ì£¼ì˜ (ì„±ëŠ¥ ì˜í–¥ ì‹œì‘)\n- ğŸ”´ > 15%: ìœ„í—˜ (ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜)\n\n**Throttling ì˜í–¥**:\n- API ì‘ë‹µ ì§€ì—° ì¦ê°€\n- ì²˜ë¦¬ëŸ‰ ê°ì†Œ\n- Latency p95/p99 ì¦ê°€\n- ì‚¬ìš©ì ì²´ê° ì„±ëŠ¥ ì €í•˜\n\n**CPU Limitì˜ ë”œë ˆë§ˆ**:\n- **Limit ì„¤ì •**: Noisy Neighbor ë°©ì§€, ë¦¬ì†ŒìŠ¤ ê²©ë¦¬\n- **Limit ë¯¸ì„¤ì •**: Throttling ì—†ìŒ, ì„±ëŠ¥ ì˜ˆì¸¡ ê°€ëŠ¥\n- **Best Practice**: Requestë§Œ ì„¤ì •, Limit ì œê±° (QoS: Burstable)\n\n**í•´ê²° ë°©ë²•**:\n1. **CPU Limit ì¦ê°€**: í˜„ì¬ ì‚¬ìš©ëŸ‰ì˜ 1.5-2ë°°\n2. **CPU Limit ì œê±°**: limits.cpu ì‚­ì œ (ê¶Œì¥)\n3. **HPA í™œì„±í™”**: Pod ìˆ˜ ì¦ê°€ë¡œ ë¶€í•˜ ë¶„ì‚°\n4. **ì½”ë“œ ìµœì í™”**: CPU ì‚¬ìš©ëŸ‰ ìì²´ë¥¼ ì¤„ì„\n\n**Googleì˜ ê¶Œì¥ì‚¬í•­**:\n- GKE Best Practice: CPU Limit ì„¤ì • ì§€ì–‘\n- CPUëŠ” ì••ì¶• ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ (Throttlingë§Œ ë°œìƒ, Crash ì•ˆ í•¨)\n- Memory Limitë§Œ ì—„ê²©íˆ ê´€ë¦¬ (OOM Kill ë°©ì§€)\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- 15% ì´ìƒ Throttling ë°œìƒ Namespace ì‹ë³„\n- í•´ë‹¹ Deploymentì˜ CPU Limit ê²€í† \n- Limit ì œê±° í›„ Requestë§Œìœ¼ë¡œ ì¬ë°°í¬\n\n**SLO**: í‰ê·  Throttling Rate < 5%\n**Alert**: íŠ¹ì • Namespaceì˜ Throttling > 20%ê°€ 10ë¶„ ì´ìƒ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: CPU Usage, Response Latency",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
          "targets": [
            {
              "expr": "sum(rate(container_cpu_cfs_throttled_seconds_total[5m])) by (namespace) / sum(rate(container_cpu_cfs_periods_total[5m])) by (namespace) * 100",
              "refId": "A",
              "legendFormat": "{{namespace}}"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 15,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 5, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 15, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 21,
          "title": "OOM Kill Events by Namespace",
          "description": "**Namespaceë³„ Out Of Memory Kill ë°œìƒ íšŸìˆ˜**\n\n**ê³„ì‚°ì‹**:\nsum(increase(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}[5m])) by (namespace)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- ì»¨í…Œì´ë„ˆê°€ Memory Limit ì´ˆê³¼ë¡œ ê°•ì œ ì¢…ë£Œëœ íšŸìˆ˜\n- Linux Kernelì˜ OOM Killerê°€ ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ í”„ë¡œì„¸ìŠ¤ Kill\n- Pod ì¬ì‹œì‘ì˜ ì£¼ìš” ì›ì¸ ì¤‘ í•˜ë‚˜\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0ê±´: ì´ìƒì  (ë©”ëª¨ë¦¬ ê´€ë¦¬ ì–‘í˜¸)\n- ğŸŸ¡ 1-5ê±´/ì‹œê°„: ì£¼ì˜ (ì¼ë¶€ Podì˜ ë©”ëª¨ë¦¬ ë¶€ì¡±)\n- ğŸ”´ > 5ê±´/ì‹œê°„: ìœ„í—˜ (ì‹¬ê°í•œ ë©”ëª¨ë¦¬ ë¬¸ì œ)\n\n**OOM Kill ì›ì¸**:\n1. **Memory Limit ê³¼ì†Œ ì„¤ì •**: ì‹¤ì œ í•„ìš”ëŸ‰ë³´ë‹¤ ì‘ìŒ\n2. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ê·¸ë¡œ ë©”ëª¨ë¦¬ ì§€ì† ì¦ê°€\n3. **ì˜ˆìƒì¹˜ ëª»í•œ ë¶€í•˜**: íŠ¸ë˜í”½ Spikeë¡œ ë©”ëª¨ë¦¬ ê¸‰ì¦\n4. **ìºì‹œ ê³¼ë‹¤**: In-memory ìºì‹œê°€ ë¹„ì œí•œ ì¦ê°€\n\n**OOM Kill ì˜í–¥**:\n- Pod ì¬ì‹œì‘ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨\n- ì§„í–‰ ì¤‘ì¸ ì‘ì—… ì†ì‹¤ (Stateful ì›Œí¬ë¡œë“œ)\n- CrashLoopBackOff ìƒíƒœ ì§„ì… ê°€ëŠ¥\n- ì‚¬ìš©ì ê²½í—˜ ì €í•˜\n\n**í•´ê²° ë°©ë²•**:\n1. **Memory Limit ì¦ê°€**: í˜„ì¬ ì‚¬ìš©ëŸ‰ì˜ 1.5-2ë°°\n2. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸**: Heap Dump, Profiling\n3. **VPA í™œìš©**: ìë™ìœ¼ë¡œ ì ì • Limit ì¶”ì²œ\n4. **ìºì‹œ í¬ê¸° ì œí•œ**: Max Size, TTL ì„¤ì •\n\n**OOM Kill ë¶„ì„**:\n```bash\n# ìµœê·¼ OOM Killëœ Pod í™•ì¸\nkubectl get events --all-namespaces --field-selector reason=OOMKilling\n\n# Podì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸\nkubectl top pod -n <namespace>\n\n# Container ë¡œê·¸ í™•ì¸ (ì¢…ë£Œ ì „ ë¡œê·¸)\nkubectl logs <pod> -n <namespace> --previous\n```\n\n**ì˜ˆë°© ì¡°ì¹˜**:\n- Requestì™€ Limit ë™ì¼ ì„¤ì • (QoS: Guaranteed)\n- Horizontal Scalingìœ¼ë¡œ ë¶€í•˜ ë¶„ì‚°\n- ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ ì‚¬ìš© (pprof, heapster)\n\n**SLO**: OOM Kill < 2ê±´/ì‹œê°„\n**Alert**: OOM Kill > 10ê±´/ì‹œê°„ (íŠ¹ì • Namespace)\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Memory Usage, Pod Restart Count",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
          "targets": [
            {
              "expr": "sum(increase(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}[5m])) by (namespace)",
              "refId": "A",
              "legendFormat": "{{namespace}}"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 0,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 25,
                "drawStyle": "bars",
                "lineInterpolation": "linear",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"}
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "right", "calcs": ["sum"]}
          }
        },
        {
          "type": "timeseries",
          "id": 30,
          "title": "Network Bandwidth Saturation (%)",
          "description": "**ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ì‚¬ìš©ë¥ **\n\n**ê³„ì‚°ì‹**:\n(\n  sum(rate(node_network_transmit_bytes_total{device!~\"lo|veth.*\"}[5m])) + \n  sum(rate(node_network_receive_bytes_total{device!~\"lo|veth.*\"}[5m]))\n) * 8 / (10 * 1000000000) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- ì „ì²´ ë…¸ë“œì˜ ë„¤íŠ¸ì›Œí¬ ì†¡ìˆ˜ì‹  ëŒ€ì—­í­ í•©ê³„\n- 10GbE (10 Gigabit Ethernet) ê¸°ì¤€ ì‚¬ìš©ë¥ \n- 8ì„ ê³±í•˜ëŠ” ì´ìœ : Bytes â†’ bits ë³€í™˜\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-70%: ì—¬ìœ  ìˆìŒ\n- ğŸŸ¡ 70-85%: ì£¼ì˜ (í”¼í¬ ì‹œê°„ëŒ€ í—ˆìš©)\n- ğŸ”´ > 85%: í¬í™” (ë„¤íŠ¸ì›Œí¬ ë³‘ëª©)\n\n**ëŒ€ì—­í­ í¬í™” ì˜í–¥**:\n- API ì‘ë‹µ ì§€ì—°\n- ë°ì´í„° ì „ì†¡ ì†ë„ ì €í•˜\n- S3 I/O ì„±ëŠ¥ ì €í•˜\n- Pod ê°„ í†µì‹  ì§€ì—°\n\n**ì£¼ìš” ëŒ€ì—­í­ ì†Œë¹„ì**:\n1. **S3 I/O**: Iceberg ë°ì´í„° ì½ê¸°/ì“°ê¸°\n2. **Pod-to-Pod**: Service Mesh (Istio, Linkerd)\n3. **External API**: ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ\n4. **Logging**: Fluent-bit â†’ OpenSearch ì „ì†¡\n\n**ë„¤íŠ¸ì›Œí¬ ìµœì í™”**:\n- **S3 VPC Endpoint**: íŠ¸ë˜í”½ ë‚´ë¶€ë§ ìœ ì§€\n- **CDN/Cache**: ì •ì  ì½˜í…ì¸  ìºì‹±\n- **ì••ì¶•**: gRPC/HTTP ì••ì¶• í™œì„±í™”\n- **Batch ì „ì†¡**: ì‘ì€ ìš”ì²­ ë¬¶ì–´ì„œ ì „ì†¡\n\n**10GbE vs 25GbE**:\n- 10GbE: ì´ë¡ ìƒ 1.25 GB/s\n- 25GbE: ì´ë¡ ìƒ 3.125 GB/s\n- ëŒ€ì—­í­ í¬í™” ì‹œ 25GbE ì—…ê·¸ë ˆì´ë“œ ê³ ë ¤\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- 85% ì´ìƒ: ëŒ€ì—­í­ ì†Œë¹„ Top 10 Pod ì‹ë³„\n- Network Policyë¡œ ë¶ˆí•„ìš”í•œ í†µì‹  ì°¨ë‹¨\n- ë„¤íŠ¸ì›Œí¬ ì§‘ì•½ì  ì›Œí¬ë¡œë“œ ë¶„ì‚° ë°°ì¹˜\n\n**SLO**: í‰ê·  ëŒ€ì—­í­ ì‚¬ìš©ë¥  < 70%, p95 < 85%\n**Alert**: ëŒ€ì—­í­ > 90%ê°€ 10ë¶„ ì´ìƒ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: S3 Throughput, Pod Network I/O",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18},
          "targets": [
            {
              "expr": "(\n  sum(rate(node_network_transmit_bytes_total{device!~\"lo|veth.*\"}[5m])) + \n  sum(rate(node_network_receive_bytes_total{device!~\"lo|veth.*\"}[5m]))\n) * 8 / (10 * 1000000000) * 100",
              "refId": "A",
              "legendFormat": "Bandwidth Usage"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 25,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic", "fixedColor": "rgba(244, 164, 196, 0.8)"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 70, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 85, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "single"},
            "legend": {"displayMode": "list", "placement": "bottom", "calcs": ["mean", "max"]}
          }
        },
        {
          "type": "timeseries",
          "id": 31,
          "title": "Storage I/O Wait Time (%)",
          "description": "**ìŠ¤í† ë¦¬ì§€ I/O ëŒ€ê¸° ì‹œê°„ ë¹„ìœ¨**\n\n**ê³„ì‚°ì‹**:\navg(rate(node_cpu_seconds_total{mode=\"iowait\"}[5m])) by (instance) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- CPUê°€ I/O ì‘ì—… ì™„ë£Œë¥¼ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ ë¹„ìœ¨\n- ë†’ì€ iowait = ìŠ¤í† ë¦¬ì§€ ë³‘ëª©\n- ë…¸ë“œë³„ ì¸¡ì •ìœ¼ë¡œ ë¬¸ì œ ë…¸ë“œ ì‹ë³„\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-10%: ì •ìƒ (I/O ë³‘ëª© ì—†ìŒ)\n- ğŸŸ¡ 10-30%: ì£¼ì˜ (ìŠ¤í† ë¦¬ì§€ ì„±ëŠ¥ ì €í•˜)\n- ğŸ”´ > 30%: ìœ„í—˜ (ì‹¬ê°í•œ I/O ë³‘ëª©)\n\n**I/O Wait ì›ì¸**:\n1. **ë””ìŠ¤í¬ IOPS í¬í™”**: HDD ì‚¬ìš© ì‹œ íŠ¹íˆ ì‹¬ê°\n2. **ëŒ€ìš©ëŸ‰ íŒŒì¼ I/O**: ë¡œê·¸, ë°ì´í„° íŒŒì¼ ì½ê¸°/ì“°ê¸°\n3. **ë„¤íŠ¸ì›Œí¬ ìŠ¤í† ë¦¬ì§€**: NFS, Cephì˜ ë„¤íŠ¸ì›Œí¬ ì§€ì—°\n4. **íŒŒì¼ ì‹œìŠ¤í…œ ë‹¨í¸í™”**: ì˜¤ë˜ëœ íŒŒì¼ ì‹œìŠ¤í…œ\n\n**ìŠ¤í† ë¦¬ì§€ ìœ í˜•ë³„ íŠ¹ì„±**:\n- **Longhorn (ë¡œì»¬ SSD)**: ë‚®ì€ Latency, ë†’ì€ IOPS\n- **Isilon NAS**: ì¤‘ê°„ Latency, ëŒ€ìš©ëŸ‰ ìˆœì°¨ I/O ìœ ë¦¬\n- **Ceph**: ë¶„ì‚° ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí¬ ì˜í–¥ ë°›ìŒ\n- **EBS gp3**: 3,000-16,000 IOPS ì„¤ì • ê°€ëŠ¥\n\n**I/O ìµœì í™”**:\n1. **SSD ì‚¬ìš©**: HDD ëŒ€ë¹„ 10-100ë°° ë¹ ë¥¸ IOPS\n2. **ìºì‹±**: Redis, Memcachedë¡œ ë””ìŠ¤í¬ I/O ê°ì†Œ\n3. **Batch Write**: ì‘ì€ ì“°ê¸°ë¥¼ ëª¨ì•„ì„œ í•œ ë²ˆì—\n4. **íŒŒí‹°ì…˜ ì •ë ¬**: Database Partition, Iceberg Partition\n\n**ì›Œí¬ë¡œë“œë³„ ìŠ¤í† ë¦¬ì§€ ì„ íƒ**:\n- **ë°ì´í„°ë² ì´ìŠ¤**: ë¡œì»¬ SSD (Longhorn)\n- **ëŒ€ìš©ëŸ‰ íŒŒì¼**: NAS (Isilon)\n- **ë¡œê·¸ ìˆ˜ì§‘**: ë¡œì»¬ ì„ì‹œ ì €ì¥ â†’ S3 ì „ì†¡\n- **ë¹…ë°ì´í„°**: S3 Direct (ì»¨í…Œì´ë„ˆ ë¡œì»¬ ë””ìŠ¤í¬ ë¯¸ì‚¬ìš©)\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- iowait > 30% ë…¸ë“œì˜ ì›Œí¬ë¡œë“œ í™•ì¸\n- í•´ë‹¹ ë…¸ë“œì˜ PV ì‚¬ìš© Pod ì‹ë³„\n- ìŠ¤í† ë¦¬ì§€ IOPS ëª¨ë‹ˆí„°ë§ (Longhorn, Ceph ëŒ€ì‹œë³´ë“œ)\n- í•„ìš” ì‹œ ë” ë¹ ë¥¸ ìŠ¤í† ë¦¬ì§€ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜\n\n**SLO**: í‰ê·  iowait < 15%\n**Alert**: íŠ¹ì • ë…¸ë“œì˜ iowait > 40%ê°€ 10ë¶„ ì´ìƒ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Disk IOPS, Disk Latency",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18},
          "targets": [
            {
              "expr": "avg(rate(node_cpu_seconds_total{mode=\"iowait\"}[5m])) by (instance) * 100",
              "refId": "A",
              "legendFormat": "{{instance}}"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 15,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 10, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 30, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "table",
          "id": 40,
          "title": "Top 10 Resource Wasting Pods",
          "description": "**ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ê°€ ê°€ì¥ ì‹¬í•œ Pod Top 10**\n\n**ê³„ì‚°ì‹**:\ntopk(10, \n  sum(\n    (kube_pod_container_resource_requests{resource=\"cpu\"} - \n     rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) * 730 * 0.04\n  ) by (namespace, pod)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Requestëœ CPUì—ì„œ ì‹¤ì œ ì‚¬ìš©ëŸ‰ì„ ëº€ ë‚­ë¹„ëŸ‰\n- ì›”ê°„ ë¹„ìš©ìœ¼ë¡œ í™˜ì‚° (USD)\n- ìš°ì„  ìµœì í™” ëŒ€ìƒ ì‹ë³„\n\n**ë¶„ì„ í¬ì¸íŠ¸**:\n- **ë†’ì€ ë‚­ë¹„**: Requestê°€ ê³¼ë‹¤ ì„¤ì •ë¨\n- **ë‚­ë¹„ ì›ì¸**: ì´ˆê¸° Requestë¥¼ í¬ê²Œ ì„¤ì • í›„ ë¯¸ì¡°ì •\n- **ìµœì í™” íš¨ê³¼**: ìƒìœ„ 10ê°œë§Œ ì¡°ì •í•´ë„ í° ì ˆê°\n\n**Request ì¡°ì • ë°©ë²•**:\n1. **ì‹¤ì‚¬ìš©ëŸ‰ í™•ì¸**: ìµœê·¼ 1ì£¼ì¼ p95 ê°’\n2. **ì—¬ìœ  ì¶”ê°€**: ì‹¤ì‚¬ìš©ëŸ‰ * 1.2-1.5 (20-50% ë²„í¼)\n3. **ë°°í¬ í›„ ëª¨ë‹ˆí„°ë§**: OOM Kill, CPU Throttling ë¯¸ë°œìƒ í™•ì¸\n\n**VPA ê¶Œì¥ì‚¬í•­ í™œìš©**:\n```bash\n# VPA ë¦¬ì†ŒìŠ¤ í™•ì¸\nkubectl get vpa -n <namespace>\n\n# VPA ê¶Œì¥ì‚¬í•­ ì¡°íšŒ\nkubectl describe vpa <vpa-name> -n <namespace>\n```\n\n**ì£¼ì˜ì‚¬í•­**:\n- **Production í™˜ê²½**: ì ì§„ì ìœ¼ë¡œ ì¡°ì • (í•œ ë²ˆì— í¬ê²Œ ì¤„ì´ì§€ ì•ŠìŒ)\n- **íŠ¸ë˜í”½ íŒ¨í„´**: í”¼í¬ ì‹œê°„ëŒ€ ê³ ë ¤\n- **HPA ì—°ë™**: HPAì™€ í•¨ê»˜ ì‚¬ìš© ì‹œ ì—¬ìœ  ì ê²Œ\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- ìƒìœ„ 10ê°œ Podì˜ Deployment ì‹ë³„\n- Request ê°’ì„ ì‹¤ì‚¬ìš©ëŸ‰ + 30% ìˆ˜ì¤€ìœ¼ë¡œ ì¡°ì •\n- 1ì£¼ì¼ ëª¨ë‹ˆí„°ë§ í›„ ì¶”ê°€ ë¯¸ì„¸ ì¡°ì •\n\n**ì˜ˆìƒ íš¨ê³¼**:\n- ìƒìœ„ 10ê°œ Pod ìµœì í™” â†’ ì „ì²´ ì ˆê°ì˜ 50-70%\n- í´ëŸ¬ìŠ¤í„° ê°€ìš© ë¦¬ì†ŒìŠ¤ ì¦ê°€ â†’ ì‹ ê·œ ì›Œí¬ë¡œë“œ ìˆ˜ìš©",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26},
          "targets": [
            {
              "expr": "topk(10, \n  sum(\n    (kube_pod_container_resource_requests{resource=\"cpu\"} - \n     rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) * 730 * 0.04\n  ) by (namespace, pod)\n)",
              "refId": "A",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "__name__": true, "job": true, "instance": true},
                "indexByName": {"namespace": 0, "pod": 1, "Value": 2},
                "renameByName": {"namespace": "Namespace", "pod": "Pod", "Value": "Wasted Cost (USD/month)"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Wasted Cost (USD/month)"},
                "properties": [
                  {"id": "unit", "value": "currencyUSD"},
                  {"id": "decimals", "value": 2},
                  {"id": "custom.align", "value": "right"},
                  {"id": "custom.cellOptions", "value": {"type": "color-background"}},
                  {"id": "thresholds", "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                      {"value": 50, "color": "rgba(255, 217, 125, 0.3)"},
                      {"value": 100, "color": "rgba(244, 139, 139, 0.3)"}
                    ]
                  }}
                ]
              }
            ]
          }
        },
        {
          "type": "table",
          "id": 41,
          "title": "Performance Bottleneck Details",
          "description": "**ì„±ëŠ¥ ë³‘ëª©ì´ ë°œìƒ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ìƒì„¸ ëª©ë¡**\n\n**ê³„ì‚°ì‹**:\n(\n  rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]) / \n  on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"cpu\"}\n) > 0.9\nOR\n(\n  container_memory_working_set_bytes{container!=\"\"} / \n  on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"memory\"}\n) > 0.9\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- CPU ë˜ëŠ” Memory Limitì˜ 90% ì´ìƒ ì‚¬ìš© ì¤‘\n- Namespace, Pod, Container ë‹¨ìœ„ë¡œ ì‹ë³„\n- ì‹¤ì‹œê°„ ë³‘ëª© ì§€ì  ìƒì„¸ ì •ë³´\n\n**ì»¬ëŸ¼ ì •ë³´**:\n- **Namespace**: ì›Œí¬ë¡œë“œ ê·¸ë£¹\n- **Pod**: ì‹¤í–‰ ì¤‘ì¸ Podëª…\n- **Container**: ì»¨í…Œì´ë„ˆëª…\n- **Resource**: CPU ë˜ëŠ” Memory\n- **Usage %**: Limit ëŒ€ë¹„ ì‚¬ìš©ë¥ \n\n**ìš°ì„ ìˆœìœ„ íŒë‹¨**:\n- **Usage > 95%**: ì¦‰ì‹œ ì¡°ì¹˜ (OOM Kill, Throttling ì„ë°•)\n- **Usage 90-95%**: 1ì‹œê°„ ë‚´ ì¡°ì¹˜\n- **Production NS**: ë‹¤ë¥¸ í™˜ê²½ë³´ë‹¤ ìš°ì„ \n\n**ì¡°ì¹˜ ë°©ë²•**:\n1. **ì„ì‹œ ì¡°ì¹˜**: Limit ê°’ ì¦‰ì‹œ ì¦ê°€ (kubectl patch)\n2. **ê·¼ë³¸ í•´ê²°**: HPA/VPA í™œì„±í™”\n3. **ì½”ë“œ ê°œì„ **: ë¦¬ì†ŒìŠ¤ ì‚¬ìš© ìµœì í™”\n\n**kubectl ëª…ë ¹ì–´**:\n```bash\n# Podì˜ ë¦¬ì†ŒìŠ¤ í™•ì¸\nkubectl top pod <pod-name> -n <namespace>\n\n# Limit ì¦ê°€ (ì„ì‹œ)\nkubectl set resources deployment <deployment> \\\n  --limits=cpu=2,memory=4Gi -n <namespace>\n\n# HPA ìƒì„±\nkubectl autoscale deployment <deployment> \\\n  --cpu-percent=80 --min=2 --max=10 -n <namespace>\n```\n\n**ì°¸ê³ **:\n- ì´ í…Œì´ë¸”ì´ ë¹„ì–´ ìˆìœ¼ë©´ = ë³‘ëª© ì—†ìŒ (ì´ìƒì )\n- ì§€ì†ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” Pod = êµ¬ì¡°ì  ë¬¸ì œ",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26},
          "targets": [
            {
              "expr": "(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]) / on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"cpu\"}) > 0.9",
              "refId": "A",
              "format": "table",
              "instant": true
            },
            {
              "expr": "(container_memory_working_set_bytes{container!=\"\"} / on(namespace,pod,container) kube_pod_container_resource_limits{resource=\"memory\"}) > 0.9",
              "refId": "B",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "merge"
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "__name__": true, "job": true, "instance": true, "id": true, "image": true},
                "indexByName": {"namespace": 0, "pod": 1, "container": 2, "resource": 3, "Value": 4},
                "renameByName": {"namespace": "Namespace", "pod": "Pod", "container": "Container", "resource": "Resource", "Value": "Usage %"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Usage %"},
                "properties": [
                  {"id": "unit", "value": "percentunit"},
                  {"id": "decimals", "value": 1},
                  {"id": "custom.align", "value": "right"},
                  {"id": "custom.cellOptions", "value": {"type": "color-background"}},
                  {"id": "thresholds", "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": 0.9, "color": "rgba(255, 217, 125, 0.3)"},
                      {"value": 0.95, "color": "rgba(244, 139, 139, 0.3)"}
                    ]
                  }}
                ]
              }
            ]
          }
        },
        {
          "type": "table",
          "id": 50,
          "title": "Slow Query Analysis (Trino - Last 1h)",
          "description": "**ëŠë¦° Trino ì¿¼ë¦¬ ë¶„ì„ (ìµœê·¼ 1ì‹œê°„)**\n\n**ê³„ì‚°ì‹**:\ntopk(20, \n  avg(rate(trino_execution_query_execution_time_seconds_sum[1h])) by (query_id, user, source) / \n  avg(rate(trino_execution_query_execution_time_seconds_count[1h])) by (query_id, user, source)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- í‰ê·  ì‹¤í–‰ ì‹œê°„ì´ ê¸´ ì¿¼ë¦¬ Top 20\n- ì‚¬ìš©ì, ì¿¼ë¦¬ ì†ŒìŠ¤(Dashboard, CLI, API) í¬í•¨\n- ìµœì í™” ìš°ì„ ìˆœìœ„ ê²°ì •\n\n**ì¿¼ë¦¬ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸**:\n1. **íŒŒí‹°ì…˜ í”„ë£¨ë‹**: WHERE ì ˆì— íŒŒí‹°ì…˜ ì»¬ëŸ¼ ì¶”ê°€\n2. **ì»¬ëŸ¼ í”„ë¡œì ì…˜**: SELECT * ëŒ€ì‹  í•„ìš” ì»¬ëŸ¼ë§Œ\n3. **Join ìˆœì„œ**: ì‘ì€ í…Œì´ë¸”ì„ ë¨¼ì €\n4. **Predicate Pushdown**: í•„í„°ë¥¼ ê°€ëŠ¥í•œ ì¼ì°\n5. **í†µê³„ ì •ë³´**: ANALYZE TABLE ì‹¤í–‰\n\n**Trino UI ë¶„ì„ ë°©ë²•**:\n1. Query IDë¡œ Trino UI ì ‘ì†\n2. Query Plan í™•ì¸ (Logical, Distributed)\n3. Stageë³„ ì‹¤í–‰ ì‹œê°„ ë° ë°ì´í„° ìŠ¤ìº”ëŸ‰\n4. Split ë¶„í¬ í™•ì¸ (ë°ì´í„° ìŠ¤í íƒì§€)\n\n**ì¼ë°˜ì ì¸ ì„±ëŠ¥ íŒ¨í„´**:\n- **Full Table Scan**: íŒŒí‹°ì…˜ í•„í„° ëˆ„ë½\n- **Cross Join**: ì¡°ì¸ ì¡°ê±´ ëˆ„ë½\n- **Large Shuffle**: groupBy í‚¤ ì¹´ë””ë„ë¦¬í‹° ë†’ìŒ\n- **Data Skew**: íŠ¹ì • Workerì— ë¶€í•˜ ì§‘ì¤‘\n\n**ì†ŒìŠ¤ë³„ ìµœì í™”**:\n- **Dashboard**: ê²°ê³¼ ìºì‹±, Materialized View\n- **Ad-hoc**: êµìœ¡, Query Review\n- **ETL**: Spark ì‚¬ìš© ê³ ë ¤ (ëŒ€ëŸ‰ ì²˜ë¦¬)\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Query IDë¡œ Trino UIì—ì„œ ìƒì„¸ ë¶„ì„\n- ì‚¬ìš©ìì—ê²Œ ìµœì í™” ê°€ì´ë“œ ì œê³µ\n- ë¹ˆë²ˆí•œ ëŠë¦° ì¿¼ë¦¬ â†’ Materialized View ìƒì„±\n\n**ì°¸ê³ **: ì¿¼ë¦¬ í…ìŠ¤íŠ¸ëŠ” ë©”íŠ¸ë¦­ì— í¬í•¨ ì•ˆ ë¨ (Trino UIì—ì„œ í™•ì¸)",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 34},
          "targets": [
            {
              "expr": "topk(20, \n  avg(rate(trino_execution_query_execution_time_seconds_sum[1h])) by (query_id, user, source) / \n  avg(rate(trino_execution_query_execution_time_seconds_count[1h])) by (query_id, user, source)\n)",
              "refId": "A",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "__name__": true, "job": true, "instance": true},
                "indexByName": {"query_id": 0, "user": 1, "source": 2, "Value": 3},
                "renameByName": {"query_id": "Query ID", "user": "User", "source": "Source", "Value": "Avg Execution Time (s)"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Avg Execution Time (s)"},
                "properties": [
                  {"id": "unit", "value": "s"},
                  {"id": "decimals", "value": 1},
                  {"id": "custom.align", "value": "right"},
                  {"id": "custom.cellOptions", "value": {"type": "color-background"}},
                  {"id": "thresholds", "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                      {"value": 30, "color": "rgba(255, 217, 125, 0.3)"},
                      {"value": 60, "color": "rgba(244, 139, 139, 0.3)"}
                    ]
                  }}
                ]
              },
              {
                "matcher": {"id": "byName", "options": "Query ID"},
                "properties": [
                  {"id": "custom.width", "value": 350},
                  {"id": "links", "value": [{
                    "title": "Open in Trino UI",
                    "url": "http://trino.k8s-cluster-01.miribit.lab/ui/query/${__value.raw}"
                  }]}
                ]
              }
            ]
          }
        }
      ]
    }

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-dataops-workload-v4
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  dataops-workload-v4.json: |
    {
      "uid": "dataops-workload-v4",
      "title": "DataOps - 4. Workload Performance",
      "tags": ["dataops", "workload", "spark", "airflow", "trino"],
      "timezone": "Asia/Seoul",
      "schemaVersion": 39,
      "version": 4,
      "refresh": "30s",
      "graphTooltip": 1,
      "editable": true,
      "style": "dark",
      "panels": [
        {
          "type": "text",
          "id": 1,
          "title": "",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "options": {
            "mode": "markdown",
            "content": "# ğŸš€ Workload Performance Dashboard\n\n**ëª©ì **: ë¹…ë°ì´í„° ì›Œí¬ë¡œë“œ ì‹¤í–‰ ì„±ëŠ¥ ë° ì•ˆì •ì„± ëª¨ë‹ˆí„°ë§\n\n**ëª¨ë‹ˆí„°ë§ ì›Œí¬ë¡œë“œ**: Apache Spark (ë°°ì¹˜/ìŠ¤íŠ¸ë¦¬ë°) | Airflow (ì›Œí¬í”Œë¡œìš°) | Trino (ë¶„ì‚° ì¿¼ë¦¬)\n\n[â—€ í¬í„¸ë¡œ ëŒì•„ê°€ê¸°](/d/dataops-portal-e2e-v4)"
          },
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# ğŸš€ Workload Performance Dashboard\n\n**ëª©ì **: ë¹…ë°ì´í„° ì›Œí¬ë¡œë“œ ì‹¤í–‰ ì„±ëŠ¥ ë° ì•ˆì •ì„± ëª¨ë‹ˆí„°ë§\n\n**ëª¨ë‹ˆí„°ë§ ì›Œí¬ë¡œë“œ**: Apache Spark (ë°°ì¹˜/ìŠ¤íŠ¸ë¦¬ë°) | Airflow (ì›Œí¬í”Œë¡œìš°) | Trino (ë¶„ì‚° ì¿¼ë¦¬)\n\n[â—€ í¬í„¸ë¡œ ëŒì•„ê°€ê¸°](/d/dataops-portal-e2e-v4)",
            "mode": "markdown"
          }
        },
        {
          "type": "stat",
          "id": 10,
          "title": "Spark Job Success Rate",
          "description": "**Apache Spark Job ì„±ê³µë¥  (ìµœê·¼ 1ì‹œê°„)**\n\n**ê³„ì‚°ì‹**:\nsum(rate(spark_application_completed_total{result=\"succeeded\"}[1h])) / \nsum(rate(spark_application_completed_total[1h])) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Spark ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì™„ë£Œ ìƒíƒœë³„ ê°œìˆ˜ë¥¼ ì§‘ê³„\n- succeeded ìƒíƒœì˜ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ì—¬ ì„±ê³µë¥  ì‚°ì¶œ\n- ë°°ì¹˜ Jobê³¼ Streaming Job ëª¨ë‘ í¬í•¨\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 95% ì´ìƒ: ìš°ìˆ˜ (ì•ˆì •ì ì¸ Job ì‹¤í–‰)\n- ğŸŸ¡ 90-95%: ì–‘í˜¸ (ê°„í—ì  ì‹¤íŒ¨)\n- ğŸ”´ 90% ë¯¸ë§Œ: ìœ„í—˜ (ê·¼ë³¸ ì›ì¸ ë¶„ì„ í•„ìš”)\n\n**ì‹¤íŒ¨ ì›ì¸ ë¶„ì„**:\n1. **ë©”ëª¨ë¦¬ ë¶€ì¡±**: executor-memory, driver-memory ì„¤ì • ê²€í† \n2. **ë°ì´í„° ìŠ¤í**: íŒŒí‹°ì…˜ ë¶ˆê· í˜•ìœ¼ë¡œ ì¸í•œ ì¼ë¶€ Task ì§€ì—°\n3. **ì˜ì¡´ì„± ì˜¤ë¥˜**: ì™¸ë¶€ ì‹œìŠ¤í…œ (S3, Hive Metastore) ì—°ê²° ì‹¤íŒ¨\n4. **ë¦¬ì†ŒìŠ¤ ê²½ìŸ**: í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ë¶€ì¡±\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Spark History Serverì—ì„œ ì‹¤íŒ¨í•œ Jobì˜ ìƒì„¸ ë¡œê·¸ í™•ì¸\n- Event Timelineì—ì„œ ë³‘ëª© Stage ì‹ë³„\n- ë¦¬ì†ŒìŠ¤ ìš”ì²­ëŸ‰ (cores, memory) ì¬ì¡°ì •\n\n**SLO**: >95% (ì£¼ê°„ í‰ê· )\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Stage Duration, Executor Memory Usage",
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 4},
          "targets": [
            {
              "expr": "sum(rate(spark_application_completed_total{result=\"succeeded\"}[1h])) / sum(rate(spark_application_completed_total[1h])) * 100",
              "refId": "A",
              "legendFormat": "Success Rate"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 139, 139, 0.3)"},
                  {"value": 90, "color": "rgba(255, 180, 71, 0.3)"},
                  {"value": 95, "color": "rgba(255, 180, 71, 0.5)"}
                ]
              },
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "stat",
          "id": 11,
          "title": "Airflow DAG Success Rate",
          "description": "**Airflow DAG ì‹¤í–‰ ì„±ê³µë¥  (ìµœê·¼ 1ì‹œê°„)**\n\n**ê³„ì‚°ì‹**:\nsum(rate(airflow_dagrun_success[1h])) / \nsum(rate(airflow_dagrun_total[1h])) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Airflow DAG Runì˜ ì„±ê³µ/ì‹¤íŒ¨/ìŠ¤í‚µ ìƒíƒœ ì§‘ê³„\n- ì „ì²´ ì‹¤í–‰ ëŒ€ë¹„ ì„±ê³µ ë¹„ìœ¨ ê³„ì‚°\n- ì›Œí¬í”Œë¡œìš° ì•ˆì •ì„±ì˜ í•µì‹¬ ì§€í‘œ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 98% ì´ìƒ: ìš°ìˆ˜ (ìë™í™” íŒŒì´í”„ë¼ì¸ ì•ˆì •)\n- ğŸŸ¡ 95-98%: ì–‘í˜¸ (ì¼ë¶€ Task ì¬ì‹œë„ ë°œìƒ)\n- ğŸ”´ 95% ë¯¸ë§Œ: ìœ„í—˜ (íŒŒì´í”„ë¼ì¸ ì‹ ë¢°ì„± ì €í•˜)\n\n**ì‹¤íŒ¨ ì›ì¸ ë¶„ì„**:\n1. **Upstream ì˜ì¡´ì„±**: ì„ í–‰ Task ì‹¤íŒ¨ë¡œ ì¸í•œ ì—°ì‡„ ì‹¤íŒ¨\n2. **ì™¸ë¶€ ì—°ë™ ì˜¤ë¥˜**: API í˜¸ì¶œ, DB ì—°ê²°, íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ì‹¤íŒ¨\n3. **ë°ì´í„° í’ˆì§ˆ**: ì…ë ¥ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨\n4. **ë¦¬ì†ŒìŠ¤ ì œì•½**: Worker ë¶€ì¡±ìœ¼ë¡œ Task ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Airflow UIì—ì„œ ì‹¤íŒ¨í•œ Taskì˜ ë¡œê·¸ í™•ì¸\n- Task Instance ìƒíƒœ (queued, running, failed, retry) ë¶„ì„\n- DAG ì„¤ì •ì˜ retry, timeout íŒŒë¼ë¯¸í„° ê²€í† \n- ì™¸ë¶€ ì‹œìŠ¤í…œ Health Check\n\n**SLO**: >98% (ì£¼ê°„ í‰ê· )\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Task Duration, Scheduler Latency",
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 4},
          "targets": [
            {
              "expr": "sum(rate(airflow_dagrun_success[1h])) / sum(rate(airflow_dagrun_total[1h])) * 100",
              "refId": "A",
              "legendFormat": "DAG Success Rate"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 139, 139, 0.3)"},
                  {"value": 95, "color": "rgba(255, 180, 71, 0.3)"},
                  {"value": 98, "color": "rgba(255, 180, 71, 0.5)"}
                ]
              },
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "stat",
          "id": 12,
          "title": "Trino Query Success Rate",
          "description": "**Trino ì¿¼ë¦¬ ì‹¤í–‰ ì„±ê³µë¥  (ìµœê·¼ 1ì‹œê°„)**\n\n**ê³„ì‚°ì‹**:\nsum(rate(trino_execution_query_completed{query_state=\"FINISHED\"}[1h])) / \nsum(rate(trino_execution_query_completed[1h])) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Trino ì¿¼ë¦¬ì˜ ìµœì¢… ìƒíƒœ (FINISHED, FAILED, CANCELED) ì§‘ê³„\n- ì •ìƒ ì™„ë£Œëœ ì¿¼ë¦¬ì˜ ë¹„ìœ¨ ì‚°ì¶œ\n- ë¶„ì‚° ì¿¼ë¦¬ ì—”ì§„ì˜ ì•ˆì •ì„± ì§€í‘œ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 97% ì´ìƒ: ìš°ìˆ˜ (ì•ˆì •ì ì¸ ì¿¼ë¦¬ ì‹¤í–‰)\n- ğŸŸ¡ 93-97%: ì–‘í˜¸ (ì¼ë¶€ ë³µì¡í•œ ì¿¼ë¦¬ ì‹¤íŒ¨)\n- ğŸ”´ 93% ë¯¸ë§Œ: ìœ„í—˜ (ë°ì´í„° ì†ŒìŠ¤ ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ë¬¸ì œ)\n\n**ì‹¤íŒ¨ ì›ì¸ ë¶„ì„**:\n1. **ë©”ëª¨ë¦¬ ë¶€ì¡±**: query.max-memory-per-node ì´ˆê³¼\n2. **íƒ€ì„ì•„ì›ƒ**: query.max-execution-time ì´ˆê³¼ (ë³µì¡í•œ Join)\n3. **Connector ì˜¤ë¥˜**: Hive Metastore, S3 ì—°ê²° ì‹¤íŒ¨\n4. **ë°ì´í„° ìŠ¤ìº” ê³¼ë‹¤**: íŒŒí‹°ì…˜ í”„ë£¨ë‹ ë¯¸ì ìš©\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Trino UIì—ì„œ ì‹¤íŒ¨ ì¿¼ë¦¬ì˜ Query Plan ë¶„ì„\n- Split ë¶„í¬ ë° Worker ë¶€í•˜ í™•ì¸\n- Hive Metastore ë° S3 ì—°ê²° ìƒíƒœ ì ê²€\n- ì¿¼ë¦¬ ìµœì í™” (íŒŒí‹°ì…˜ í•„í„°, Predicate Pushdown)\n\n**SLO**: >97% (ì£¼ê°„ í‰ê· )\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Query p95 Latency, Running Queries",
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 4},
          "targets": [
            {
              "expr": "sum(rate(trino_execution_query_completed{query_state=\"FINISHED\"}[1h])) / sum(rate(trino_execution_query_completed[1h])) * 100",
              "refId": "A",
              "legendFormat": "Query Success Rate"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(244, 139, 139, 0.3)"},
                  {"value": 93, "color": "rgba(255, 180, 71, 0.3)"},
                  {"value": 97, "color": "rgba(255, 180, 71, 0.5)"}
                ]
              },
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "area",
            "orientation": "auto",
            "textMode": "value_and_name",
            "colorMode": "background"
          }
        },
        {
          "type": "gauge",
          "id": 13,
          "title": "Active Workload Count",
          "description": "**í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì›Œí¬ë¡œë“œ ê°œìˆ˜**\n\n**ê³„ì‚°ì‹**:\nsum(spark_application_running) + \nsum(airflow_dagrun_running) + \nsum(trino_execution_query_running)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- 3ê°€ì§€ ì›Œí¬ë¡œë“œ ì—”ì§„ì˜ ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… í•©ê³„\n- í´ëŸ¬ìŠ¤í„° ë¶€í•˜ ìƒíƒœì˜ ì‹¤ì‹œê°„ ì§€í‘œ\n- ë¦¬ì†ŒìŠ¤ í• ë‹¹ ê³„íšì— í™œìš©\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-50ê°œ: ì—¬ìœ  ìˆìŒ\n- ğŸŸ¡ 50-100ê°œ: ì ì • ë¶€í•˜\n- ğŸ”´ 100ê°œ ì´ìƒ: ë†’ì€ ë¶€í•˜ (ë¦¬ì†ŒìŠ¤ ê²½ìŸ)\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- 100ê°œ ì´ìƒ ì‹œ Job Queue ë¶„ì„\n- ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  (CPU, Memory) ëª¨ë‹ˆí„°ë§\n- ìš°ì„ ìˆœìœ„ ë‚®ì€ Job ì¼ì‹œ ì¤‘ì§€ ê³ ë ¤\n\n**ì°¸ê³ **: ë™ì‹œ ì‹¤í–‰ ì œí•œì€ ë¦¬ì†ŒìŠ¤ Quotaë¡œ ê´€ë¦¬",
          "gridPos": {"h": 6, "w": 6, "x": 18, "y": 4},
          "targets": [
            {
              "expr": "sum(spark_application_running) + sum(airflow_dagrun_running) + sum(trino_execution_query_running)",
              "refId": "A",
              "legendFormat": "Active Count"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(255, 180, 71, 0.3)"},
                  {"value": 50, "color": "rgba(255, 180, 71, 0.4)"},
                  {"value": 100, "color": "rgba(244, 139, 139, 0.3)"}
                ]
              },
              "min": 0,
              "max": 150
            }
          },
          "options": {
            "showThresholdLabels": true,
            "showThresholdMarkers": true
          }
        },
        {
          "type": "timeseries",
          "id": 20,
          "title": "Spark Job Execution Rate (Jobs/min)",
          "description": "**Spark Job ì‹¤í–‰ ë¹ˆë„ (ë¶„ë‹¹ ì‹œì‘ ê°œìˆ˜)**\n\n**ê³„ì‚°ì‹**:\nsum(rate(spark_application_started_total[5m])) * 60\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- 5ë¶„ ë‹¨ìœ„ë¡œ ì¸¡ì •í•œ ì´ˆë‹¹ Job ì‹œì‘ ê°œìˆ˜ë¥¼ ë¶„ë‹¹ìœ¼ë¡œ í™˜ì‚°\n- ë°°ì¹˜ ì›Œí¬ë¡œë“œì˜ ì²˜ë¦¬ëŸ‰ ì§€í‘œ\n- ì‹œê°„ëŒ€ë³„ ë¶€í•˜ íŒ¨í„´ íŒŒì•…\n\n**íŒ¨í„´ ë¶„ì„**:\n- **í”¼í¬ ì‹œê°„ëŒ€**: í†µìƒ 09:00-11:00, 14:00-16:00\n- **ë°°ì¹˜ ìœˆë„ìš°**: ìƒˆë²½ 02:00-05:00 (ëŒ€ìš©ëŸ‰ ETL)\n- **ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°**: ì¼ì •í•œ ì‹¤í–‰ë¥  ìœ ì§€\n\n**ì´ìƒ ì§•í›„**:\n- ê¸‰ê²©í•œ ì¦ê°€: Job Submission í­ì£¼ (ìŠ¤ì¼€ì¤„ëŸ¬ ì˜¤ë¥˜)\n- ê¸‰ê²©í•œ ê°ì†Œ: í´ëŸ¬ìŠ¤í„° ì¥ì•  ë˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ë‹¨\n- 0ìœ¼ë¡œ ë–¨ì–´ì§: Spark Submit ì„œë¹„ìŠ¤ ì¥ì• \n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- ë¹„ì •ìƒ íŒ¨í„´ ë°œê²¬ ì‹œ ìŠ¤ì¼€ì¤„ëŸ¬ (Airflow) ë¡œê·¸ í™•ì¸\n- ë¦¬ì†ŒìŠ¤ ë¶€ì¡±ìœ¼ë¡œ Jobì´ ëŒ€ê¸°ì—´ì— ìŒ“ì´ëŠ”ì§€ ì ê²€\n- ë™ì‹œ ì‹¤í–‰ ì œí•œ (spark.scheduler.maxConcurrentJobs) ê²€í† \n\n**ì •ìƒ ë²”ìœ„**: í‰ê·  10-30 jobs/min (í”¼í¬ ì‹œ 50-80)",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
          "targets": [
            {
              "expr": "sum(rate(spark_application_started_total[5m])) * 60",
              "refId": "A",
              "legendFormat": "Job Start Rate"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 20,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic", "fixedColor": "rgba(255, 180, 71, 0.8)"}
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "none"},
            "legend": {"displayMode": "list", "placement": "bottom", "calcs": ["mean", "max"]}
          }
        },
        {
          "type": "timeseries",
          "id": 21,
          "title": "Airflow Task Execution Rate (Tasks/min)",
          "description": "**Airflow Task ì‹¤í–‰ ë¹ˆë„ (ë¶„ë‹¹ ì‹œì‘ ê°œìˆ˜)**\n\n**ê³„ì‚°ì‹**:\nsum(rate(airflow_task_started_total[5m])) * 60\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Airflowì—ì„œ ìŠ¤ì¼€ì¤„ë§ëœ Taskì˜ ì‹œì‘ ë¹ˆë„\n- DAG ë‚´ Taskë“¤ì˜ ë³‘ë ¬ ì‹¤í–‰ í¬í•¨\n- ì›Œí¬í”Œë¡œìš° ì²˜ë¦¬ëŸ‰ì˜ í•µì‹¬ ì§€í‘œ\n\n**íŒ¨í„´ ë¶„ì„**:\n- **ì •ì‹œ Spike**: DAG ìŠ¤ì¼€ì¤„ ì‹œì‘ ì‹œì  (ì˜ˆ: ë§¤ì‹œ ì •ê°)\n- **í‰íƒ„í™”**: Taskê°€ Worker Poolì—ì„œ ê³ ë¥´ê²Œ ì²˜ë¦¬ë¨\n- **ê³„ë‹¨ì‹ ì¦ê°€**: ìˆœì°¨ Taskë“¤ì˜ ë‹¨ê³„ë³„ ì‹¤í–‰\n\n**ì´ìƒ ì§•í›„**:\n- ê¸‰ê²©í•œ ì¦ê°€ í›„ ë©ˆì¶¤: Worker ë¶€ì¡±ìœ¼ë¡œ Queue ì ì²´\n- 0ìœ¼ë¡œ ë–¨ì–´ì§: Scheduler ë˜ëŠ” Executor ì¥ì• \n- ë¶ˆê·œì¹™í•œ Spike: Task ì¬ì‹œë„ í­ì£¼\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Task State ë¶„í¬ í™•ì¸ (queued, running, success, failed)\n- Worker Slot ê°€ìš©ëŸ‰ ì ê²€ (airflow_pool_open_slots)\n- Executor (CeleryExecutor, KubernetesExecutor) ë¡œê·¸ í™•ì¸\n- DAGì˜ concurrency, max_active_tasks ì„¤ì • ê²€í† \n\n**ì •ìƒ ë²”ìœ„**: í‰ê·  50-150 tasks/min (DAG ê°œìˆ˜ì— ë¹„ë¡€)\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Task Duration, Pool Utilization",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
          "targets": [
            {
              "expr": "sum(rate(airflow_task_started_total[5m])) * 60",
              "refId": "A",
              "legendFormat": "Task Start Rate"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 20,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic", "fixedColor": "rgba(255, 180, 71, 0.8)"}
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "none"},
            "legend": {"displayMode": "list", "placement": "bottom", "calcs": ["mean", "max"]}
          }
        },
        {
          "type": "timeseries",
          "id": 30,
          "title": "Spark Stage Duration p95 (seconds)",
          "description": "**Spark Stage ì‹¤í–‰ ì‹œê°„ 95 ë°±ë¶„ìœ„ìˆ˜**\n\n**ê³„ì‚°ì‹**:\nhistogram_quantile(0.95, \n  sum(rate(spark_stage_duration_seconds_bucket[5m])) by (app_name, le)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Spark Job ë‚´ Stageë³„ ì‹¤í–‰ ì‹œê°„ì˜ p95 ê°’\n- 95%ì˜ Stageê°€ ì´ ì‹œê°„ ë‚´ì— ì™„ë£Œë¨ì„ ì˜ë¯¸\n- ì„±ëŠ¥ ë³‘ëª© êµ¬ê°„ ì‹ë³„ì˜ í•µì‹¬ ì§€í‘œ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-60ì´ˆ: ìš°ìˆ˜ (ì‘ì€ ë°ì´í„°ì…‹ ë˜ëŠ” ìµœì í™”ëœ ì¿¼ë¦¬)\n- ğŸŸ¡ 60-300ì´ˆ: ì–‘í˜¸ (ì¤‘ê°„ ê·œëª¨ ë°ì´í„° ì²˜ë¦¬)\n- ğŸ”´ 300ì´ˆ ì´ìƒ: ì£¼ì˜ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ë˜ëŠ” ë¹„íš¨ìœ¨ì  ì—°ì‚°)\n\n**ì„±ëŠ¥ ë³‘ëª© ì›ì¸**:\n1. **Shuffle ê³¼ë‹¤**: Wide Transformation (groupBy, join)ìœ¼ë¡œ ì¸í•œ ë„¤íŠ¸ì›Œí¬ I/O\n2. **ë°ì´í„° ìŠ¤í**: íŠ¹ì • íŒŒí‹°ì…˜ì— ë°ì´í„° ì§‘ì¤‘ìœ¼ë¡œ Straggler Task ë°œìƒ\n3. **GC ì••ë°•**: Executor ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ Garbage Collection ë¹ˆë²ˆ\n4. **ë””ìŠ¤í¬ Spill**: ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ ì„ì‹œ ë””ìŠ¤í¬ ì‚¬ìš©\n\n**ìµœì í™” ë°©ë²•**:\n- **íŒŒí‹°ì…˜ ì¬ë¶„ë°°**: repartition() ë˜ëŠ” coalesce()ë¡œ ê· ë“± ë¶„ë°°\n- **Broadcast Join**: ì‘ì€ í…Œì´ë¸”ì„ Driverì—ì„œ Broadcast\n- **ë©”ëª¨ë¦¬ ì¦ì„¤**: executor-memory, driver-memory ì¦ê°€\n- **Predicate Pushdown**: ë¶ˆí•„ìš”í•œ ë°ì´í„° ìŠ¤ìº” ìµœì†Œí™”\n\n**SLO**: p95 < 180ì´ˆ (3ë¶„)\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Executor Memory Usage, GC Time Ratio",
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 18},
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(spark_stage_duration_seconds_bucket[5m])) by (app_name, le))",
              "refId": "A",
              "legendFormat": "{{app_name}} p95"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "decimals": 0,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 15,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 60, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 300, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 31,
          "title": "Airflow Task Duration p95 (seconds)",
          "description": "**Airflow Task ì‹¤í–‰ ì‹œê°„ 95 ë°±ë¶„ìœ„ìˆ˜**\n\n**ê³„ì‚°ì‹**:\nhistogram_quantile(0.95, \n  sum(rate(airflow_task_duration_seconds_bucket[5m])) by (dag_id, task_id, le)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- DAG ë‚´ ê° Taskì˜ ì‹¤í–‰ ì‹œê°„ p95 ê°’\n- 95%ì˜ Task ì‹¤í–‰ì´ ì´ ì‹œê°„ ë‚´ì— ì™„ë£Œ\n- Task ì„±ëŠ¥ ì¶”ì´ ë° SLA ì¤€ìˆ˜ ëª¨ë‹ˆí„°ë§\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-120ì´ˆ: ìš°ìˆ˜ (ê²½ëŸ‰ Task ë˜ëŠ” API í˜¸ì¶œ)\n- ğŸŸ¡ 120-600ì´ˆ: ì–‘í˜¸ (ë°ì´í„° ì „ì²˜ë¦¬, ì¤‘ê°„ ê·œëª¨ ì¿¼ë¦¬)\n- ğŸ”´ 600ì´ˆ ì´ìƒ: ì£¼ì˜ (ì¥ì‹œê°„ ì‹¤í–‰ Task, SLA ì´ˆê³¼ ìœ„í—˜)\n\n**ì§€ì—° ì›ì¸ ë¶„ì„**:\n1. **ì™¸ë¶€ API ì§€ì—°**: HTTP í˜¸ì¶œì˜ Timeout ë˜ëŠ” Rate Limit\n2. **DB ì¿¼ë¦¬ ì„±ëŠ¥**: ì¸ë±ìŠ¤ ë¶€ì¬ ë˜ëŠ” Full Table Scan\n3. **íŒŒì¼ ì‹œìŠ¤í…œ I/O**: S3, NFSì—ì„œ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì½ê¸°/ì“°ê¸°\n4. **ë¦¬ì†ŒìŠ¤ ëŒ€ê¸°**: Worker Slot ë¶€ì¡±ìœ¼ë¡œ Task ëŒ€ê¸°\n\n**ìµœì í™” ë°©ë²•**:\n- **Task ë¶„ë¦¬**: ì¥ì‹œê°„ Taskë¥¼ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë¶„í• \n- **ë³‘ë ¬ ì²˜ë¦¬**: Task Group ë˜ëŠ” Dynamic Task Mapping í™œìš©\n- **ë¦¬ì†ŒìŠ¤ í• ë‹¹**: Taskì— ì ì ˆí•œ Queue ë° Pool ì§€ì •\n- **Timeout ì„¤ì •**: execution_timeoutìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€\n\n**SLO**: p95 < 300ì´ˆ (5ë¶„)\n**SLA ì„¤ì •**: Taskë³„ sla íŒŒë¼ë¯¸í„° ì •ì˜ ê¶Œì¥\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Scheduler Latency, DAG Success Rate",
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 18},
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(airflow_task_duration_seconds_bucket[5m])) by (dag_id, task_id, le))",
              "refId": "A",
              "legendFormat": "{{dag_id}}/{{task_id}} p95"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "decimals": 0,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 15,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 120, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 600, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 32,
          "title": "Trino Query p95 Latency (seconds)",
          "description": "**Trino ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ 95 ë°±ë¶„ìœ„ìˆ˜**\n\n**ê³„ì‚°ì‹**:\nhistogram_quantile(0.95, \n  sum(rate(trino_execution_query_execution_time_seconds_bucket[5m])) by (cluster, le)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Trino ì¿¼ë¦¬ì˜ ì‹¤í–‰ ì™„ë£Œ ì‹œê°„ p95 ê°’\n- ì¿¼ë¦¬ íŒŒì‹±, ê³„íš, ì‹¤í–‰, ê²°ê³¼ ë°˜í™˜ì˜ ì „ì²´ ì†Œìš” ì‹œê°„\n- ì‚¬ìš©ì ì²´ê° ì„±ëŠ¥ì˜ í•µì‹¬ ì§€í‘œ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-10ì´ˆ: ìš°ìˆ˜ (ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬)\n- ğŸŸ¡ 10-60ì´ˆ: ì–‘í˜¸ (ë¶„ì„ ì¿¼ë¦¬, ë³µì¡í•œ Join)\n- ğŸ”´ 60ì´ˆ ì´ìƒ: ì£¼ì˜ (ìµœì í™” í•„ìš”)\n\n**ì„±ëŠ¥ ë³‘ëª© ì›ì¸**:\n1. **Full Table Scan**: íŒŒí‹°ì…˜ í•„í„° ëˆ„ë½ìœ¼ë¡œ ì „ì²´ ë°ì´í„° ìŠ¤ìº”\n2. **Cross Join**: ì¹´ë””ë„ë¦¬í‹°ê°€ ë†’ì€ í…Œì´ë¸” ê°„ Join\n3. **ë©”ëª¨ë¦¬ ë¶€ì¡±**: Spill to Disk ë°œìƒ\n4. **Split ë¶ˆê· í˜•**: ë°ì´í„° ë¶„í¬ ë¶ˆê· í˜•ìœ¼ë¡œ Worker ê°„ ë¶€í•˜ ì°¨ì´\n\n**ì¿¼ë¦¬ ìµœì í™”**:\n- **íŒŒí‹°ì…˜ í”„ë£¨ë‹**: WHERE ì ˆì— íŒŒí‹°ì…˜ ì»¬ëŸ¼ (date, region) í•„í„° ì¶”ê°€\n- **Predicate Pushdown**: Connectorì—ì„œ ë¶ˆí•„ìš”í•œ ë°ì´í„° í•„í„°ë§\n- **í†µê³„ ì •ë³´**: ANALYZE TABLEë¡œ CBO (Cost-Based Optimizer) ê°œì„ \n- **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: query.max-memory-per-node ì¡°ì •\n\n**ì¿¼ë¦¬ ë¶„ë¥˜**:\n- **Interactive**: p95 < 10ì´ˆ ëª©í‘œ\n- **Batch**: p95 < 60ì´ˆ ëª©í‘œ\n- **ETL**: ì‹¤í–‰ ì‹œê°„ë³´ë‹¤ ì•ˆì •ì„± ìš°ì„ \n\n**SLO**: p95 < 30ì´ˆ (ì „ì²´ ì¿¼ë¦¬ í‰ê· )\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Query Success Rate, Running Queries",
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 18},
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(trino_execution_query_execution_time_seconds_bucket[5m])) by (cluster, le))",
              "refId": "A",
              "legendFormat": "{{cluster}} p95"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 15,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 10, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 60, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 40,
          "title": "Spark Executor Memory Usage (GB)",
          "description": "**Spark Executorì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**\n\n**ê³„ì‚°ì‹**:\nsum(spark_executor_memory_used_bytes) by (app_name, executor_id) / 1024 / 1024 / 1024\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- ê° Executorê°€ ì‚¬ìš© ì¤‘ì¸ Heap ë©”ëª¨ë¦¬ ìš©ëŸ‰\n- Storage (ìºì‹œëœ RDD/DataFrame)ì™€ Execution (Task ì‹¤í–‰) ë©”ëª¨ë¦¬ í¬í•¨\n- OOM (Out Of Memory) ìœ„í—˜ ëª¨ë‹ˆí„°ë§\n\n**ì •ìƒ ë²”ìœ„**:\n- Executor ë©”ëª¨ë¦¬ í• ë‹¹ëŸ‰ì˜ 80% ì´í•˜ ìœ ì§€ ê¶Œì¥\n- ì˜ˆ: 8GB í• ë‹¹ ì‹œ 6.4GB ì´í•˜\n\n**ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš© ì›ì¸**:\n1. **ìºì‹œ ê³¼ë‹¤**: persist() ë˜ëŠ” cache()ë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë°ì´í„° ëˆ„ì \n2. **Shuffle ë²„í¼**: Wide Transformation ì‹œ ì„ì‹œ ë°ì´í„° ì ì¬\n3. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ì¥ì‹œê°„ ì‹¤í–‰ Streaming Jobì˜ ëˆ„ì \n4. **ëŒ€ìš©ëŸ‰ Broadcast**: Driverì—ì„œ Executorë¡œ ì „ì†¡í•œ í° ë³€ìˆ˜\n\n**OOM ë°œìƒ ì‹œ ì¡°ì¹˜**:\n- **ë©”ëª¨ë¦¬ ì¦ì„¤**: --executor-memory íŒŒë¼ë¯¸í„° ì¦ê°€\n- **ìºì‹œ í•´ì œ**: unpersist()ë¡œ ë¶ˆí•„ìš”í•œ ìºì‹œ ì œê±°\n- **íŒŒí‹°ì…˜ ì¦ê°€**: ë°ì´í„°ë¥¼ ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í• \n- **ë©”ëª¨ë¦¬ ë¹„ìœ¨ ì¡°ì •**: spark.memory.fraction (ê¸°ë³¸ 0.6)\n\n**GC ê´€ê³„**:\n- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  > 90% ì‹œ Full GC ë¹ˆë²ˆ ë°œìƒ\n- GC Time Ratioì™€ í•¨ê»˜ ëª¨ë‹ˆí„°ë§ í•„ìš”\n\n**SLO**: í‰ê·  ì‚¬ìš©ë¥  < 70%\n**ê²½ê³ **: íŠ¹ì • Executorê°€ 90% ì´ˆê³¼ ì‹œ Alert\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: GC Time Ratio, Stage Duration",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26},
          "targets": [
            {
              "expr": "sum(spark_executor_memory_used_bytes) by (app_name, executor_id) / 1024 / 1024 / 1024",
              "refId": "A",
              "legendFormat": "{{app_name}} / {{executor_id}}"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "custom": {
                "lineWidth": 1,
                "fillOpacity": 10,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"}
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 41,
          "title": "Spark GC Time Ratio (%)",
          "description": "**Spark Executorì˜ Garbage Collection ì‹œê°„ ë¹„ìœ¨**\n\n**ê³„ì‚°ì‹**:\nsum(rate(spark_executor_jvm_gc_time_seconds_total[5m])) by (app_name) / \nsum(rate(spark_executor_runtime_seconds_total[5m])) by (app_name) * 100\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Executorì˜ ì´ ì‹¤í–‰ ì‹œê°„ ëŒ€ë¹„ GCì— ì†Œìš”ëœ ì‹œê°„ ë¹„ìœ¨\n- JVM Heap ë©”ëª¨ë¦¬ ê´€ë¦¬ íš¨ìœ¨ì„± ì§€í‘œ\n- ë†’ì€ ë¹„ìœ¨ì€ ë©”ëª¨ë¦¬ ì••ë°• ìƒíƒœë¥¼ ì˜ë¯¸\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-10%: ìš°ìˆ˜ (ì¶©ë¶„í•œ ë©”ëª¨ë¦¬, íš¨ìœ¨ì  ì‹¤í–‰)\n- ğŸŸ¡ 10-20%: ì–‘í˜¸ (ê°„í—ì  GC, ì„±ëŠ¥ ì˜í–¥ ê²½ë¯¸)\n- ğŸ”´ 20% ì´ìƒ: ìœ„í—˜ (ë¹ˆë²ˆí•œ GC, ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜)\n\n**ë†’ì€ GC Time ì›ì¸**:\n1. **ë©”ëª¨ë¦¬ ë¶€ì¡±**: Executor ë©”ëª¨ë¦¬ê°€ ì›Œí¬ë¡œë“œì— ë¹„í•´ ì‘ìŒ\n2. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ì¥ì‹œê°„ ì‹¤í–‰ ì¤‘ ê°ì²´ í•´ì œ ì•ˆ ë¨\n3. **ë¹„íš¨ìœ¨ì  ì½”ë“œ**: ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„± (ì˜ˆ: ë£¨í”„ ë‚´ ë°˜ë³µ ìƒì„±)\n4. **Full GC ë¹ˆë²ˆ**: Old Generation ë©”ëª¨ë¦¬ ê³ ê°ˆ\n\n**ìµœì í™” ë°©ë²•**:\n- **ë©”ëª¨ë¦¬ ì¦ì„¤**: --executor-memory ì¦ê°€ (ì˜ˆ: 4GB â†’ 8GB)\n- **G1GC ì‚¬ìš©**: --conf spark.executor.extraJavaOptions=\"-XX:+UseG1GC\"\n- **ì˜¤í”„í™ ë©”ëª¨ë¦¬**: --conf spark.memory.offHeap.enabled=true\n- **ê°ì²´ ì¬ì‚¬ìš©**: Broadcast ë³€ìˆ˜, Accumulator í™œìš©\n\n**ì„±ëŠ¥ ì˜í–¥**:\n- GC Time 20% = ì‹¤ì œ ê³„ì‚°ì— 80%ë§Œ ì‚¬ìš©\n- Stage Duration ì¦ê°€ ë° ì²˜ë¦¬ëŸ‰ ê°ì†Œ\n\n**SLO**: í‰ê·  < 10%\n**ê²½ê³ **: íŠ¹ì • Appì´ 20% ì´ˆê³¼ ì‹œ Alert\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Executor Memory Usage, Stage Duration",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26},
          "targets": [
            {
              "expr": "sum(rate(spark_executor_jvm_gc_time_seconds_total[5m])) by (app_name) / sum(rate(spark_executor_runtime_seconds_total[5m])) by (app_name) * 100",
              "refId": "A",
              "legendFormat": "{{app_name}} GC Ratio"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 20,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 10, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 20, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"},
            "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "timeseries",
          "id": 50,
          "title": "Airflow Scheduler Latency (seconds)",
          "description": "**Airflow Schedulerì˜ Task ìŠ¤ì¼€ì¤„ë§ ì§€ì—° ì‹œê°„**\n\n**ê³„ì‚°ì‹**:\nrate(airflow_scheduler_critical_section_duration_seconds_sum[5m]) / \nrate(airflow_scheduler_critical_section_duration_seconds_count[5m])\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- DAG íŒŒì¼ íŒŒì‹±ë¶€í„° Taskê°€ Queueì— ë“¤ì–´ê°€ê¸°ê¹Œì§€ì˜ ì‹œê°„\n- Scheduler ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ í•µì‹¬ ì§€í‘œ\n- DAG ê°œìˆ˜, ë³µì¡ë„, DB ì„±ëŠ¥ì— ì˜í–¥ë°›ìŒ\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-5ì´ˆ: ìš°ìˆ˜ (ì¦‰ì‹œ ìŠ¤ì¼€ì¤„ë§)\n- ğŸŸ¡ 5-15ì´ˆ: ì–‘í˜¸ (ë‹¤ì†Œ ì§€ì—°, í—ˆìš© ë²”ìœ„)\n- ğŸ”´ 15ì´ˆ ì´ìƒ: ìœ„í—˜ (ìŠ¤ì¼€ì¤„ë§ ë³‘ëª©, SLA ì´ˆê³¼ ìœ„í—˜)\n\n**ì§€ì—° ì›ì¸ ë¶„ì„**:\n1. **DAG íŒŒì¼ ê³¼ë‹¤**: ìˆ˜ë°± ê°œ ì´ìƒì˜ DAG íŒŒì¼ë¡œ íŒŒì‹± ë¶€í•˜\n2. **ë³µì¡í•œ DAG**: ë§ì€ Taskì™€ ì˜ì¡´ì„± ê´€ê³„\n3. **ë©”íƒ€DB ë¶€í•˜**: Postgres/MySQLì˜ ëŠë¦° ì¿¼ë¦¬\n4. **Scheduler ë‹¨ì¼í™”**: HA êµ¬ì„± ì—†ì´ ë‹¨ì¼ Scheduler ìš´ì˜\n\n**ìµœì í™” ë°©ë²•**:\n- **Scheduler ë‹¤ì¤‘í™”**: scheduler.replicas > 1 (HA)\n- **DAG íŒŒì¼ ìµœì†Œí™”**: ë™ì  DAG ìƒì„±ë³´ë‹¤ ì •ì  íŒŒì¼ ì„ í˜¸\n- **ë©”íƒ€DB ìµœì í™”**: ì¸ë±ìŠ¤ ì¶”ê°€, Connection Pool ì¦ê°€\n- **íŒŒì‹± ì£¼ê¸° ì¡°ì •**: dag_dir_list_interval ì¦ê°€ (ê¸°ë³¸ 5ë¶„)\n\n**ì˜í–¥**:\n- Task ì‹œì‘ ì§€ì—°ìœ¼ë¡œ SLA ì´ˆê³¼\n- ì‹¤ì‹œê°„ íŒŒì´í”„ë¼ì¸ì˜ ë°ì´í„° ì§€ì—°\n\n**SLO**: í‰ê·  < 5ì´ˆ, p95 < 10ì´ˆ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: DAG Processing Time, Task Queue Length",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 34},
          "targets": [
            {
              "expr": "rate(airflow_scheduler_critical_section_duration_seconds_sum[5m]) / rate(airflow_scheduler_critical_section_duration_seconds_count[5m])",
              "refId": "A",
              "legendFormat": "Scheduler Latency"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "decimals": 1,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 20,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic", "fixedColor": "rgba(255, 180, 71, 0.8)"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 5, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 15, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "single"},
            "legend": {"displayMode": "list", "placement": "bottom", "calcs": ["mean", "max"]}
          }
        },
        {
          "type": "timeseries",
          "id": 51,
          "title": "Trino Running Queries",
          "description": "**Trinoì—ì„œ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ê°œìˆ˜**\n\n**ê³„ì‚°ì‹**:\nsum(trino_execution_query_running)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Coordinatorì—ì„œ ì²˜ë¦¬ ì¤‘ì¸ Active ì¿¼ë¦¬ ìˆ˜\n- í´ëŸ¬ìŠ¤í„° ë¶€í•˜ì™€ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì˜ ì‹¤ì‹œê°„ ì§€í‘œ\n- Queued ì¿¼ë¦¬ëŠ” ë¯¸í¬í•¨ (ëŒ€ê¸° ì¤‘)\n\n**ì •ìƒ ë²”ìœ„**:\n- ğŸŸ¢ 0-20ê°œ: ì—¬ìœ  (ì¶”ê°€ ì¿¼ë¦¬ ìˆ˜ìš© ê°€ëŠ¥)\n- ğŸŸ¡ 20-50ê°œ: ì ì • (ë¦¬ì†ŒìŠ¤ ì‚¬ìš© ì¤‘)\n- ğŸ”´ 50ê°œ ì´ìƒ: í¬í™” (ì‹ ê·œ ì¿¼ë¦¬ ì§€ì—° ê°€ëŠ¥)\n\n**ë™ì‹œ ì‹¤í–‰ ì˜í–¥**:\n- ê° ì¿¼ë¦¬ê°€ í´ëŸ¬ìŠ¤í„° ë©”ëª¨ë¦¬/CPUë¥¼ ê³µìœ \n- ë³µì¡í•œ ì¿¼ë¦¬ ë‹¤ìˆ˜ ì‹¤í–‰ ì‹œ ê°œë³„ ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜\n- Resource Groupìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ í• ë‹¹ ì œì–´\n\n**íŒ¨í„´ ë¶„ì„**:\n- **í‰ì‹œ**: 5-15ê°œ (ëŒ€ì‹œë³´ë“œ, Ad-hoc ì¿¼ë¦¬)\n- **í”¼í¬**: 30-50ê°œ (ì—…ë¬´ ì‹œê°„ëŒ€)\n- **ë°°ì¹˜ ìœˆë„ìš°**: 10ê°œ ì´í•˜ (ëŒ€ìš©ëŸ‰ ETL ìœ„ì£¼)\n\n**ì œì–´ ë°©ë²•**:\n- **Query Queue**: query.max-queued ì„¤ì •ìœ¼ë¡œ ëŒ€ê¸°ì—´ ê´€ë¦¬\n- **Resource Group**: íŒ€ë³„, ì¿¼ë¦¬ íƒ€ì…ë³„ ë¦¬ì†ŒìŠ¤ í• ë‹¹\n- **Kill Query**: ì¥ì‹œê°„ ì‹¤í–‰ ì¿¼ë¦¬ ê°•ì œ ì¢…ë£Œ\n\n**Alert ì¡°ê±´**:\n- Running Queries > 50ê°œê°€ 10ë¶„ ì´ìƒ ì§€ì†\n- íŠ¹ì • ì‚¬ìš©ìê°€ 10ê°œ ì´ìƒ ë™ì‹œ ì‹¤í–‰ (ë¹„ì •ìƒ)\n\n**SLO**: í‰ê·  < 30ê°œ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Query p95 Latency, Cluster Memory Usage",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 34},
          "targets": [
            {
              "expr": "sum(trino_execution_query_running)",
              "refId": "A",
              "legendFormat": "Running Queries"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 0,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 25,
                "drawStyle": "line",
                "lineInterpolation": "smooth",
                "showPoints": "never",
                "axisPlacement": "auto"
              },
              "color": {"mode": "palette-classic", "fixedColor": "rgba(255, 180, 71, 0.8)"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                  {"value": 20, "color": "rgba(255, 217, 125, 0.2)"},
                  {"value": 50, "color": "rgba(244, 139, 139, 0.2)"}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "single"},
            "legend": {"displayMode": "list", "placement": "bottom", "calcs": ["mean", "max", "last"]}
          }
        },
        {
          "type": "table",
          "id": 60,
          "title": "Top 10 Long-Running Spark Jobs",
          "description": "**ê°€ì¥ ì˜¤ë˜ ì‹¤í–‰ ì¤‘ì¸ Spark Job Top 10**\n\n**ê³„ì‚°ì‹**:\ntopk(10, \n  (time() - spark_application_start_time_seconds) \n  * on(app_id) group_left(app_name) spark_application_info\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Spark Jobì„ ì‹¤í–‰ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬\n- App Name, App ID, ì‹¤í–‰ ì‹œê°„ (ì´ˆ) í‘œì‹œ\n- ì¥ì‹œê°„ ì‹¤í–‰ Jobì˜ ëª¨ë‹ˆí„°ë§ ë° ì´ìƒ íƒì§€\n\n**ì •ìƒ ë²”ìœ„**:\n- ë°°ì¹˜ Job: 1-4ì‹œê°„ (ëŒ€ìš©ëŸ‰ ETL)\n- ìŠ¤íŠ¸ë¦¬ë° Job: ë¬´ê¸°í•œ (ì—°ì† ì‹¤í–‰)\n- Ad-hoc ë¶„ì„: ìˆ˜ë¶„-ìˆ˜ì‹­ë¶„\n\n**ì´ìƒ ì§•í›„**:\n- ì˜ˆìƒ ì‹œê°„ ëŒ€ë¹„ 2ë°° ì´ìƒ ì§€ì—°\n- í‰ì†Œ 10ë¶„ Jobì´ 1ì‹œê°„ ì´ìƒ\n- íŠ¹ì • Stageì—ì„œ ë©ˆì¶¤ (Straggler Task)\n\n**ì›ì¸ ë¶„ì„**:\n1. **ë°ì´í„° ìŠ¤í**: íŠ¹ì • íŒŒí‹°ì…˜ì— ë°ì´í„° ì§‘ì¤‘\n2. **ë¦¬ì†ŒìŠ¤ ë¶€ì¡±**: Executor í• ë‹¹ ëŒ€ê¸°\n3. **ì™¸ë¶€ ì‹œìŠ¤í…œ ì§€ì—°**: S3, Hive Metastore ì‘ë‹µ ëŠë¦¼\n4. **ë¹„íš¨ìœ¨ì  ì¿¼ë¦¬**: ë¶ˆí•„ìš”í•œ Shuffle, Cross Join\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Spark History Serverì—ì„œ Jobì˜ Stage, Task ìƒì„¸ ë¶„ì„\n- Event Timelineì—ì„œ ë³‘ëª© êµ¬ê°„ ì‹ë³„\n- í•„ìš” ì‹œ Job Kill í›„ íŒŒë¼ë¯¸í„° ì¡°ì •í•˜ì—¬ ì¬ì‹¤í–‰\n- ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ì‹œ í´ëŸ¬ìŠ¤í„° ìŠ¤ì¼€ì¼ ì•„ì›ƒ\n\n**ì°¸ê³ **:\n- Streaming Jobì€ ì •ìƒì ìœ¼ë¡œ ì¥ì‹œê°„ ì‹¤í–‰ë¨\n- app_name íŒ¨í„´ìœ¼ë¡œ Job íƒ€ì… êµ¬ë¶„ ê°€ëŠ¥",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 42},
          "targets": [
            {
              "expr": "topk(10, (time() - spark_application_start_time_seconds) * on(app_id) group_left(app_name) spark_application_info)",
              "refId": "A",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "app_id": false, "__name__": true, "job": true, "instance": true},
                "indexByName": {"app_name": 0, "app_id": 1, "Value": 2},
                "renameByName": {"app_name": "Application Name", "app_id": "App ID", "Value": "Running Time (s)"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Running Time (s)"},
                "properties": [
                  {"id": "unit", "value": "s"},
                  {"id": "decimals", "value": 0},
                  {"id": "custom.align", "value": "right"}
                ]
              }
            ]
          }
        },
        {
          "type": "table",
          "id": 61,
          "title": "Top 10 Failed Airflow Tasks (Last 1h)",
          "description": "**ìµœê·¼ 1ì‹œê°„ ë‚´ ê°€ì¥ ë§ì´ ì‹¤íŒ¨í•œ Airflow Task Top 10**\n\n**ê³„ì‚°ì‹**:\ntopk(10, \n  sum(increase(airflow_task_failed_total[1h])) by (dag_id, task_id)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- DAGë³„, Taskë³„ ì‹¤íŒ¨ íšŸìˆ˜ë¥¼ ì§‘ê³„\n- ë°˜ë³µì ìœ¼ë¡œ ì‹¤íŒ¨í•˜ëŠ” Task ì‹ë³„\n- Task ì•ˆì •ì„± ë° ì¬ì‹œë„ ì •ì±… ê²€í† \n\n**ë¶„ì„ í¬ì¸íŠ¸**:\n- **ë‹¨ì¼ ì‹¤íŒ¨**: ì¼ì‹œì  ì˜¤ë¥˜ (ë„¤íŠ¸ì›Œí¬, ì™¸ë¶€ API)\n- **ë°˜ë³µ ì‹¤íŒ¨**: êµ¬ì¡°ì  ë¬¸ì œ (ì½”ë“œ ë²„ê·¸, ì„¤ì • ì˜¤ë¥˜)\n- **ì—°ì‡„ ì‹¤íŒ¨**: Upstream Task ì‹¤íŒ¨ë¡œ ì¸í•œ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì˜í–¥\n\n**ì‹¤íŒ¨ ì›ì¸ ë¶„ë¥˜**:\n1. **ì½”ë“œ ì˜¤ë¥˜**: Python Exception, SQL ë¬¸ë²• ì˜¤ë¥˜\n2. **ì™¸ë¶€ ì˜ì¡´ì„±**: API íƒ€ì„ì•„ì›ƒ, DB ì—°ê²° ì‹¤íŒ¨\n3. **ë°ì´í„° í’ˆì§ˆ**: ì…ë ¥ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨\n4. **ë¦¬ì†ŒìŠ¤ ì œì•½**: OOM, Disk Full\n\n**Task ìƒíƒœ í™•ì¸**:\n- **failed**: ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ í›„ ìµœì¢… ì‹¤íŒ¨\n- **up_for_retry**: ì¬ì‹œë„ ëŒ€ê¸° ì¤‘\n- **upstream_failed**: ì„ í–‰ Task ì‹¤íŒ¨ë¡œ ì‹¤í–‰ ì•ˆ ë¨\n\n**ì¡°ì¹˜ ì‚¬í•­**:\n- Airflow UI > Task Logsì—ì„œ ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸\n- Taskì˜ retries, retry_delay íŒŒë¼ë¯¸í„° ê²€í† \n- ì™¸ë¶€ ì‹œìŠ¤í…œ Health Check\n- í•„ìš” ì‹œ Manual Clearí•˜ì—¬ ì¬ì‹¤í–‰\n\n**Alert ì¡°ê±´**:\n- íŠ¹ì • Taskê°€ 1ì‹œê°„ ë‚´ 5íšŒ ì´ìƒ ì‹¤íŒ¨\n- Critical DAGì˜ Task ë‹¨ 1íšŒ ì‹¤íŒ¨ë„ ì¦‰ì‹œ ì•Œë¦¼\n\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: DAG Success Rate, Task Duration",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 42},
          "targets": [
            {
              "expr": "topk(10, sum(increase(airflow_task_failed_total[1h])) by (dag_id, task_id))",
              "refId": "A",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "__name__": true, "job": true, "instance": true},
                "indexByName": {"dag_id": 0, "task_id": 1, "Value": 2},
                "renameByName": {"dag_id": "DAG ID", "task_id": "Task ID", "Value": "Failure Count"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Failure Count"},
                "properties": [
                  {"id": "unit", "value": "short"},
                  {"id": "decimals", "value": 0},
                  {"id": "custom.align", "value": "right"},
                  {"id": "custom.cellOptions", "value": {"type": "color-background"}},
                  {"id": "thresholds", "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                      {"value": 3, "color": "rgba(255, 217, 125, 0.3)"},
                      {"value": 5, "color": "rgba(244, 139, 139, 0.3)"}
                    ]
                  }}
                ]
              }
            ]
          }
        },
        {
          "type": "table",
          "id": 62,
          "title": "Top 10 Slowest Trino Queries (Last 1h)",
          "description": "**ìµœê·¼ 1ì‹œê°„ ë‚´ ê°€ì¥ ëŠë¦° Trino ì¿¼ë¦¬ Top 10**\n\n**ê³„ì‚°ì‹**:\ntopk(10, \n  avg(rate(trino_execution_query_execution_time_seconds_sum[1h])) by (query_id, user) / \n  avg(rate(trino_execution_query_execution_time_seconds_count[1h])) by (query_id, user)\n)\n\n**ë©”íŠ¸ë¦­ ì„¤ëª…**:\n- Query IDë³„ í‰ê·  ì‹¤í–‰ ì‹œê°„ì„ ê³„ì‚°í•˜ì—¬ ì •ë ¬\n- ì‚¬ìš©ìë³„ ëŠë¦° ì¿¼ë¦¬ íŒ¨í„´ íŒŒì•…\n- ì¿¼ë¦¬ ìµœì í™” ìš°ì„ ìˆœìœ„ ê²°ì •\n\n**ë¶„ì„ í¬ì¸íŠ¸**:\n- **ë‹¨ë°œì„± ëŠë¦° ì¿¼ë¦¬**: ë°ì´í„° ê·œëª¨ê°€ í° Ad-hoc ë¶„ì„\n- **ë°˜ë³µì  ëŠë¦° ì¿¼ë¦¬**: ëŒ€ì‹œë³´ë“œ, ì •ê¸° ë¦¬í¬íŠ¸ (ìµœì í™” í•„ìš”)\n- **ì•…í™” ì¶”ì„¸**: ë°ì´í„° ì¦ê°€ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜\n\n**ìµœì í™” ëŒ€ìƒ ì„ ì •**:\n1. **ì‹¤í–‰ ë¹ˆë„ ë†’ìŒ + ëŠë¦¼**: ìš°ì„ ìˆœìœ„ 1 (ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ í¼)\n2. **ì‹¤í–‰ ë¹ˆë„ ë‚®ìŒ + ë§¤ìš° ëŠë¦¼**: ìš°ì„ ìˆœìœ„ 2 (ë¦¬ì†ŒìŠ¤ ë…ì )\n3. **ì ì§„ì  ëŠë ¤ì§**: ë°ì´í„° ì¦ê°€ ëŒ€ì‘ í•„ìš”\n\n**Trino UI í™œìš©**:\n- Query IDë¡œ ê²€ìƒ‰í•˜ì—¬ Query Plan í™•ì¸\n- Stageë³„ ì‹¤í–‰ ì‹œê°„ ë° ë°ì´í„° ìŠ¤ìº”ëŸ‰ ë¶„ì„\n- Split ë¶„í¬ë¥¼ í†µí•œ ë°ì´í„° ìŠ¤í í™•ì¸\n\n**ì¼ë°˜ì  ìµœì í™”**:\n- **íŒŒí‹°ì…˜ í•„í„° ì¶”ê°€**: WHERE date >= '2024-01-01'\n- **ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ ì œê±°**: SELECT * ëŒ€ì‹  í•„ìš” ì»¬ëŸ¼ë§Œ\n- **Join ìˆœì„œ ë³€ê²½**: ì‘ì€ í…Œì´ë¸”ì„ ì™¼ìª½ì—\n- **Materialized View**: ìì£¼ ì‚¬ìš©í•˜ëŠ” ì§‘ê³„ ê²°ê³¼ ë¯¸ë¦¬ ê³„ì‚°\n\n**í˜‘ì—…**:\n- ëŠë¦° ì¿¼ë¦¬ ì‘ì„±ìì—ê²Œ í”¼ë“œë°± ì œê³µ\n- ì¿¼ë¦¬ ë¦¬ë·° í”„ë¡œì„¸ìŠ¤ ë„ì…\n- Query Optimization ê°€ì´ë“œ ë¬¸ì„œí™”\n\n**SLO**: Top 10 í‰ê·  < 60ì´ˆ\n**ê´€ë ¨ ë©”íŠ¸ë¦­**: Query Success Rate, Running Queries",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 50},
          "targets": [
            {
              "expr": "topk(10, avg(rate(trino_execution_query_execution_time_seconds_sum[1h])) by (query_id, user) / avg(rate(trino_execution_query_execution_time_seconds_count[1h])) by (query_id, user))",
              "refId": "A",
              "format": "table",
              "instant": true
            }
          ],
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {"Time": true, "__name__": true, "job": true, "instance": true},
                "indexByName": {"query_id": 0, "user": 1, "Value": 2},
                "renameByName": {"query_id": "Query ID", "user": "User", "Value": "Avg Execution Time (s)"}
              }
            }
          ],
          "fieldConfig": {
            "defaults": {
              "custom": {"align": "left", "filterable": true}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Avg Execution Time (s)"},
                "properties": [
                  {"id": "unit", "value": "s"},
                  {"id": "decimals", "value": 1},
                  {"id": "custom.align", "value": "right"},
                  {"id": "custom.cellOptions", "value": {"type": "color-background"}},
                  {"id": "thresholds", "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": 0, "color": "rgba(129, 201, 149, 0.2)"},
                      {"value": 30, "color": "rgba(255, 217, 125, 0.3)"},
                      {"value": 60, "color": "rgba(244, 139, 139, 0.3)"}
                    ]
                  }}
                ]
              },
              {
                "matcher": {"id": "byName", "options": "Query ID"},
                "properties": [
                  {"id": "custom.width", "value": 350}
                ]
              }
            ]
          }
        }
      ]
    }

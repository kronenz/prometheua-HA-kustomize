apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-k8s-performance-analysis-v1
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  k8s-performance-analysis-v1.json: |
    {
      "uid": "k8s-performance-analysis-v1",
      "title": "ì¿ ë²„ë„¤í‹°ìŠ¤-06-ì¸í”„ë¼-ì„±ëŠ¥ ë¶„ì„",
      "tags": ["kubernetes", "infrastructure", "performance", "optimization", "korean", "v1"],
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "refresh": "30s",
      "time": {"from": "now-1h", "to": "now"},
      "panels": [
        {
          "title": "ğŸ“‹ ì„±ëŠ¥ ë¶„ì„ ë° ìµœì í™”",
          "type": "text",
          "gridPos": {"x": 0, "y": 0, "w": 24, "h": 2},
          "options": {"mode": "markdown", "content": "# âš¡ Kubernetes ì„±ëŠ¥ ë¶„ì„ ë° ìµœì í™” ê¶Œì¥\n\n**ë¹ ë¥¸ ì´ë™**: [ğŸ  ê°œìš”](d/k8s-cluster-overview-v1) | [ğŸ–¥ï¸ ë…¸ë“œ](d/k8s-node-resources-v1) | [ğŸŒ ë„¤íŠ¸ì›Œí¬](d/k8s-network-monitoring-v1) | [ğŸ’¾ ìŠ¤í† ë¦¬ì§€](d/k8s-storage-capacity-v1) | [ğŸ“¦ ì›Œí¬ë¡œë“œ](d/k8s-workload-status-v1)"}
        },
        {
          "title": "1ï¸âƒ£ CPU Throttled Containers",
          "type": "stat",
          "gridPos": {"x": 0, "y": 2, "w": 6, "h": 3},
          "description": "CPU Throttlingì´ ë°œìƒí•œ Container ìˆ˜",
          "targets": [{"expr": "count(rate(container_cpu_cfs_throttled_seconds_total[5m]) > 0) or vector(0)", "refId": "A"}],
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"value": null, "color": "#D5F4E6"}, {"value": 1, "color": "#FCF3CF"}, {"value": 5, "color": "#FADBD8"}]}, "unit": "short"}},
          "options": {"graphMode": "area", "colorMode": "background", "textMode": "value_and_name"}
        },
        {
          "title": "2ï¸âƒ£ OOMKilled Containers",
          "type": "stat",
          "gridPos": {"x": 6, "y": 2, "w": 6, "h": 3},
          "description": "ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ì¢…ë£Œëœ Container",
          "targets": [{"expr": "count(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}) or vector(0)", "refId": "A"}],
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"value": null, "color": "#D5F4E6"}, {"value": 1, "color": "#FADBD8"}]}, "unit": "short"}},
          "options": {"graphMode": "none", "colorMode": "background", "textMode": "value_and_name"}
        },
        {
          "title": "3ï¸âƒ£ ë…¸ë“œ ì••ë°• ìƒíƒœ",
          "type": "stat",
          "gridPos": {"x": 12, "y": 2, "w": 6, "h": 3},
          "description": "MemoryPressure ë˜ëŠ” DiskPressure ìƒíƒœì˜ ë…¸ë“œ",
          "targets": [{"expr": "count(kube_node_status_condition{condition=~\"MemoryPressure|DiskPressure\",status=\"true\"}) or vector(0)", "refId": "A"}],
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"value": null, "color": "#D5F4E6"}, {"value": 1, "color": "#FADBD8"}]}, "unit": "short"}},
          "options": {"graphMode": "none", "colorMode": "background", "textMode": "value_and_name"}
        },
        {
          "title": "4ï¸âƒ£ ë””ìŠ¤í¬ I/O ëŒ€ê¸°",
          "type": "stat",
          "gridPos": {"x": 18, "y": 2, "w": 6, "h": 3},
          "description": "ë†’ì€ ë””ìŠ¤í¬ I/O ëŒ€ê¸° ì‹œê°„ì„ ê°€ì§„ ë…¸ë“œ ìˆ˜",
          "targets": [{"expr": "count(rate(node_disk_io_time_weighted_seconds_total[5m]) > 0.1) or vector(0)", "refId": "A"}],
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"value": null, "color": "#D5F4E6"}, {"value": 1, "color": "#FCF3CF"}, {"value": 2, "color": "#FADBD8"}]}, "unit": "short"}},
          "options": {"graphMode": "area", "colorMode": "background", "textMode": "value_and_name"}
        },
        {
          "title": "ğŸ” CPU ê³¼ë‹¤ í• ë‹¹ Containers (Request vs Usage)",
          "type": "table",
          "gridPos": {"x": 0, "y": 5, "w": 12, "h": 8},
          "description": "CPU RequestëŠ” ë†’ì§€ë§Œ ì‹¤ì œ ì‚¬ìš©ë¥ ì´ ë‚®ì€ Container (ìµœì í™” ê¸°íšŒ)",
          "targets": [
            {"expr": "kube_pod_container_resource_requests{resource=\"cpu\"}", "format": "table", "instant": true, "refId": "A"},
            {"expr": "rate(container_cpu_usage_seconds_total{container!=\"\",container!=\"POD\"}[5m])", "format": "table", "instant": true, "refId": "B"}
          ],
          "transformations": [
            {"id": "merge"},
            {"id": "organize", "options": {"excludeByName": {"Time": true, "job": true, "instance": true, "__name__": true, "resource": true, "unit": true, "id": true, "image": true, "name": true}, "renameByName": {"namespace": "Namespace", "pod": "Pod", "container": "Container", "Value #A": "Request", "Value #B": "Usage"}}}
          ],
          "fieldConfig": {"defaults": {"custom": {"align": "left"}}, "overrides": [
            {"matcher": {"id": "byName", "options": "Request"}, "properties": [{"id": "decimals", "value": 3}]},
            {"matcher": {"id": "byName", "options": "Usage"}, "properties": [{"id": "decimals", "value": 3}]}
          ]},
          "options": {"showHeader": true, "cellHeight": "sm"}
        },
        {
          "title": "ğŸ’¾ ë©”ëª¨ë¦¬ ê³¼ë‹¤ í• ë‹¹ Containers (Request vs Usage)",
          "type": "table",
          "gridPos": {"x": 12, "y": 5, "w": 12, "h": 8},
          "description": "ë©”ëª¨ë¦¬ RequestëŠ” ë†’ì§€ë§Œ ì‹¤ì œ ì‚¬ìš©ëŸ‰ì´ ë‚®ì€ Container (ìµœì í™” ê¸°íšŒ)",
          "targets": [
            {"expr": "kube_pod_container_resource_requests{resource=\"memory\"}", "format": "table", "instant": true, "refId": "A"},
            {"expr": "container_memory_working_set_bytes{container!=\"\",container!=\"POD\"}", "format": "table", "instant": true, "refId": "B"}
          ],
          "transformations": [
            {"id": "merge"},
            {"id": "organize", "options": {"excludeByName": {"Time": true, "job": true, "instance": true, "__name__": true, "resource": true, "unit": true, "id": true, "image": true, "name": true}, "renameByName": {"namespace": "Namespace", "pod": "Pod", "container": "Container", "Value #A": "Request", "Value #B": "Usage"}}}
          ],
          "fieldConfig": {"defaults": {"custom": {"align": "left"}}, "overrides": [
            {"matcher": {"id": "byName", "options": "Request"}, "properties": [{"id": "unit", "value": "bytes"}]},
            {"matcher": {"id": "byName", "options": "Usage"}, "properties": [{"id": "unit", "value": "bytes"}]}
          ]},
          "options": {"showHeader": true, "cellHeight": "sm"}
        },
        {
          "title": "âš¡ CPU Throttling ë°œìƒ Containers (Top 10)",
          "type": "timeseries",
          "gridPos": {"x": 0, "y": 13, "w": 12, "h": 8},
          "targets": [{"expr": "topk(10, rate(container_cpu_cfs_throttled_seconds_total[5m]) > 0)", "legendFormat": "{{namespace}}/{{pod}}/{{container}}", "refId": "A"}],
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10, "pointSize": 5, "spanNulls": true}, "unit": "s"}},
          "options": {"legend": {"displayMode": "table", "placement": "right", "showLegend": true, "calcs": ["lastNotNull", "max"]}}
        },
        {
          "title": "ğŸ’€ OOMKilled Events",
          "type": "table",
          "gridPos": {"x": 12, "y": 13, "w": 12, "h": 8},
          "targets": [{"expr": "kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}", "format": "table", "instant": true, "refId": "A"}],
          "transformations": [
            {"id": "organize", "options": {"excludeByName": {"Time": true, "job": true, "instance": true, "__name__": true, "uid": true, "reason": true, "Value": true}, "renameByName": {"namespace": "Namespace", "pod": "Pod", "container": "Container"}}}
          ],
          "options": {"showHeader": true, "cellHeight": "sm"}
        },
        {
          "title": "ğŸ’¡ ë¦¬ì†ŒìŠ¤ ìµœì í™” ê¶Œì¥ì‚¬í•­",
          "type": "text",
          "gridPos": {"x": 0, "y": 21, "w": 24, "h": 10},
          "options": {"mode": "markdown", "content": "# ğŸ’¡ Kubernetes ë¦¬ì†ŒìŠ¤ ìµœì í™” ê°€ì´ë“œ\n\n## ğŸ” CPU/ë©”ëª¨ë¦¬ ê³¼ë‹¤ í• ë‹¹ í•´ê²°\n\n### ë¬¸ì œ\nRequestëŠ” ë†’ì§€ë§Œ ì‹¤ì œ ì‚¬ìš©ë¥ ì´ 30% ë¯¸ë§Œì¸ Container\n\n### í•´ê²° ë°©ë²•\n```yaml\nresources:\n  requests:\n    cpu: 100m      # í˜„ì¬ 200m â†’ 100mìœ¼ë¡œ ê°ì†Œ\n    memory: 128Mi  # í˜„ì¬ 256Mi â†’ 128Miìœ¼ë¡œ ê°ì†Œ\n  limits:\n    cpu: 200m\n    memory: 256Mi\n```\n\n**íš¨ê³¼**: í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ í™œìš©ë„ í–¥ìƒ, ë” ë§ì€ Pod ë°°í¬ ê°€ëŠ¥\n\n---\n\n## âš¡ CPU Throttling í•´ê²°\n\n### ë¬¸ì œ\nCPU Limitì— ì˜í•´ ì„±ëŠ¥ì´ ì œí•œë˜ëŠ” Container\n\n### í•´ê²° ë°©ë²•\n```yaml\nresources:\n  requests:\n    cpu: 100m\n  limits:\n    cpu: 500m      # 200m â†’ 500mìœ¼ë¡œ ì¦ê°€\n```\n\në˜ëŠ” Throttlingì´ ë¹ˆë²ˆí•˜ë©´ Limit ì œê±° ê³ ë ¤:\n```yaml\nresources:\n  requests:\n    cpu: 100m\n  # limits ì œê±° (Burstable QoS)\n```\n\n---\n\n## ğŸ’€ OOMKilled í•´ê²°\n\n### ë¬¸ì œ\në©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ Containerê°€ ì¢…ë£Œë¨\n\n### í•´ê²° ë°©ë²•\n```yaml\nresources:\n  requests:\n    memory: 256Mi\n  limits:\n    memory: 512Mi  # 256Mi â†’ 512Miìœ¼ë¡œ ì¦ê°€\n```\n\n**í™•ì¸ ëª…ë ¹ì–´**:\n```bash\nkubectl logs <pod-name> --previous\nkubectl describe pod <pod-name>\n```\n\n---\n\n## ğŸ“Š ë…¸ë“œ ì••ë°• ìƒíƒœ í•´ê²°\n\n### MemoryPressure\n- **ì›ì¸**: ë…¸ë“œì˜ ê°€ìš© ë©”ëª¨ë¦¬ ë¶€ì¡±\n- **í•´ê²°**: Pod eviction, ë…¸ë“œ ì¶”ê°€, Memory Request ìµœì í™”\n\n### DiskPressure\n- **ì›ì¸**: ë””ìŠ¤í¬ ì‚¬ìš©ë¥  85% ì´ìƒ\n- **í•´ê²°**: ë¶ˆí•„ìš”í•œ ì´ë¯¸ì§€ ì‚­ì œ, PVC ìš©ëŸ‰ ì¦ì„¤\n\n```bash\n# ë””ìŠ¤í¬ ì •ë¦¬\nkubectl delete pods --field-selector=status.phase==Failed\ndocker system prune -a\n```\n\n---\n\n## âš¡ ì„±ëŠ¥ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n- [ ] CPU/ë©”ëª¨ë¦¬ Request vs Usage ë¹„ìœ¨ 70% ì´ìƒ ìœ ì§€\n- [ ] CPU Throttling ë°œìƒ Container Limit ì¦ê°€\n- [ ] OOMKilled Container ë©”ëª¨ë¦¬ Limit ì¦ê°€\n- [ ] ë…¸ë“œ ì••ë°• ìƒíƒœ(MemoryPressure/DiskPressure) í•´ì†Œ\n- [ ] ë””ìŠ¤í¬ I/O ëŒ€ê¸° ì‹œê°„ 0.1s ì´í•˜ ìœ ì§€\n- [ ] ë¯¸ì‚¬ìš© ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (Failed Pods, ì´ë¯¸ì§€)\n- [ ] QoS Class ìµœì í™” (Guaranteed > Burstable > BestEffort)"}
        }
      ]
    }
